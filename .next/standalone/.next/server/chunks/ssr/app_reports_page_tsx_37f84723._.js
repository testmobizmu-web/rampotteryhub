module.exports=[77363,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(71987),f=a.i(50944),g=a.i(24767);function h(a){let b=Number(a);return Number.isFinite(b)?b:0}function i(a){let b=Number.isFinite(a)?a:0;return`Rs ${b.toFixed(2)}`}function j(a){if(!a)return"";let b=String(a);return b.length>=10?b.slice(0,10):b}function k(a){let b=j(a);if(!b)return"â€”";let[c,d,e]=b.split("-");return c&&d&&e?`${e}/${d}/${c}`:b}function l(a){return a?"string"==typeof a?a:Array.isArray(a)?a?.[0]?.name||"":a?.name||"":""}async function m(a,b){let c=await (0,g.rpFetch)(a,b);return"function"==typeof c?.json?await c.json():c}function n(a,b,c){let d=a=>{let b=null==a?"":String(a);return b.includes(",")||b.includes('"')||b.includes("\n")?`"${b.replaceAll('"','""')}"`:b},e=new Blob([[b.map(d).join(",")].concat(c.map(a=>a.map(d).join(","))).join("\n")],{type:"text/csv;charset=utf-8"}),f=URL.createObjectURL(e),g=document.createElement("a");g.href=f,g.download=a,g.click(),URL.revokeObjectURL(f)}function o(a){return String(a||"").toUpperCase()}function p(){(0,f.usePathname)();let a=(0,f.useRouter)(),[g,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)("light"),[u,v]=(0,c.useState)("â€”"),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)(()=>{let a=new Date;return a.setMonth(a.getMonth()-1),a.toISOString().slice(0,10)}),[O,P]=(0,c.useState)(()=>new Date().toISOString().slice(0,10));function Q(){let a="dark"===s?"light":"dark";t(a),document.documentElement.dataset.theme=a,localStorage.setItem("rp_theme",a)}async function R(){try{await fetch("/api/auth/logout",{method:"POST"})}finally{localStorage.removeItem("rp_user"),window.location.href="/login"}}async function S(){z(!0),B(null);try{var a;let b,c,d,e,f,g,h=await m("/api/invoices/list",{cache:"no-store"}),i=await m("/api/credit-notes",{cache:"no-store"}),j=h?.invoices??h?.data??h?.rows??h?.items??[],k=i?.creditNotes??i?.data??i?.rows??i?.items??[];D(Array.isArray(j)?j:[]),F(Array.isArray(k)?k:[]),v((a=new Date,b=String(a.getDate()).padStart(2,"0"),c=String(a.getMonth()+1).padStart(2,"0"),d=a.getFullYear(),e=String(a.getHours()).padStart(2,"0"),f=String(a.getMinutes()).padStart(2,"0"),g=String(a.getSeconds()).padStart(2,"0"),`${b}/${c}/${d}, ${e}:${f}:${g}`))}catch(a){B(a?.message||"Failed to load reports"),D([]),F([])}finally{z(!1)}await T()}async function T(){H(!0),J(null);try{let a=await m(`/api/reports/sales-by-product?from=${encodeURIComponent(M)}&to=${encodeURIComponent(O)}`,{cache:"no-store"});if(!a?.ok)throw Error(a?.error||"Failed to load product sales report");L(Array.isArray(a.rows)?a.rows:[])}catch(a){J(a?.message||"Failed to load product sales report"),L([])}finally{H(!1)}}(0,c.useEffect)(()=>p(!0),[]),(0,c.useEffect)(()=>{let b="dark"===localStorage.getItem("rp_theme")?"dark":"light";t(b),document.documentElement.dataset.theme=b;try{let b=localStorage.getItem("rp_user");if(!b)return void a.replace("/login");let c=JSON.parse(b);x(c)}catch{a.replace("/login");return}},[]),(0,c.useEffect)(()=>{S()},[]);let U=(0,c.useMemo)(()=>{let a=M||"0000-00-00",b=O||"9999-12-31",c=C.filter(c=>{let d=j(c.invoice_date);return!!d&&d>=a&&d<=b}),d=E.filter(c=>{let d=j(c.credit_note_date);return!!d&&d>=a&&d<=b}),e=d.filter(a=>"VOID"===String(a.status||"").toUpperCase());return{inv:c,activeCN:d.filter(a=>"VOID"!==String(a.status||"").toUpperCase()),voidCN:e}},[C,E,M,O]),V=(0,c.useMemo)(()=>{let a=U.inv.reduce((a,b)=>a+h(b.total_amount),0),b=U.inv.reduce((a,b)=>a+h(b.amount_paid),0),c=U.inv.reduce((a,b)=>a+h(b.balance_remaining),0),d=U.activeCN.reduce((a,b)=>a+h(b.total_amount),0),e=U.voidCN.length,f=U.voidCN.reduce((a,b)=>a+h(b.total_amount),0);return{invCount:U.inv.length,invTotal:a,invPaid:b,invDue:c,cnCount:U.activeCN.length,cnTotal:d,voidCount:e,voidTotal:f}},[U]),W=(0,c.useMemo)(()=>(w?.name||w?.username||"").trim()||"User",[w]),X=(0,c.useMemo)(()=>o(w?.role)||"STAFF",[w]),Y=g&&"ADMIN"===o(w?.role),Z=(0,c.useMemo)(()=>{let a=[{href:"/",label:"Dashboard"},{href:"/invoices",label:"Invoices"},{href:"/credit-notes",label:"Credit Notes"},{href:"/stock",label:"Stock & Categories"},{href:"/stock-movements",label:"Stock Movements"},{href:"/customers",label:"Customers"},{href:"/reports",label:"Reports & Statements"}];return Y&&a.push({href:"/admin/users",label:"Users & Permissions"}),a},[Y]);return g?(0,b.jsxs)("div",{className:"rp-app",children:[(0,b.jsxs)("div",{className:"rp-bg","aria-hidden":"true",children:[(0,b.jsx)("div",{className:"rp-bg-orb rp-bg-orb--1"}),(0,b.jsx)("div",{className:"rp-bg-orb rp-bg-orb--2"}),(0,b.jsx)("div",{className:"rp-bg-orb rp-bg-orb--3"}),(0,b.jsx)("div",{className:"rp-bg-grid"})]}),(0,b.jsxs)("div",{className:"rp-shell rp-enter",children:[(0,b.jsxs)("div",{className:"rp-mtop",children:[(0,b.jsx)("button",{type:"button",className:"rp-icon-btn rp-burger",onClick:()=>r(!0),"aria-label":"Open menu",children:(0,b.jsxs)("span",{"aria-hidden":"true",children:[(0,b.jsx)("i",{}),(0,b.jsx)("i",{}),(0,b.jsx)("i",{})]})}),(0,b.jsxs)("div",{className:"rp-mtop-brand",children:[(0,b.jsx)("div",{className:"rp-mtop-title",children:"RampotteryHUB"}),(0,b.jsx)("div",{className:"rp-mtop-sub",children:"Reports"})]}),(0,b.jsx)("button",{type:"button",className:"rp-icon-btn",onClick:Q,"aria-label":"Toggle theme",children:"dark"===s?"â˜€":"ðŸŒ™"})]}),(0,b.jsx)("button",{className:`rp-overlay ${q?"is-open":""}`,onClick:()=>r(!1),"aria-label":"Close menu"}),(0,b.jsxs)("aside",{className:`rp-drawer ${q?"is-open":""}`,children:[(0,b.jsxs)("div",{className:"rp-drawer-head",children:[(0,b.jsxs)("div",{className:"rp-drawer-brand",children:[(0,b.jsx)("div",{className:"rp-drawer-logo",children:(0,b.jsx)(e.default,{src:"/images/logo/logo.png",alt:"Ram Pottery Ltd",width:28,height:28,priority:!0})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-drawer-title",children:"RampotteryHUB"}),(0,b.jsx)("div",{className:"rp-drawer-sub",children:"Accounting & Stock System"})]})]}),(0,b.jsx)("button",{type:"button",className:"rp-icon-btn",onClick:()=>r(!1),"aria-label":"Close",children:"âœ•"})]}),(0,b.jsxs)("div",{className:"rp-drawer-body",children:[(0,b.jsx)("nav",{className:"rp-nav",children:Z.map(a=>(0,b.jsxs)(d.default,{className:`rp-nav-btn ${"/reports"===a.href?"rp-nav-btn--active":""}`,href:a.href,onClick:()=>r(!1),children:[(0,b.jsx)("span",{className:"rp-ic3d","aria-hidden":"true",children:"â–¶"}),a.label]},a.href))}),(0,b.jsxs)("div",{className:"rp-side-footer rp-side-footer--in",children:[(0,b.jsxs)("div",{className:"rp-role",children:[(0,b.jsx)("span",{children:"Signed in"}),(0,b.jsx)("b",{title:W,children:W})]}),(0,b.jsxs)("div",{className:"rp-role",style:{marginTop:10},children:[(0,b.jsx)("span",{children:"Role"}),(0,b.jsx)("b",{children:X})]})]})]})]}),(0,b.jsx)("aside",{className:"rp-side",children:(0,b.jsxs)("div",{className:"rp-side-card rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-brand",children:[(0,b.jsx)("div",{className:"rp-brand-logo",children:(0,b.jsx)(e.default,{src:"/images/logo/logo.png",alt:"Ram Pottery Ltd",width:30,height:30,priority:!0})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-brand-title",children:"RampotteryHUB"}),(0,b.jsx)("div",{className:"rp-brand-sub",children:"Accounting & Stock System"})]})]}),(0,b.jsx)("nav",{className:"rp-nav",children:Z.map(a=>(0,b.jsxs)(d.default,{className:`rp-nav-btn ${"/reports"===a.href?"rp-nav-btn--active":""}`,href:a.href,children:[(0,b.jsx)("span",{className:"rp-ic3d","aria-hidden":"true",children:"â–¶"}),a.label]},a.href))}),(0,b.jsxs)("div",{className:"rp-side-footer rp-side-footer--in",children:[(0,b.jsxs)("div",{className:"rp-role",children:[(0,b.jsx)("span",{children:"Signed in"}),(0,b.jsx)("b",{title:W,children:W})]}),(0,b.jsxs)("div",{className:"rp-role",style:{marginTop:10},children:[(0,b.jsx)("span",{children:"Role"}),(0,b.jsx)("b",{children:X})]})]})]})}),(0,b.jsxs)("main",{className:"rp-main",children:[(0,b.jsxs)("header",{className:"rp-top rp-top--saas rp-card-anim",style:{animationDelay:"60ms"},children:[(0,b.jsxs)("div",{className:"rp-top-left--actions",children:[(0,b.jsxs)("button",{type:"button",className:"rp-ui-btn rp-ui-btn--brand",onClick:Q,children:[(0,b.jsx)("span",{className:"rp-ui-btn__dot","aria-hidden":"true"}),"dark"===s?"â˜€ Light":"ðŸŒ™ Dark"]}),(0,b.jsxs)("button",{type:"button",className:"rp-ui-btn rp-ui-btn--danger",onClick:R,children:[(0,b.jsx)("span",{className:"rp-ui-btn__dot","aria-hidden":"true"}),"Log Out"]})]}),(0,b.jsx)("div",{className:"rp-top-center--logo",children:(0,b.jsx)("div",{className:"rp-top-logo",children:(0,b.jsx)(e.default,{src:"/images/logo/logo.png",alt:"Ram Pottery",width:44,height:44,priority:!0})})}),(0,b.jsx)("div",{className:"rp-top-right--sync",children:(0,b.jsxs)("div",{className:"rp-sync",children:[(0,b.jsx)("div",{className:"rp-sync-label",children:"Last sync :"}),(0,b.jsx)("div",{className:"rp-sync-time",children:u||"â€”"})]})})]}),(0,b.jsxs)("section",{className:"rp-exec rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-exec__left",children:[(0,b.jsx)("div",{className:"rp-exec__title",children:"Reports & Statements"}),(0,b.jsx)("div",{className:"rp-exec__sub",children:"Period totals â€¢ exports â€¢ product sales (by item code)"})]}),(0,b.jsxs)("div",{className:"rp-exec__right",children:[(0,b.jsxs)("span",{className:`rp-live ${y?"is-dim":""}`,children:[(0,b.jsx)("span",{className:"rp-live-dot","aria-hidden":"true"}),y?"Syncing":"Live"]}),(0,b.jsx)("span",{className:`rp-chip rp-chip--soft ${A?"rp-chip--warn":""}`,children:A?"Attention needed":"All systems normal"})]})]}),(0,b.jsxs)("section",{className:"rp-kpi-pro rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"Invoice Total"}),(0,b.jsx)("div",{className:"rp-kpi-pro__value",children:i(V.invTotal)}),(0,b.jsxs)("div",{className:"rp-kpi-pro__sub",children:[V.invCount," invoice(s)"]})]}),(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"Paid"}),(0,b.jsx)("div",{className:"rp-kpi-pro__value",children:i(V.invPaid)}),(0,b.jsx)("div",{className:"rp-kpi-pro__sub",children:"Collected"})]}),(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"Outstanding"}),(0,b.jsx)("div",{className:"rp-kpi-pro__value",children:i(V.invDue)}),(0,b.jsx)("div",{className:"rp-kpi-pro__sub",children:"Balance remaining"})]}),(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"Credit Notes"}),(0,b.jsx)("div",{className:"rp-kpi-pro__value",children:i(V.cnTotal)}),(0,b.jsxs)("div",{className:"rp-kpi-pro__sub",children:[V.cnCount," active"]})]})]}),(0,b.jsxs)("section",{className:"rp-card rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-card-head rp-card-head--tight",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-card-title",children:"Date Range"}),(0,b.jsx)("div",{className:"rp-card-sub",children:"Adjust the period then Refresh"})]}),(0,b.jsx)("span",{className:`rp-chip ${y?"is-dim":""}`,children:y?"Loadingâ€¦":"Ready"})]}),(0,b.jsxs)("div",{className:"rp-card-body",children:[(0,b.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"end"},children:[(0,b.jsxs)("label",{className:"rp-field",style:{minWidth:220},children:[(0,b.jsx)("span",{className:"rp-label",children:"From"}),(0,b.jsx)("input",{className:"rp-input",type:"date",value:M,onChange:a=>N(a.target.value)})]}),(0,b.jsxs)("label",{className:"rp-field",style:{minWidth:220},children:[(0,b.jsx)("span",{className:"rp-label",children:"To"}),(0,b.jsx)("input",{className:"rp-input",type:"date",value:O,onChange:a=>P(a.target.value)})]}),(0,b.jsxs)("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[(0,b.jsxs)("button",{className:"rp-ui-btn rp-ui-btn--danger",type:"button",onClick:S,disabled:y||G,children:[(0,b.jsx)("span",{className:"rp-ui-btn__dot","aria-hidden":"true"}),y||G?"Loadingâ€¦":"Refresh"]}),(0,b.jsxs)(d.default,{className:"rp-ui-btn rp-ui-btn--brand",href:"/invoices",prefetch:!1,children:[(0,b.jsx)("span",{className:"rp-ui-btn__dot","aria-hidden":"true"}),"View Invoices"]})]}),(0,b.jsxs)("div",{className:"rp-muted",style:{fontWeight:900},children:["Showing ",(0,b.jsx)("b",{children:V.invCount})," invoices â€¢ ",(0,b.jsx)("b",{children:V.cnCount})," credit notes â€¢ ",(0,b.jsx)("b",{children:V.voidCount})," VOID excluded"]})]}),A?(0,b.jsx)("div",{className:"rp-note rp-note--warn",style:{marginTop:10,whiteSpace:"pre-wrap"},children:A}):null]})]}),(0,b.jsxs)("section",{className:"rp-card rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-card-head rp-card-head--tight",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-card-title",children:"Exports"}),(0,b.jsx)("div",{className:"rp-card-sub",children:"Download CSV for accounting / audits"})]}),(0,b.jsx)("span",{className:"rp-chip",children:"CSV"})]}),(0,b.jsxs)("div",{className:"rp-card-body",children:[(0,b.jsxs)("div",{className:"rp-seg rp-seg--pro",style:{justifyContent:"flex-start"},children:[(0,b.jsxs)("button",{className:"rp-seg-item rp-seg-item--brand",type:"button",onClick:function(){n(`reports_invoices_${M}_to_${O}.csv`,["Invoice No","Date","Customer","Total","Paid","Balance","Status"],U.inv.map(a=>{let b=l(a.customers);return[a.invoice_number||`#${a.id}`,k(a.invoice_date),b||"",h(a.total_amount).toFixed(2),h(a.amount_paid).toFixed(2),h(a.balance_remaining).toFixed(2),String(a.status||"").toUpperCase()]}))},children:[(0,b.jsx)("span",{className:"rp-icbtn","aria-hidden":"true",children:"â¬‡"}),"Export Invoices CSV"]}),(0,b.jsxs)("button",{className:"rp-seg-item rp-seg-item--brand",type:"button",onClick:function(){n(`reports_credit_notes_${M}_to_${O}.csv`,["Credit Note No","Date","Customer","Total","Status"],U.activeCN.map(a=>{let b=l(a.customers);return[a.credit_note_number||`#${a.id}`,k(a.credit_note_date),b||"",h(a.total_amount).toFixed(2),String(a.status||"").toUpperCase()]}))},children:[(0,b.jsx)("span",{className:"rp-icbtn","aria-hidden":"true",children:"â¬‡"}),"Export Credit Notes CSV"]}),(0,b.jsxs)("button",{className:"rp-seg-item rp-seg-item--brand",type:"button",onClick:function(){n(`reports_sales_by_product_${M}_to_${O}.csv`,["Item Code","Product","Qty","Ex Total","VAT Total","Inc Total","Line Total"],K.map(a=>[a.item_code,a.product_name||"",h(a.qty).toFixed(0),h(a.ex_total).toFixed(2),h(a.vat_total).toFixed(2),h(a.inc_total).toFixed(2),h(a.line_total).toFixed(2)]))},disabled:0===K.length,children:[(0,b.jsx)("span",{className:"rp-icbtn","aria-hidden":"true",children:"â¬‡"}),"Export Product Sales CSV"]})]}),(0,b.jsxs)("div",{className:"rp-muted",style:{marginTop:10},children:["Tip: Credit notes marked ",(0,b.jsx)("b",{children:"VOID"})," are excluded from totals."]})]})]}),(0,b.jsxs)("section",{className:"rp-card rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-card-head rp-card-head--tight",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-card-title",children:"Sales by Product Code"}),(0,b.jsx)("div",{className:"rp-card-sub",children:"Grouped totals by Item Code (for commission / analysis)"})]}),(0,b.jsx)("span",{className:`rp-chip ${G?"is-dim":""}`,children:G?"Loadingâ€¦":`${K.length} items`})]}),(0,b.jsxs)("div",{className:"rp-card-body",children:[I?(0,b.jsx)("div",{className:"rp-note rp-note--warn",style:{whiteSpace:"pre-wrap"},children:I}):null,(0,b.jsx)("div",{style:{overflowX:"auto"},children:(0,b.jsxs)("table",{className:"rp-table",style:{width:"100%",borderCollapse:"separate",borderSpacing:0},children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{style:{textAlign:"left",padding:10},children:"Item Code"}),(0,b.jsx)("th",{style:{textAlign:"left",padding:10},children:"Product"}),(0,b.jsx)("th",{style:{textAlign:"right",padding:10},children:"Qty"}),(0,b.jsx)("th",{style:{textAlign:"right",padding:10},children:"Ex Total"}),(0,b.jsx)("th",{style:{textAlign:"right",padding:10},children:"VAT"}),(0,b.jsx)("th",{style:{textAlign:"right",padding:10},children:"Inc Total"})]})}),(0,b.jsxs)("tbody",{children:[K.map(a=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{style:{padding:10,fontWeight:900},children:a.item_code}),(0,b.jsx)("td",{style:{padding:10},children:a.product_name||"â€”"}),(0,b.jsx)("td",{style:{padding:10,textAlign:"right",fontWeight:900},children:h(a.qty).toFixed(0)}),(0,b.jsx)("td",{style:{padding:10,textAlign:"right"},children:i(h(a.ex_total))}),(0,b.jsx)("td",{style:{padding:10,textAlign:"right"},children:i(h(a.vat_total))}),(0,b.jsx)("td",{style:{padding:10,textAlign:"right",fontWeight:900},children:i(h(a.inc_total))})]},a.item_code)),0!==K.length||G?null:(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:6,style:{padding:12,opacity:.7,fontWeight:900},children:"No sales for this period."})})]})]})}),(0,b.jsx)("div",{className:"rp-muted",style:{marginTop:10},children:"Uses invoice items and groups by product item code for the selected date range."})]})]}),(0,b.jsxs)("section",{className:"rp-card rp-card-anim",style:{border:"1px solid rgba(255,107,107,.22)"},children:[(0,b.jsxs)("div",{className:"rp-card-head rp-card-head--tight",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-card-title",children:"VOID Credit Notes"}),(0,b.jsx)("div",{className:"rp-card-sub",children:"Excluded from totals (kept for audit trail)"})]}),(0,b.jsxs)("span",{className:"rp-chip rp-chip--warn",children:[V.voidCount," VOID"]})]}),(0,b.jsxs)("div",{className:"rp-card-body",style:{display:"flex",gap:10,flexWrap:"wrap"},children:[(0,b.jsxs)("span",{className:"rp-status rp-status-pending",children:[(0,b.jsx)("span",{className:"rp-status-dot"}),"Count: ",(0,b.jsx)("b",{children:V.voidCount})]}),(0,b.jsxs)("span",{className:"rp-status rp-status-cancelled",children:[(0,b.jsx)("span",{className:"rp-status-dot"}),"Amount: ",(0,b.jsx)("b",{children:i(V.voidTotal)})]})]})]}),(0,b.jsxs)("footer",{className:"rp-footer",children:["Â© ",new Date().getFullYear()," Ram Pottery Ltd â€¢ Built by Mobiz.mu"]})]})]})]}):null}a.s(["default",()=>p])}];

//# sourceMappingURL=app_reports_page_tsx_37f84723._.js.map