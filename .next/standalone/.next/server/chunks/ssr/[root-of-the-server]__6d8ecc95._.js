module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},46058,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},39118,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={DEFAULT_SEGMENT_KEY:function(){return l},NOT_FOUND_SEGMENT_KEY:function(){return m},PAGE_SEGMENT_KEY:function(){return k},addSearchParamsIfPageSegment:function(){return i},computeSelectedLayoutSegment:function(){return j},getSegmentValue:function(){return f},getSelectedLayoutSegmentPath:function(){return function a(b,c,d=!0,e=[]){let g;if(d)g=b[1][c];else{let a=b[1];g=a.children??Object.values(a)[0]}if(!g)return e;let h=f(g[0]);return!h||h.startsWith(k)?e:(e.push(h),a(g,c,!1,e))}},isGroupSegment:function(){return g},isParallelRouteSegment:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(a){return Array.isArray(a)?a[1]:a}function g(a){return"("===a[0]&&a.endsWith(")")}function h(a){return a.startsWith("@")&&"@children"!==a}function i(a,b){if(a.includes(k)){let a=JSON.stringify(b);return"{}"!==a?k+"?"+a:k}return a}function j(a,b){if(!a||0===a.length)return null;let c="children"===b?a[0]:a[a.length-1];return c===l?null:c}let k="__PAGE__",l="__DEFAULT__",m="/_not-found"},8591,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"useMergedRef",{enumerable:!0,get:function(){return e}});let d=a.r(72131);function e(a,b){let c=(0,d.useRef)(null),e=(0,d.useRef)(null);return(0,d.useCallback)(d=>{if(null===d){let a=c.current;a&&(c.current=null,a());let b=e.current;b&&(e.current=null,b())}else a&&(c.current=f(a,d)),b&&(e.current=f(b,d))},[a,b])}function f(a,b){if("function"!=typeof a)return a.current=b,()=>{a.current=null};{let c=a(b);return"function"==typeof c?c:()=>a(null)}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},92434,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"warnOnce",{enumerable:!0,get:function(){return d}});let d=a=>{}},68063,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={getDeploymentId:function(){return f},getDeploymentIdQueryOrEmptyString:function(){return g}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(){return!1}function g(){return""}},24767,a=>{"use strict";async function b(a,c={}){let d=new Headers(c.headers||{}),e="u">typeof FormData&&c.body instanceof FormData;return!c.body||e||d.has("Content-Type")||d.set("Content-Type","application/json"),c.auth,await fetch(a,{...c,headers:d})}a.s(["rpFetch",()=>b])},2622,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(24767);function f(){return new Date().toISOString().slice(0,10)}function g(a){let b=Number.isFinite(a)?a:0;return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(b)}function h(a){let b=String(a??"");return/[,"\n]/.test(b)?`"${b.replace(/"/g,'""')}"`:b}function i(){let[a,i]=(0,c.useState)("OVERDUE"),[j,k]=(0,c.useState)(f()),[l,m]=(0,c.useState)(f()),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(0),v=(0,c.useMemo)(()=>p.map((a,b)=>[`#${b+1} ${a.customerName} (${a.whatsapp})`,`Balance: Rs ${g(a.balance)}`,a.message,a.waLink,"------------------------------"].join("\n")).join("\n"),[p]);async function w(){o(!0),s(null),q([]),u(0);try{let b="STATEMENT"===a?`?type=STATEMENT&from=${encodeURIComponent(j)}&to=${encodeURIComponent(l)}`:"?type=OVERDUE",c=await (0,e.rpFetch)(`/api/customers/broadcast${b}`,{cache:"no-store"}),d=await c.json().catch(()=>({}));if(!c.ok||!d?.ok)throw Error(d?.error||"Failed to load broadcast list");q(d.list||[])}catch(a){s(a?.message||"Failed")}finally{o(!1)}}async function x(){if(p.length)try{await navigator.clipboard.writeText(v),alert("Copied ✅")}catch{let a=document.createElement("textarea");a.value=v,document.body.appendChild(a),a.select(),document.execCommand("copy"),a.remove(),alert("Copied ✅")}}return(0,b.jsxs)("div",{className:"rp-app",style:{padding:18},children:[(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[(0,b.jsx)(d.default,{href:"/customers",prefetch:!1,className:"rp-ui-btn rp-ui-btn--brand",children:"← Customers"}),(0,b.jsx)("div",{style:{fontWeight:950,fontSize:20},children:"WhatsApp Broadcast"}),(0,b.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:10,flexWrap:"wrap"},children:[(0,b.jsx)("button",{className:"rp-ui-btn",type:"button",onClick:x,disabled:!p.length,children:"Copy all"}),(0,b.jsxs)("button",{className:"rp-ui-btn rp-ui-btn--brand",type:"button",onClick:function(){if(!p.length)return;let a=Math.min(t,p.length-1),b=p[a];window.open(b.waLink,"_blank","noopener,noreferrer"),u(a=>Math.min(a+1,p.length-1))},disabled:!p.length,children:["Open next (",p.length?Math.min(t+1,p.length):0,"/",p.length,")"]}),(0,b.jsx)("button",{className:"rp-ui-btn rp-ui-btn--danger",type:"button",onClick:function(){if(!p.length)return;let b=new Blob([["Customer,WhatsApp,Balance,Message,waLink",...p.map(a=>[h(a.customerName),h(a.whatsapp),h(g(a.balance)),h(a.message),h(a.waLink)].join(","))].join("\n")],{type:"text/csv;charset=utf-8"}),c=URL.createObjectURL(b),d=document.createElement("a");d.href=c,d.download=`${"OVERDUE"===a?"overdue":"statement"}-whatsapp-links.csv`,document.body.appendChild(d),d.click(),d.remove(),setTimeout(()=>URL.revokeObjectURL(c),1e3)},disabled:!p.length,children:"Export CSV"})]})]}),(0,b.jsxs)("div",{className:"rp-card",style:{marginTop:14,padding:14,borderRadius:16},children:[(0,b.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"end"},children:[(0,b.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,b.jsx)("span",{style:{fontWeight:900},children:"Type"}),(0,b.jsxs)("select",{className:"rp-input",value:a,onChange:a=>i(a.target.value),style:{minWidth:220},children:[(0,b.jsx)("option",{value:"OVERDUE",children:"Overdue"}),(0,b.jsx)("option",{value:"STATEMENT",children:"Statement (Date Range)"})]})]}),"STATEMENT"===a?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,b.jsx)("span",{style:{fontWeight:900},children:"From"}),(0,b.jsx)("input",{className:"rp-input",type:"date",value:j,onChange:a=>k(a.target.value)})]}),(0,b.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,b.jsx)("span",{style:{fontWeight:900},children:"To"}),(0,b.jsx)("input",{className:"rp-input",type:"date",value:l,onChange:a=>m(a.target.value)})]})]}):null,(0,b.jsx)("button",{className:"rp-ui-btn rp-ui-btn--danger rp-glow",type:"button",onClick:w,disabled:n,children:n?"Loading…":"Generate List"})]}),r?(0,b.jsxs)("div",{style:{marginTop:10,padding:10,borderRadius:12,border:"1px solid rgba(0,0,0,.15)"},children:[(0,b.jsx)("b",{children:"Error:"})," ",r]}):null]}),(0,b.jsxs)("div",{className:"rp-card",style:{marginTop:14,padding:14,borderRadius:16},children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:10},children:[(0,b.jsxs)("div",{style:{fontWeight:950},children:["Results: ",p.length]}),(0,b.jsxs)("div",{style:{fontWeight:900,opacity:.75},children:["Tip: Use ",(0,b.jsx)("b",{children:"Open next"})," to send one-by-one."]})]}),(0,b.jsxs)("div",{style:{marginTop:12,display:"grid",gap:10},children:[p.map((a,c)=>(0,b.jsxs)("div",{style:{border:"1px solid rgba(0,0,0,.12)",borderRadius:14,padding:12,display:"grid",gap:8},children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:10,flexWrap:"wrap"},children:[(0,b.jsxs)("div",{style:{fontWeight:950},children:["#",c+1," ",a.customerName]}),(0,b.jsxs)("div",{style:{fontWeight:900},children:["Balance: Rs ",g(a.balance)]})]}),(0,b.jsxs)("div",{style:{opacity:.85,fontWeight:850},children:["WhatsApp: ",a.whatsapp]}),(0,b.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",background:"rgba(0,0,0,.04)",padding:10,borderRadius:12,border:"1px solid rgba(0,0,0,.08)",fontWeight:800},children:a.message}),(0,b.jsxs)("div",{style:{display:"flex",gap:10,flexWrap:"wrap",justifyContent:"flex-end"},children:[(0,b.jsx)("button",{className:"rp-ui-btn",type:"button",onClick:()=>window.open(a.waLink,"_blank","noopener,noreferrer"),children:"Open WhatsApp"}),(0,b.jsx)("button",{className:"rp-ui-btn rp-ui-btn--brand",type:"button",onClick:async()=>{try{await navigator.clipboard.writeText(a.waLink),alert("Link copied ✅")}catch{alert("Copy failed (browser blocked).")}},children:"Copy Link"})]})]},c)),p.length||n?null:(0,b.jsx)("div",{style:{opacity:.7,fontWeight:850,padding:10},children:"Generate a list above to see customers."})]})]})]})}a.s(["default",()=>i])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__6d8ecc95._.js.map