module.exports=[18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},11261,e=>{"use strict";let t=(0,e.i(24389).createClient)("https://ixvpeyelooxppkzqwmmd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4dnBleWVsb294cHBrenF3bW1kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzOTQ3NjgsImV4cCI6MjA4MDk3MDc2OH0.VrJVinxuWg3mU9O-2OaZ-xm8v5qdLyiJRXOZO6y2Lak",{auth:{persistSession:!1}});e.s(["supabase",0,t])},56096,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),s=e.i(59756),o=e.i(61916),n=e.i(74677),l=e.i(69741),i=e.i(16795),u=e.i(87718),c=e.i(95169),d=e.i(47587),p=e.i(66012),m=e.i(70101),_=e.i(26937),v=e.i(10372),x=e.i(93695);e.i(52474);var h=e.i(5232),f=e.i(89171),b=e.i(11261);function g(e){return!/^\d{4}-\d{2}-\d{2}$/.test(e)||Number.isNaN(new Date(e+"T00:00:00.000Z").getTime())?null:e}async function R(e){try{let t=e.nextUrl.searchParams,a=t.get("customerId"),r=(t.get("salesRep")||"").trim(),s=a&&/^\d+$/.test(a)?Number(a):null,o=r||null,n=t.get("from"),l=t.get("to"),i=null,u=null;if(n&&l){let e;i=g(n);let t=g(l);if(!i||!t)return f.NextResponse.json({ok:!1,error:"Invalid from/to. Expected YYYY-MM-DD"},{status:400});(e=new Date(t+"T00:00:00.000Z")).setUTCDate(e.getUTCDate()+1),u=e.toISOString().slice(0,10)}else{let e=t.get("month")||"",a=function(e){let[t,a]=e.split("-"),r=Number(t),s=Number(a);if(!r||!s||s<1||s>12)return null;let o=new Date(Date.UTC(r,s-1,1)),n=new Date(Date.UTC(r,s,1));return{fromStr:o.toISOString().slice(0,10),toExclusiveStr:n.toISOString().slice(0,10)}}(e);if(!a)return f.NextResponse.json({ok:!1,error:"Provide month=YYYY-MM OR from=YYYY-MM-DD&to=YYYY-MM-DD"},{status:400});i=a.fromStr,u=a.toExclusiveStr}let c=b.supabase.from("invoices").select(`
        id,
        invoice_number,
        invoice_date,
        customer_id,
        subtotal,
        total_amount,
        sales_rep,
        status,
        customers ( name )
      `).gte("invoice_date",i).lt("invoice_date",u);s&&(c=c.eq("customer_id",s)),o&&(c=c.eq("sales_rep",o));let{data:d,error:p}=await c;if(p)throw p;let m=(d||[]).map(e=>{var t;return{id:Number(e.id),invoice_number:e.invoice_number,invoice_date:e.invoice_date,customer_id:Number(e.customer_id),customer_name:(t=e.customers)?Array.isArray(t)?t[0]?.name??null:t?.name??null:null,subtotal:Number(e.subtotal||0),total_amount:Number(e.total_amount||0),sales_rep:(e.sales_rep||"—").trim(),status:e.status??null}})||[],_=m.filter(e=>{var t;return t=e.status,"PAID"===String(t||"").trim().toUpperCase()}),v=new Map;for(let e of m){let t=e.customer_id,a=v.get(t)||{customer_id:t,customer_name:e.customer_name,invoice_count:0,total_sales:0,subtotal_excl_vat:0};a.invoice_count+=1,a.total_sales+=e.total_amount,a.subtotal_excl_vat+=e.subtotal,v.set(t,a)}let x=Array.from(v.values()).map(e=>({customer_id:e.customer_id,customer_name:e.customer_name,invoice_count:e.invoice_count,total_sales:+e.total_sales.toFixed(2),subtotal_excl_vat:+e.subtotal_excl_vat.toFixed(2)})).sort((e,t)=>t.total_sales-e.total_sales),h=new Map;for(let e of m){let t=e.sales_rep||"—",a=h.get(t)||{sales_rep:t,invoice_count:0,total_sales:0,subtotal_excl_vat:0};a.invoice_count+=1,a.total_sales+=e.total_amount,a.subtotal_excl_vat+=e.subtotal,h.set(t,a)}let R=Array.from(h.values()).map(e=>({sales_rep:e.sales_rep,invoice_count:e.invoice_count,total_sales:+e.total_sales.toFixed(2),subtotal_excl_vat:+e.subtotal_excl_vat.toFixed(2)})).sort((e,t)=>t.total_sales-e.total_sales),w=new Map;for(let e of _){let t=e.sales_rep||"—",a=w.get(t)||{sales_rep:t,invoice_count:0,total_sales:0,subtotal_excl_vat:0};a.invoice_count+=1,a.total_sales+=e.total_amount,a.subtotal_excl_vat+=e.subtotal,w.set(t,a)}let C=Array.from(w.values()).map(e=>({sales_rep:e.sales_rep,invoice_count:e.invoice_count,total_sales:+e.total_sales.toFixed(2),subtotal_excl_vat:+e.subtotal_excl_vat.toFixed(2)})).sort((e,t)=>t.total_sales-e.total_sales),E=+m.reduce((e,t)=>e+t.subtotal,0).toFixed(2),y=+m.reduce((e,t)=>e+t.total_amount,0).toFixed(2),N=+_.reduce((e,t)=>e+t.subtotal,0).toFixed(2),A=+_.reduce((e,t)=>e+t.total_amount,0).toFixed(2),I={period:{from:i,toExclusive:u},filters:{customerId:s,salesRep:o},totals:{invoiceCountAll:m.length,subtotalExclVatAll:E,totalSalesAll:y,invoiceCountPaid:_.length,subtotalExclVatPaid:N,totalSalesPaid:A},byCustomer:x,bySalesRepAll:R,bySalesRepPaid:C,invoicesAll:m,invoicesPaid:_};return f.NextResponse.json({ok:!0,report:I})}catch(e){return console.error(e),f.NextResponse.json({ok:!1,error:e?.message||"Failed to build sales report"},{status:500})}}e.s(["GET",()=>R],6499);var w=e.i(6499);let C=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/reports/sales/route",pathname:"/api/reports/sales",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/reports/sales/route.ts",nextConfigOutput:"standalone",userland:w}),{workAsyncStorage:E,workUnitAsyncStorage:y,serverHooks:N}=C;function A(){return(0,r.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:y})}async function I(e,t,r){C.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/reports/sales/route";f=f.replace(/\/index$/,"")||"/";let b=await C.prepare(e,t,{srcPage:f,multiZoneDraftMode:!1});if(!b)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:g,params:R,nextConfig:w,parsedUrl:E,isDraftMode:y,prerenderManifest:N,routerServerContext:A,isOnDemandRevalidate:I,revalidateOnlyGenerated:O,resolvedPathname:S,clientReferenceManifest:T,serverActionsManifest:k}=b,D=(0,l.normalizeAppPath)(f),M=!!(N.dynamicRoutes[D]||N.routes[S]),P=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,E,!1):t.end("This page could not be found"),null);if(M&&!y){let e=!!N.routes[S],t=N.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await P();throw new x.NoFallbackError}}let j=null;!M||C.isDev||y||(j="/index"===(j=S)?"/":j);let U=!0===C.isDev||!M,q=M&&!U;k&&T&&(0,n.setManifestsSingleton)({page:f,clientReferenceManifest:T,serverActionsManifest:k});let F=e.method||"GET",H=(0,o.getTracer)(),Y=H.getActiveScopeSpan(),$={params:R,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,s)=>C.onRequestError(e,t,r,s,A)},sharedContext:{buildId:g}},J=new i.NodeNextRequest(e),B=new i.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest(J,(0,u.signalFromNodeResponse)(t));try{let n=async e=>C.handle(K,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=H.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${F} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${f}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),i=async s=>{var o,i;let u=async({previousCacheEntry:a})=>{try{if(!l&&I&&O&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await n(s);e.fetchMetrics=$.renderOpts.fetchMetrics;let i=$.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let u=$.renderOpts.collectedTags;if(!M)return await (0,p.sendResponse)(J,B,o,$.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[v.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,r=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:I})},!1,A),t}},c=await C.handleResponse({req:e,nextConfig:w,cacheKey:j,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:O,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:l});if(!M)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(i=c.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",I?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),y&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let x=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&M||x.delete(v.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||x.get("Cache-Control")||x.set("Cache-Control",(0,_.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(J,B,new Response(c.value.body,{headers:x,status:c.value.status||200})),null};Y?await i(Y):await H.withPropagatedContext(e.headers,()=>H.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${f}`,kind:o.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},i))}catch(t){if(t instanceof x.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:I})},!1,A),M)throw t;return await (0,p.sendResponse)(J,B,new Response(null,{status:500})),null}}e.s(["handler",()=>I,"patchFetch",()=>A,"routeModule",()=>C,"serverHooks",()=>N,"workAsyncStorage",()=>E,"workUnitAsyncStorage",()=>y],56096)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f7cdc517._.js.map