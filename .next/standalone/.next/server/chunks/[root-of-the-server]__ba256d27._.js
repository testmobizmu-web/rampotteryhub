module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},60708,e=>{"use strict";var t=e.i(24389);function r(e){if(!e)return null;try{return JSON.parse(e)}catch{return null}}function a(e){return!!e&&"admin"===String(e.role||"").toLowerCase()}function i(e){let t=Number(e??0);return Number.isFinite(t)?t:0}async function n(e){let r,a=(r=process.env.SUPABASE_SERVICE_ROLE_KEY,(0,t.createClient)("https://ixvpeyelooxppkzqwmmd.supabase.co",r||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4dnBleWVsb294cHBrenF3bW1kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzOTQ3NjgsImV4cCI6MjA4MDk3MDc2OH0.VrJVinxuWg3mU9O-2OaZ-xm8v5qdLyiJRXOZO6y2Lak")),{data:n,error:s}=await a.from("invoices").select("id,status,total_amount,previous_balance,gross_total").eq("id",e).single();if(s)throw Error(s.message);let o=String(n?.status||"").toUpperCase().trim(),l=i(n?.total_amount),p=i(n?.previous_balance),u=n?.gross_total!=null?i(n.gross_total):l+p,{data:d,error:c}=await a.from("invoice_payments").select("amount").eq("invoice_id",e);if(c)throw Error(c.message);let m=(d||[]).reduce((e,t)=>e+i(t.amount),0),x=Math.max(0,u-m),I=function(e,t,r){if("VOID"===String(r||"").toUpperCase().trim())return"VOID";let a=Math.max(0,e),i=Math.max(0,t);return i<=0?"ISSUED":i+1e-5>=a?"PAID":"PARTIALLY_PAID"}(u,m,o),{error:g}=await a.from("invoices").update({amount_paid:m,balance_due:x,balance_remaining:x,gross_total:u,status:I,updated_at:new Date().toISOString()}).eq("id",e);if(g)throw Error(g.message);return{invoiceId:Number(n?.id),paid:+m.toFixed(2),balance:+x.toFixed(2),status:I,grossTotal:+u.toFixed(2),totalAmount:+l.toFixed(2),previousBalance:+p.toFixed(2)}}e.s(["canDeletePayments",()=>a,"getUserFromHeader",()=>r,"recalcInvoicePaymentState",()=>n])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ba256d27._.js.map