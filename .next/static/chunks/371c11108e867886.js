(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,s,a)=>{s.exports=e.r(76562)},24985,e=>{"use strict";var s=e.i(43476),a=e.i(71645),l=e.i(18566);let t=[{key:"canViewReports",label:"Can view reports"},{key:"canEditInvoices",label:"Can create/edit invoices"},{key:"canEditPayments",label:"Can record payments"},{key:"canVoidInvoices",label:"Can void invoices/credit notes"},{key:"canEditStock",label:"Can edit stock"},{key:"canManageUsers",label:"Can manage users"}];function i(){let e=(0,l.useParams)(),i=(0,l.useRouter)(),n=e.id,[c,r]=(0,a.useState)(!0),[d,o]=(0,a.useState)(!1),[u,x]=(0,a.useState)(null),[m,p]=(0,a.useState)(""),[h,v]=(0,a.useState)(""),[y,j]=(0,a.useState)(""),[b,f]=(0,a.useState)("sales"),[g,N]=(0,a.useState)(!0),[k,C]=(0,a.useState)({});async function w(){try{r(!0),x(null);let e=await fetch(`/api/admin/users/${n}`,{cache:"no-store"}),s=await e.json();if(!e.ok||!s.ok)throw Error(s.error||"Failed");let a=s.user;p(a.username||""),v(a.full_name||""),j(a.phone||""),f(a.role||"sales"),N(!!a.is_active),C(a.permissions||{})}catch(e){x(e?.message||"Error")}finally{r(!1)}}(0,a.useEffect)(()=>{w()},[n]);let S=(0,a.useMemo)(()=>!0,[m,h,y,b,g,k]);async function E(e){try{o(!0),x(null);let s=await fetch(`/api/admin/users/${n}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({full_name:h,phone:y,role:b,is_active:g,permissions:k,applyPreset:e})}),a=await s.json();if(!s.ok||!a.ok)throw Error(a.error||"Failed");i.push("/admin/users")}catch(e){x(e?.message||"Error")}finally{o(!1)}}return c?(0,s.jsx)("div",{className:"text-sm opacity-70",children:"Loading…"}):(0,s.jsxs)("div",{className:"max-w-3xl space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:"Edit User"}),(0,s.jsx)("p",{className:"text-sm opacity-70",children:m})]}),(0,s.jsx)("button",{className:"px-4 py-2 rounded-xl border",onClick:()=>i.push("/admin/users"),children:"Back"})]}),u&&(0,s.jsx)("div",{className:"p-3 rounded-xl border text-sm",children:u}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"rounded-2xl border p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"text-sm opacity-70",children:"Full name"}),(0,s.jsx)("input",{className:"w-full border rounded-xl px-3 py-2",value:h,onChange:e=>v(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"text-sm opacity-70",children:"Phone"}),(0,s.jsx)("input",{className:"w-full border rounded-xl px-3 py-2",value:y,onChange:e=>j(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"text-sm opacity-70",children:"Role"}),(0,s.jsxs)("select",{className:"w-full border rounded-xl px-3 py-2",value:b,onChange:e=>f(e.target.value),children:[(0,s.jsx)("option",{value:"admin",children:"admin"}),(0,s.jsx)("option",{value:"accounting",children:"accounting"}),(0,s.jsx)("option",{value:"sales",children:"sales"}),(0,s.jsx)("option",{value:"viewer",children:"viewer"})]})]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:g,onChange:e=>N(e.target.checked)}),"Active"]}),(0,s.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,s.jsx)("button",{disabled:d||!S,className:"px-4 py-2 rounded-xl border",onClick:()=>E(!1),children:d?"Saving…":"Save"}),(0,s.jsx)("button",{disabled:d,className:"px-4 py-2 rounded-xl border",onClick:()=>E(!0),children:"Apply Preset + Save"})]})]}),(0,s.jsxs)("div",{className:"rounded-2xl border p-4 space-y-3",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"Permissions"}),(0,s.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:!!k[e.key],onChange:()=>{var s;return s=e.key,void C(e=>({...e,[s]:!e[s]}))}}),e.label]},e.key))})]})]})]})}e.s(["default",()=>i])}]);