{"version":3,"sources":["../../../../app/invoices/new/NewInvoiceClient.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { rpFetch } from \"@/lib/rpFetch\";\r\nimport RamPotteryDoc from \"@/components/print/RamPotteryDoc\";\r\n\r\ntype CustomerRow = {\r\n  id: number;\r\n  name: string;\r\n  address: string;\r\n  phone: string;\r\n  whatsapp?: string;\r\n  brn?: string;\r\n  vat_no?: string;\r\n  customer_code: string;\r\n  opening_balance?: number | null;\r\n  discount_percent?: number | null;\r\n};\r\n\r\ntype ProductRow = {\r\n  id: number;\r\n  item_code: string;\r\n  sku: string;\r\n  name: string;\r\n  description: string;\r\n  units_per_box: number | null;\r\n\r\n  // ‚úÖ MUST MATCH API\r\n  price_excl_vat: number;\r\n  vat_rate: number;\r\n};\r\n\r\ntype Uom = \"BOX\" | \"PCS\";\r\n\r\ntype InvoiceLine = {\r\n  id: string;\r\n  product_id: number | null;\r\n\r\n  item_code: string;\r\n  description: string;\r\n\r\n  uom: Uom;\r\n  box_qty: number; // qty input (box qty or pcs qty depending on uom)\r\n  units_per_box: number;\r\n  total_qty: number;\r\n\r\n  vat_rate: number; // 0 or 15\r\n  unit_price_excl_vat: number;\r\n  unit_vat: number;\r\n  unit_price_incl_vat: number;\r\n  line_total: number;\r\n};\r\n\r\n/* ===========================\r\n   ‚úÖ Sales reps (premium picker)\r\n   =========================== */\r\nconst SALES_REPS = [\r\n  { name: \"Mr Koushal\", phone: \"59193239\" },\r\n  { name: \"Mr Akash\", phone: \"57788884\" },\r\n  { name: \"Mr Manish\", phone: \"57788884\" },\r\n  { name: \"Mr Adesh\", phone: \"58060268\" },\r\n] as const;\r\n\r\ntype SalesRepName = (typeof SALES_REPS)[number][\"name\"];\r\n\r\nfunction repPhoneByName(name: string) {\r\n  const r = SALES_REPS.find((x) => x.name === name);\r\n  return r?.phone || \"\";\r\n}\r\n\r\nfunction n2(v: any) {\r\n  const x = Number(v ?? 0);\r\n  return Number.isFinite(x) ? x : 0;\r\n}\r\n\r\n/** ‚úÖ Commas + decimals only when needed (or force2 for money) */\r\nfunction fmtNumber(v: any, force2 = false) {\r\n  const x = n2(v);\r\n  const hasDecimals = Math.abs(x % 1) > 0.000001;\r\n  const minFrac = force2 ? 2 : hasDecimals ? 2 : 0;\r\n  const maxFrac = 2;\r\n  return new Intl.NumberFormat(\"en-US\", {\r\n    minimumFractionDigits: minFrac,\r\n    maximumFractionDigits: maxFrac,\r\n  }).format(x);\r\n}\r\n\r\nfunction money(v: any) {\r\n  // money values always show .00\r\n  return fmtNumber(v, true);\r\n}\r\n\r\nfunction intFmt(v: any) {\r\n  return new Intl.NumberFormat(\"en-US\", { maximumFractionDigits: 0 }).format(\r\n    Math.trunc(n2(v))\r\n  );\r\n}\r\n\r\nfunction uid() {\r\n  try {\r\n    return crypto.randomUUID();\r\n  } catch {\r\n    return String(Date.now()) + \"-\" + Math.random().toString(16).slice(2);\r\n  }\r\n}\r\n\r\nfunction clampPct(v: any) {\r\n  const x = n2(v);\r\n  return Math.max(0, Math.min(100, x));\r\n}\r\n\r\nfunction recalc(row: InvoiceLine): InvoiceLine {\r\n  const qtyInput = Math.max(0, n2(row.box_qty));\r\n  const uom: Uom = row.uom === \"PCS\" ? \"PCS\" : \"BOX\";\r\n  const upb = uom === \"PCS\" ? 1 : Math.max(1, Math.trunc(n2(row.units_per_box) || 1));\r\n\r\n  const totalQty = uom === \"PCS\" ? Math.trunc(qtyInput) : Math.trunc(qtyInput * upb);\r\n\r\n  const unitEx = Math.max(0, n2(row.unit_price_excl_vat)); // ‚úÖ already discounted if needed\r\n  const rate = row.vat_rate === 0 ? 0 : 15;\r\n\r\n  const unitVat = unitEx * (rate / 100);\r\n  const unitInc = unitEx + unitVat;\r\n\r\n  return {\r\n    ...row,\r\n    uom,\r\n    units_per_box: upb,\r\n    total_qty: totalQty,\r\n    vat_rate: rate,\r\n    unit_vat: unitVat,\r\n    unit_price_incl_vat: unitInc,\r\n    line_total: totalQty * unitInc,\r\n  };\r\n}\r\n\r\nfunction blankLine(): InvoiceLine {\r\n  return recalc({\r\n    id: uid(),\r\n    product_id: null,\r\n    item_code: \"\",\r\n    description: \"\",\r\n    uom: \"BOX\",\r\n    box_qty: 0,\r\n    units_per_box: 1,\r\n    total_qty: 0,\r\n    vat_rate: 15,\r\n    unit_price_excl_vat: 0,\r\n    unit_vat: 0,\r\n    unit_price_incl_vat: 0,\r\n    line_total: 0,\r\n  });\r\n}\r\n\r\nfunction roleUpper(r?: string) {\r\n  return String(r || \"\").toUpperCase();\r\n}\r\nfunction canDuplicate(role?: string) {\r\n  const r = roleUpper(role);\r\n  return r === \"ADMIN\" || r === \"MANAGER\";\r\n}\r\n\r\nfunction formatDDMMYYYY(v: any) {\r\n  const s = String(v || \"\").trim();\r\n  const m = s.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\r\n  if (m) return `${m[3]}/${m[2]}/${m[1]}`;\r\n  return s;\r\n}\r\n\r\n/* ===========================\r\n   ‚úÖ Company vs Client selector\r\n   =========================== */\r\nfunction guessPartyType(name: string) {\r\n  const s = String(name || \"\").toUpperCase();\r\n  return /LTD|LIMITED|CO\\.|COMPANY|TRADING|ENTERPRISE|INC|LLC/.test(s) ? \"COMPANY\" : \"CLIENT\";\r\n}\r\n\r\nfunction normalizeMuPhone(phone: string) {\r\n  // returns digits only (Mauritius default +230)\r\n  const digits = String(phone || \"\").replace(/[^\\d]/g, \"\");\r\n  if (!digits) return \"\";\r\n  // already has country code\r\n  if (digits.startsWith(\"230\") && digits.length >= 11) return digits;\r\n  // local 8-digit number\r\n  if (digits.length === 8) return \"230\" + digits;\r\n  return digits;\r\n}\r\n\r\nexport default function NewInvoiceClient() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const duplicateId = searchParams.get(\"duplicate\");\r\n\r\n  const [saving, setSaving] = useState(false);\r\n  const [printing, setPrinting] = useState(false);\r\n\r\n  const [customers, setCustomers] = useState<CustomerRow[]>([]);\r\n  const [products, setProducts] = useState<ProductRow[]>([]);\r\n\r\n  const [customerId, setCustomerId] = useState<number | null>(null);\r\n  const [invoiceDate, setInvoiceDate] = useState<string>(\"\");\r\n  const [purchaseOrderNo, setPurchaseOrderNo] = useState(\"\");\r\n\r\n  const [removingIds, setRemovingIds] = useState<Set<string>>(new Set());\r\n\r\n  // ‚úÖ reps picker\r\n  const [repOpen, setRepOpen] = useState(false);\r\n  const [salesReps, setSalesReps] = useState<SalesRepName[]>([]);\r\n  const [salesRepPhones, setSalesRepPhones] = useState<string>(\"\");\r\n\r\n  const [previousBalance, setPreviousBalance] = useState<number>(0);\r\n  const [amountPaid, setAmountPaid] = useState<number>(0);\r\n\r\n  const [prevTouched, setPrevTouched] = useState(false);\r\n  const [paidTouched, setPaidTouched] = useState(false);\r\n\r\n  // ‚úÖ party-wise discount MUST be automatic\r\n  const [discountPercent, setDiscountPercent] = useState<number>(0);\r\n\r\n  const [vatPercent, setVatPercent] = useState<number>(15);\r\n\r\n  const [invoiceNumber, setInvoiceNumber] = useState<string>(\"(Auto when saved)\");\r\n  const [lines, setLines] = useState<InvoiceLine[]>([]);\r\n\r\n  useEffect(() => {\r\n  setLines((prev) =>\r\n    prev.map((r) => {\r\n      if (!r.product_id) return r;\r\n      const p = products.find((x) => x.id === r.product_id);\r\n      if (!p) return r;\r\n\r\n      const baseEx = Number(p.price_excl_vat || 0);\r\n      const disc = Math.max(0, Math.min(100, n2(discountPercent)));\r\n      const discountedEx = baseEx * (1 - disc / 100);\r\n\r\n      return recalc({ ...r, unit_price_excl_vat: discountedEx } as InvoiceLine);\r\n    })\r\n  );\r\n}, [discountPercent, products]);\r\n\r\n\r\n  const [dupFromNo, setDupFromNo] = useState<string | null>(null);\r\n  const [role, setRole] = useState<string>(\"\");\r\n\r\n  // Product search modal\r\n  const [searchOpen, setSearchOpen] = useState(false);\r\n  const [searchRowId, setSearchRowId] = useState<string | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n\r\n  // Customer search modal\r\n  const [custSearchOpen, setCustSearchOpen] = useState(false);\r\n  const [custSearchTerm, setCustSearchTerm] = useState(\"\");\r\n\r\n  // ‚úÖ Customer Name Type (Company / Client)\r\n  const [customerNameType, setCustomerNameType] = useState<\"COMPANY\" | \"CLIENT\">(\"COMPANY\");\r\n  const [customerNameTypeTouched, setCustomerNameTypeTouched] = useState(false);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const raw = localStorage.getItem(\"rp_user\");\r\n      if (raw) {\r\n        const u = JSON.parse(raw);\r\n        setRole(String(u?.role || \"\"));\r\n      }\r\n    } catch {}\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setInvoiceDate(new Date().toISOString().slice(0, 10));\r\n    setLines([blankLine()]);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let alive = true;\r\n    (async () => {\r\n      try {\r\n        const [cRes, pRes] = await Promise.all([\r\n          rpFetch(\"/api/customers/list\", { cache: \"no-store\" }),\r\n          rpFetch(\"/api/products/list\", { cache: \"no-store\" }),\r\n        ]);\r\n\r\n        const cJson = cRes.ok ? await cRes.json() : {};\r\n        const pJson = pRes.ok ? await pRes.json() : {};\r\n\r\n        if (!alive) return;\r\n        setCustomers(cJson.customers || []);\r\n        setProducts(pJson.products || []);\r\n      } catch {}\r\n    })();\r\n    return () => {\r\n      alive = false;\r\n    };\r\n  }, []);\r\n\r\n \r\nconst customer = useMemo(\r\n  () => customers.find((c) => c.id === customerId) || null,\r\n  [customers, customerId]\r\n);\r\n\r\nconst hasWhatsApp = useMemo(() => {\r\n  const raw = customer?.whatsapp || customer?.phone || \"\";\r\n  const d = String(raw).replace(/[^\\d]/g, \"\");\r\n  return d.length > 0;\r\n}, [customer?.whatsapp, customer?.phone]);\r\n\r\n\r\n{hasWhatsApp ? (\r\n  <button\r\n    type=\"button\"\r\n    className=\"rp-btn rp-btn--ghost\"\r\n    disabled={!customerId}\r\n    title=\"Send payment update on WhatsApp\"\r\n    onClick={() => {\r\n      if (n2(amountPaid) <= 0) {\r\n        alert(\"Enter an amount paid to send payment update.\");\r\n        return;\r\n      }\r\n      openWhatsAppPaymentUpdate(n2(amountPaid));\r\n    }}\r\n  >\r\n    WhatsApp\r\n  </button>\r\n) : null}\r\n\r\n\r\n \r\n  // customer-wise auto-fill (discount is always automatic)\r\n  useEffect(() => {\r\n    if (!customerId) return;\r\n\r\n    if (!prevTouched) setPreviousBalance(n2(customer?.opening_balance ?? 0));\r\n    if (!paidTouched) setAmountPaid(0);\r\n\r\n    // ‚úÖ ALWAYS auto party discount\r\n    setDiscountPercent(n2(customer?.discount_percent ?? 0));\r\n\r\n    // ‚úÖ auto company/client from customer name (if user didn‚Äôt touch selector)\r\n    if (!customerNameTypeTouched && customer?.name) {\r\n\r\n      setCustomerNameType(guessPartyType(customer.name));\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [\r\n    customerId,\r\n    customer?.opening_balance,\r\n    customer?.discount_percent,\r\n    customer?.name,\r\n    prevTouched,\r\n    paidTouched,\r\n    customerNameTypeTouched,\r\n  ]);\r\n\r\n  // Close rep popup on outside click\r\n  useEffect(() => {\r\n    function close() {\r\n      setRepOpen(false);\r\n    }\r\n    if (!repOpen) return;\r\n    window.addEventListener(\"mousedown\", close);\r\n    return () => window.removeEventListener(\"mousedown\", close);\r\n  }, [repOpen]);\r\n\r\n  // DUPLICATE PREFILL\r\n  useEffect(() => {\r\n    if (!duplicateId) return;\r\n\r\n    if (!canDuplicate(role)) {\r\n      alert(\"Only Admin / Manager can duplicate invoices.\");\r\n      router.replace(\"/invoices\");\r\n      return;\r\n    }\r\n\r\n    let alive = true;\r\n\r\n    (async () => {\r\n      try {\r\n        // ‚úÖ IMPORTANT: your working API file is /api/invoices/[id]\r\n        const res = await rpFetch(`/api/invoices/${duplicateId}`, { cache: \"no-store\" });\r\n        const json = await res.json();\r\n        if (!json?.ok || !alive) return;\r\n\r\n        const inv = json.invoice;\r\n        const items = json.items || [];\r\n\r\n        setDupFromNo(String(inv.invoice_number || duplicateId));\r\n\r\n        setCustomerId(inv.customer_id);\r\n        setPurchaseOrderNo(inv.purchase_order_no || \"\");\r\n\r\n        const repText = String(inv.sales_rep || \"\").trim();\r\n        const repList = repText\r\n          ? repText.split(\",\").map((s: string) => s.trim()).filter(Boolean)\r\n          : [];\r\n        setSalesReps(repList as SalesRepName[]);\r\n        setSalesRepPhones(String(inv.sales_rep_phone || \"\"));\r\n\r\n        const invType = String(inv.party_type || inv.customer_name_type || \"\").toUpperCase();\r\n        if (invType === \"COMPANY\" || invType === \"CLIENT\") {\r\n          setCustomerNameTypeTouched(true);\r\n          setCustomerNameType(invType as any);\r\n        }\r\n\r\n        setPreviousBalance(0);\r\n        setAmountPaid(0);\r\n        setPrevTouched(false);\r\n        setPaidTouched(false);\r\n\r\n        const invVat = n2(inv.vat_percent ?? 15) === 0 ? 0 : 15;\r\n        setVatPercent(invVat);\r\n\r\n        // ‚úÖ discount auto from customer anyway, but keep what invoice had if any\r\n        setDiscountPercent(n2(inv.discount_percent ?? 0));\r\n\r\n        const cloned = items.map((it: any) =>\r\n          recalc({\r\n            id: uid(),\r\n            product_id: it.product_id,\r\n            item_code: it.products?.item_code || \"\",\r\n            description: it.description || it.products?.name || \"\",\r\n            uom: it.uom || \"BOX\",\r\n            box_qty: it.box_qty || 0,\r\n            units_per_box: it.units_per_box || 1,\r\n            total_qty: it.total_qty || 0,\r\n            vat_rate: n2(it.vat_rate ?? (it.unit_vat > 0 ? 15 : 0)) === 0 ? 0 : 15,\r\n            unit_price_excl_vat: it.unit_price_excl_vat || 0,\r\n            unit_vat: it.unit_vat || 0,\r\n            unit_price_incl_vat: it.unit_price_incl_vat || 0,\r\n            line_total: it.line_total || 0,\r\n          })\r\n        );\r\n\r\n        setLines(cloned.length ? cloned : [blankLine()]);\r\n      } catch {}\r\n    })();\r\n\r\n    return () => {\r\n      alive = false;\r\n    };\r\n  }, [duplicateId, role, router]);\r\n\r\n  const realLines = useMemo(() => lines.filter((l) => !!l.product_id), [lines]);\r\n\r\n  const subtotalEx = useMemo(\r\n    () => realLines.reduce((sum, r) => sum + n2(r.total_qty) * n2(r.unit_price_excl_vat), 0),\r\n    [realLines]\r\n  );\r\n  const vatAmount = useMemo(\r\n    () => realLines.reduce((sum, r) => sum + n2(r.total_qty) * n2(r.unit_vat), 0),\r\n    [realLines]\r\n  );\r\n  \r\n\r\n  const totalAmount = useMemo(() => subtotalEx + vatAmount, [subtotalEx, vatAmount]);\r\n\r\n// Optional: show discount amount as \"saved amount\" for display (compare with original)\r\nconst discountAmount = useMemo(() => {\r\n  const dp = Math.max(0, Math.min(100, n2(discountPercent)));\r\n  if (dp <= 0) return 0;\r\n\r\n  // Rebuild \"original total\" by reversing discount from each unitEx\r\n  const originalSubtotalEx = realLines.reduce((sum, r) => {\r\n    const qty = n2(r.total_qty);\r\n    const discountedUnitEx = n2(r.unit_price_excl_vat);\r\n    const originalUnitEx = dp >= 100 ? 0 : discountedUnitEx / (1 - dp / 100);\r\n    return sum + qty * originalUnitEx;\r\n  }, 0);\r\n\r\n  const originalVat = realLines.reduce((sum, r) => {\r\n    const qty = n2(r.total_qty);\r\n    const rate = n2(r.vat_rate) === 0 ? 0 : 15;\r\n    const discountedUnitEx = n2(r.unit_price_excl_vat);\r\n    const originalUnitEx = dp >= 100 ? 0 : discountedUnitEx / (1 - dp / 100);\r\n    return sum + qty * (originalUnitEx * (rate / 100));\r\n  }, 0);\r\n\r\n  const originalTotal = originalSubtotalEx + originalVat;\r\n  const discountedTotal = totalAmount;\r\n\r\n  return Math.max(0, originalTotal - discountedTotal);\r\n}, [realLines, discountPercent, totalAmount]);\r\n\r\n\r\n  const grossTotal = useMemo(() => totalAmount + n2(previousBalance), [totalAmount, previousBalance]);\r\n\r\n  const balanceRemaining = useMemo(\r\n    () => Math.max(0, grossTotal - n2(amountPaid)),\r\n    [grossTotal, amountPaid]\r\n  );\r\n\r\n  function setLine(id: string, patch: Partial<InvoiceLine>) {\r\n  setLines((prev) =>\r\n    prev.map((r) => (r.id === id ? recalc({ ...r, ...patch } as InvoiceLine) : r))\r\n  );\r\n}\r\n\r\n  function addRow() {\r\n    setLines((prev) => [...prev, blankLine()]);\r\n  }\r\n\r\n  function removeRow(id: string) {\r\n    setRemovingIds((prev) => new Set(prev).add(id));\r\n\r\n    window.setTimeout(() => {\r\n      setLines((prev) => (prev.length <= 1 ? prev : prev.filter((r) => r.id !== id)));\r\n      setRemovingIds((prev) => {\r\n        const next = new Set(prev);\r\n        next.delete(id);\r\n        return next;\r\n      });\r\n    }, 190); // matches CSS animation\r\n  }\r\n\r\n  useEffect(() => {\r\n    const done = () => setPrinting(false);\r\n    window.addEventListener(\"afterprint\", done);\r\n    return () => window.removeEventListener(\"afterprint\", done);\r\n  }, []);\r\n\r\n  \r\n  const invoiceDatePrint = formatDDMMYYYY(invoiceDate);\r\n\r\n\r\n  function openWhatsApp() {\r\n  const phone = normalizeMuPhone(customer?.whatsapp || customer?.phone || \"\");\r\n\r\n  if (!phone) {\r\n    alert(\"Customer WhatsApp / phone number is missing. Add it in customer profile.\");\r\n    return;\r\n  }\r\n\r\n  const text = buildWhatsAppText({\r\n    invoiceNo: invoiceNumber,\r\n    customerName: customer?.name || \"\",\r\n    total: totalAmount,\r\n    gross: grossTotal,\r\n    paid: amountPaid,\r\n    balance: balanceRemaining,\r\n    date: invoiceDatePrint,\r\n  });\r\n\r\n  const url = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;\r\n  window.open(url, \"_blank\", \"noopener,noreferrer\");\r\n}\r\n\r\n\r\n  useEffect(() => {\r\n    function onKeyDown(e: KeyboardEvent) {\r\n      // ignore if modal/popup open\r\n      if (searchOpen || custSearchOpen || repOpen) return;\r\n\r\n      const el = e.target as HTMLElement | null;\r\n      const tag = (el?.tagName || \"\").toLowerCase();\r\n      const isTyping = tag === \"input\" || tag === \"textarea\" || tag === \"select\";\r\n\r\n      // SHIFT+ENTER => SAVE (even if typing)\r\n      if (e.key === \"Enter\" && e.shiftKey) {\r\n        e.preventDefault();\r\n        onSave();\r\n        return;\r\n      }\r\n\r\n      // ENTER => add row (only when NOT typing)\r\n      if (e.key === \"Enter\" && !e.shiftKey && !isTyping) {\r\n        e.preventDefault();\r\n\r\n        // pulse button (optional)\r\n        const addBtn = document.querySelector(\".inv-actions-right .rp-btn\") as\r\n          | HTMLButtonElement\r\n          | null;\r\n        if (addBtn) {\r\n          addBtn.classList.remove(\"is-pulse\");\r\n          void addBtn.offsetWidth;\r\n          addBtn.classList.add(\"is-pulse\");\r\n        }\r\n\r\n        addRow();\r\n\r\n        // focus next row qty input\r\n        setTimeout(() => {\r\n          const qtyInputs = Array.from(\r\n            document.querySelectorAll<HTMLInputElement>(\".inv-input--qtywide\")\r\n          );\r\n          const last = qtyInputs[qtyInputs.length - 1];\r\n          last?.focus();\r\n          last?.select?.();\r\n        }, 0);\r\n\r\n        return;\r\n      }\r\n\r\n      // CTRL+P => PRINT\r\n      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === \"p\") {\r\n        e.preventDefault();\r\n        onPrint();\r\n        return;\r\n      }\r\n\r\n      // CTRL+W => WhatsApp (prevent tab close)\r\n      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === \"w\") {\r\n        e.preventDefault();\r\n        openWhatsApp();\r\n        return;\r\n      }\r\n    }\r\n\r\n    window.addEventListener(\"keydown\", onKeyDown);\r\n    return () => window.removeEventListener(\"keydown\", onKeyDown);\r\n  }, [searchOpen, custSearchOpen, repOpen, customerId, lines.length]);\r\n\r\nfunction applyProductToRow(rowId: string, product: ProductRow | null) {\r\n  setLines((prev) =>\r\n    prev.map((r) => {\r\n      if (r.id !== rowId) return r;\r\n\r\n      if (!product) {\r\n        return recalc({\r\n          ...r,\r\n          product_id: null,\r\n          item_code: \"\",\r\n          description: \"\",\r\n          units_per_box: 1,\r\n          unit_price_excl_vat: 0,\r\n          vat_rate: vatPercent === 0 ? 0 : 15,\r\n          uom: \"BOX\",\r\n          box_qty: 0,\r\n        });\r\n      }\r\n\r\n      const baseEx = Number(product.price_excl_vat || 0);\r\n      const disc = Math.max(0, Math.min(100, n2(discountPercent)));\r\n      const discountedEx = baseEx * (1 - disc / 100);\r\n\r\n      return recalc({\r\n        ...r,\r\n        product_id: product.id,\r\n        item_code: product.item_code || product.sku || \"\",\r\n        description: (product.description || product.name || \"\").trim(),\r\n        units_per_box: Math.max(1, Number(product.units_per_box || 1)),\r\n        unit_price_excl_vat: discountedEx,\r\n        vat_rate: vatPercent === 0 ? 0 : 15,\r\n        uom: \"BOX\",\r\n        box_qty: Math.max(1, Math.trunc(Number(r.box_qty || 1))),\r\n      });\r\n    })\r\n  );\r\n}\r\n\r\n\r\n  function openSearchForRow(rowId: string) {\r\n    setSearchRowId(rowId);\r\n    setSearchTerm(\"\");\r\n    setSearchOpen(true);\r\n  }\r\n\r\n  function closeSearch() {\r\n    setSearchOpen(false);\r\n    setSearchRowId(null);\r\n    setSearchTerm(\"\");\r\n  }\r\n\r\n  const filteredProducts = useMemo(() => {\r\n    const t = searchTerm.trim().toLowerCase();\r\n    if (!t) return products;\r\n    return products.filter((p) => {\r\n      const code = String(p.item_code || \"\").toLowerCase();\r\n      const sku = String(p.sku || \"\").toLowerCase();\r\n      const name = String(p.name || \"\").toLowerCase();\r\n      const desc = String(p.description || \"\").toLowerCase();\r\n      return code.includes(t) || sku.includes(t) || name.includes(t) || desc.includes(t);\r\n    });\r\n  }, [products, searchTerm]);\r\n\r\n  const filteredCustomers = useMemo(() => {\r\n    const t = custSearchTerm.trim().toLowerCase();\r\n    if (!t) return customers;\r\n    return customers.filter((c) => {\r\n      const name = String(c.name || \"\").toLowerCase();\r\n      const phone = String(c.phone || \"\").toLowerCase();\r\n      const code = String(c.customer_code || \"\").toLowerCase();\r\n      const addr = String(c.address || \"\").toLowerCase();\r\n      return name.includes(t) || phone.includes(t) || code.includes(t) || addr.includes(t);\r\n    });\r\n  }, [customers, custSearchTerm]);\r\n\r\n  function openCustomerSearch() {\r\n    setCustSearchTerm(\"\");\r\n    setCustSearchOpen(true);\r\n  }\r\n\r\n  function closeCustomerSearch() {\r\n    setCustSearchOpen(false);\r\n    setCustSearchTerm(\"\");\r\n  }\r\n  \r\n  // üîî WhatsApp payment update message\r\nfunction buildWhatsAppPaymentText(opts: {\r\n  invoiceNo: string;\r\n  customerName: string;\r\n  date: string;\r\n  paidNow: number;\r\n  grossTotal: number;\r\n  balanceRemaining: number;\r\n}) {\r\n  const status =\r\n    opts.paidNow >= opts.grossTotal && opts.grossTotal > 0\r\n      ? \"PAID ‚úÖ\"\r\n      : opts.paidNow > 0\r\n      ? \"PARTIALLY PAID ‚úÖ\"\r\n      : \"PENDING\";\r\n\r\n  return [\r\n    `RAM POTTERY LTD`,\r\n    `Payment update for your invoice`,\r\n    ``,\r\n    `Invoice No: ${opts.invoiceNo}`,\r\n    `Date: ${opts.date}`,\r\n    `Customer: ${opts.customerName}`,\r\n    `Status: ${status}`,\r\n    ``,\r\n    `Amount Paid: Rs ${money(opts.paidNow)}`,\r\n    `Balance Remaining: Rs ${money(opts.balanceRemaining)}`,\r\n    ``,\r\n    `Thank you.`,\r\n  ].join(\"\\n\");\r\n}\r\n \r\n   // üßæ WhatsApp invoice summary message\r\n   function buildWhatsAppText(opts: {\r\n  invoiceNo: string;\r\n  customerName: string;\r\n  total: number;\r\n  gross: number;\r\n  paid: number;\r\n  balance: number;\r\n  date: string;\r\n}) {\r\n  const status =\r\n    opts.paid >= opts.gross && opts.gross > 0\r\n      ? \"PAID ‚úÖ\"\r\n      : opts.paid > 0\r\n      ? \"PARTIALLY PAID ‚úÖ\"\r\n      : \"PENDING\";\r\n\r\n  return [\r\n    `RAM POTTERY LTD`,\r\n    `Invoice: ${opts.invoiceNo}`,\r\n    `Date: ${opts.date}`,\r\n    `Customer: ${opts.customerName}`,\r\n    `Status: ${status}`,\r\n    ``,\r\n    `Total Amount: Rs ${money(opts.total)}`,\r\n    `Gross Total: Rs ${money(opts.gross)}`,\r\n    `Paid: Rs ${money(opts.paid)}`,\r\n    `Balance: Rs ${money(opts.balance)}`,\r\n    ``,\r\n    `Thank you.`,\r\n  ].join(\"\\n\");\r\n}\r\n\r\n\r\n  function openWhatsAppPaymentUpdate(paidNow: number) {\r\n  const phone = normalizeMuPhone(customer?.whatsapp || customer?.phone || \"\");\r\n  if (!phone) {\r\n    alert(\"Customer phone is missing. Add phone number in customer profile.\");\r\n    return;\r\n  }\r\n\r\n  const text = buildWhatsAppPaymentText({\r\n    invoiceNo: invoiceNumber,\r\n    customerName: customer?.name || \"\",\r\n    date: invoiceDatePrint, // ‚úÖ fixed\r\n    paidNow: n2(paidNow),\r\n    grossTotal,\r\n    balanceRemaining,\r\n  });\r\n\r\n  window.open(\r\n    `https://wa.me/${phone}?text=${encodeURIComponent(text)}`,\r\n    \"_blank\",\r\n    \"noopener,noreferrer\"\r\n  );\r\n}\r\n   \r\n \r\n  async function fetchInvoicePdf(invoiceIdOrNo: string) {\r\n  const res = await rpFetch(`/api/invoices/${encodeURIComponent(invoiceIdOrNo)}/pdf`, {\r\n    method: \"GET\",\r\n    cache: \"no-store\",\r\n  });\r\n  if (!res.ok) {\r\n    const t = await res.text().catch(() => \"\");\r\n    throw new Error(t || \"Failed to generate PDF\");\r\n  }\r\n  const blob = await res.blob();\r\n  return blob;\r\n}\r\n\r\nasync function sharePdfToWhatsApp(invoiceIdOrNo: string, messageText: string) {\r\n  const blob = await fetchInvoicePdf(invoiceIdOrNo);\r\n  const fileName = `Invoice-${invoiceIdOrNo}.pdf`;\r\n  const file = new File([blob], fileName, { type: \"application/pdf\" });\r\n\r\n  // ‚úÖ Best: mobile share sheet (WhatsApp appears as an option)\r\n  // Works on Android Chrome + iOS Safari (modern versions)\r\n  const nav: any = navigator;\r\n\r\n  if (nav?.share && nav?.canShare?.({ files: [file] })) {\r\n    await nav.share({\r\n      title: `Invoice ${invoiceIdOrNo}`,\r\n      text: messageText,\r\n      files: [file],\r\n    });\r\n    return;\r\n  }\r\n\r\n  // Desktop fallback: download PDF + open WhatsApp with text (user attaches manually)\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement(\"a\");\r\n  a.href = url;\r\n  a.download = fileName;\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  a.remove();\r\n  setTimeout(() => URL.revokeObjectURL(url), 2000);\r\n\r\n  // open WhatsApp chat with message\r\n  window.open(`https://wa.me/?text=${encodeURIComponent(messageText)}`, \"_blank\", \"noopener,noreferrer\");\r\n\r\n  alert(\"PDF downloaded. Please attach it in WhatsApp Web / WhatsApp Desktop.\");\r\n}\r\n\r\n   \r\n   async function onSave() {\r\n  if (!customerId) return alert(\"Please select a customer.\");\r\n  if (!invoiceDate) return alert(\"Please select invoice date.\");\r\n  if (!salesReps.length) return alert(\"Please select at least one sales rep.\");\r\n  if (realLines.length === 0) return alert(\"Please add at least one item.\");\r\n\r\n  setSaving(true);\r\n\r\n  try {\r\n    // ‚úÖ Build items exactly aligned with API expectations\r\n    const itemsPayload = realLines.map((l) => {\r\n      const qtyInput = Math.trunc(n2(l.box_qty)); // UI uses box_qty as qty input for both BOX/PCS\r\n      if (qtyInput <= 0) throw new Error(\"Qty must be at least 1 for all items.\");\r\n\r\n      const uom: \"BOX\" | \"PCS\" = l.uom === \"PCS\" ? \"PCS\" : \"BOX\";\r\n      const upb = uom === \"PCS\" ? 1 : Math.max(1, Math.trunc(n2(l.units_per_box) || 1));\r\n      const totalQty = uom === \"PCS\" ? qtyInput : qtyInput * upb;\r\n\r\n      return {\r\n        product_id: l.product_id,\r\n        description: l.description || null,\r\n        uom,\r\n\r\n        // ‚úÖ send correct qty fields (API normalization expects this)\r\n        box_qty: uom === \"BOX\" ? qtyInput : null,\r\n        pcs_qty: uom === \"PCS\" ? qtyInput : null,\r\n\r\n        units_per_box: upb,\r\n        total_qty: totalQty,\r\n\r\n        unit_price_excl_vat: n2(l.unit_price_excl_vat), // already discounted in UI\r\n        vat_rate: n2(l.vat_rate),\r\n        unit_vat: n2(l.unit_vat),\r\n        unit_price_incl_vat: n2(l.unit_price_incl_vat),\r\n        line_total: n2(l.line_total),\r\n      };\r\n    });\r\n\r\n    // ‚úÖ Recompute totals INSIDE onSave (prevents stale React memo/state in WhatsApp msg)\r\n    // Must mirror UI logic (based on discounted unit_ex + unit_vat)\r\n    const subtotalExNow = realLines.reduce(\r\n      (sum, r) => sum + n2(r.total_qty) * n2(r.unit_price_excl_vat),\r\n      0\r\n    );\r\n    const vatNow = realLines.reduce((sum, r) => sum + n2(r.total_qty) * n2(r.unit_vat), 0);\r\n    const totalNow = subtotalExNow + vatNow;\r\n\r\n    const prevNow = n2(previousBalance);\r\n    const paidNow = n2(amountPaid);\r\n\r\n    const grossNow = totalNow + prevNow;\r\n    const balanceNow = Math.max(0, grossNow - paidNow);\r\n\r\n    const payload = {\r\n      customerId,\r\n      invoiceDate,\r\n      purchaseOrderNo: purchaseOrderNo || null,\r\n\r\n      salesRep: salesReps.join(\", \"),\r\n      salesRepPhone: salesRepPhones || salesReps.map(repPhoneByName).filter(Boolean).join(\", \"),\r\n\r\n      previousBalance: prevNow,\r\n      amountPaid: paidNow,\r\n\r\n      discountPercent: n2(discountPercent),\r\n      discountAmount: n2(discountAmount), // optional (display), API will ignore in LINE_DISCOUNTED if you want\r\n      pricingMode: \"LINE_DISCOUNTED\",\r\n\r\n      partyType: customerNameType,\r\n\r\n      items: itemsPayload,\r\n    };\r\n\r\n    const res = await rpFetch(\"/api/invoices/create\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(payload),\r\n    });\r\n\r\n    const json = await res.json().catch(() => ({}));\r\n    if (!res.ok || !json?.ok) throw new Error(json?.error || \"Failed to create invoice\");\r\n\r\n    const invNo = String(json.invoiceNumber || \"(Saved)\");\r\n    setInvoiceNumber(invNo);\r\n\r\n    // ‚úÖ Auto WhatsApp when PAID or PARTIALLY PAID (with PDF share)\r\n    if (paidNow > 0) {\r\n      setTimeout(() => {\r\n        const msg = buildWhatsAppPaymentText({\r\n          invoiceNo: invNo,\r\n          customerName: customer?.name || \"\",\r\n          date: invoiceDatePrint,\r\n          paidNow: paidNow,\r\n          grossTotal: grossNow,\r\n          balanceRemaining: balanceNow,\r\n        });\r\n\r\n        // Share PDF + message (mobile share sheet OR desktop fallback)\r\n        sharePdfToWhatsApp(invNo, msg).catch((e) =>\r\n          alert(e?.message || \"Failed to share invoice PDF\")\r\n        );\r\n      }, 250);\r\n    }\r\n\r\n    alert(`Invoice saved: ${invNo}`);\r\n  } catch (err: any) {\r\n    alert(err?.message || \"Failed to create invoice\");\r\n  } finally {\r\n    setSaving(false);\r\n  }\r\n}\r\n\r\n\r\n\r\n    function onPrint() {\r\n    setPrinting(true);\r\n\r\n    document.documentElement.classList.add(\"rp-printing\");\r\n\r\n    const cleanup = () => {\r\n      document.documentElement.classList.remove(\"rp-printing\");\r\n      setPrinting(false);\r\n      window.removeEventListener(\"afterprint\", cleanup);\r\n    };\r\n\r\n    window.addEventListener(\"afterprint\", cleanup);\r\n\r\n    // give DOM + fonts + images a moment to render\r\n    setTimeout(() => {\r\n      window.print();\r\n    }, 200);\r\n\r\n    // fallback cleanup\r\n    setTimeout(cleanup, 5000);\r\n  }\r\n\r\n  // PRINT DATA\r\n  const docItems = useMemo(() => {\r\n    return realLines.map((r, i) => ({\r\n      sn: i + 1,\r\n      item_code: r.item_code,\r\n      uom: r.uom,\r\n      box_qty: Math.trunc(n2(r.box_qty)),\r\n      units_per_box: Math.trunc(n2(r.units_per_box)),\r\n      total_qty: Math.trunc(n2(r.total_qty)),\r\n      description: r.description,\r\n      unit_price_excl_vat: n2(r.unit_price_excl_vat),\r\n      unit_vat: n2(r.unit_vat),\r\n      unit_price_incl_vat: n2(r.unit_price_incl_vat),\r\n      line_total: n2(r.line_total),\r\n    }));\r\n  }, [realLines]);\r\n\r\n  const salesRepNamePrint = salesReps.join(\", \");\r\n  const salesRepPhonePrint =\r\n    salesRepPhones || salesReps.map(repPhoneByName).filter(Boolean).join(\", \");\r\n\r\n  return (\r\n    <div className=\"inv-page\">\r\n      {/* Top actions */}\r\n      <div className=\"inv-actions inv-screen\">\r\n        <button type=\"button\" className=\"rp-btn rp-btn--ghost\" onClick={() => router.back()}>\r\n          ‚Üê Back\r\n        </button>\r\n\r\n        <div className=\"inv-actions-right\">\r\n          <button type=\"button\" className=\"rp-btn\" onClick={addRow}>\r\n            + Add Row\r\n          </button>\r\n\r\n          <button\r\n            type=\"button\"\r\n            className=\"rp-btn rp-btn--ghost\"\r\n            disabled={!customerId}\r\n            title=\"Send payment update on WhatsApp\"\r\n            onClick={() => {\r\n            if (n2(amountPaid) <= 0) {\r\n            alert(\"Enter an amount paid to send payment update.\");\r\n            return;\r\n           }\r\n           openWhatsAppPaymentUpdate(n2(amountPaid));\r\n         }}\r\n        >\r\n         WhatsApp\r\n        </button>\r\n\r\n          <button\r\n            type=\"button\"\r\n            className=\"rp-btn\"\r\n            onClick={onPrint}\r\n            disabled={printing}\r\n            title=\"Print A4 invoice\"\r\n          >\r\n            {printing ? \"Preparing‚Ä¶\" : \"Print\"}\r\n          </button>\r\n\r\n          <button\r\n            type=\"button\"\r\n            className=\"rp-btn rp-btn--primary\"\r\n            onClick={onSave}\r\n            disabled={saving}\r\n          >\r\n            {saving ? \"Saving‚Ä¶\" : \"Save Invoice\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ==========================\r\n         SCREEN (everything editable)\r\n         ========================== */}\r\n      <div className=\"inv-screen inv-form-shell\">\r\n        <div className=\"inv-form-card\">\r\n          <div className=\"inv-form-head\">\r\n            <div>\r\n              <div className=\"inv-form-title\">New VAT Invoice</div>\r\n              <div className=\"inv-form-sub\">A4 Print Template Locked (Ram Pottery)</div>\r\n\r\n              {dupFromNo ? (\r\n                <div className=\"inv-dup-badge\">\r\n                  Duplicated from <b>{dupFromNo}</b>\r\n                </div>\r\n              ) : null}\r\n            </div>\r\n\r\n            <div className=\"inv-form-meta\">\r\n              <div className=\"inv-meta-row\">\r\n                <span className=\"inv-meta-k\">Invoice No</span>\r\n                <span className=\"inv-meta-v\">{invoiceNumber}</span>\r\n              </div>\r\n              <div className=\"inv-meta-row\">\r\n                <span className=\"inv-meta-k\">Date</span>\r\n                <span className=\"inv-meta-v\">{invoiceDate || \"‚Äî\"}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"inv-form-grid\">\r\n            {/* Customer Type selector */}\r\n            <div className=\"inv-field inv-field--type\">\r\n              <label>Customer Type</label>\r\n              <select\r\n                className=\"inv-input\"\r\n                value={customerNameType}\r\n                onChange={(e) => {\r\n                  setCustomerNameTypeTouched(true);\r\n                  setCustomerNameType(e.target.value as any);\r\n                }}\r\n              >\r\n                <option value=\"COMPANY\">Company Name</option>\r\n                <option value=\"CLIENT\">Client Name</option>\r\n              </select>\r\n              <div className=\"inv-help\">Affects the label shown on the invoice header.</div>\r\n            </div>\r\n\r\n            {/* Customer select + search */}\r\n            <div className=\"inv-field inv-field--customer\">\r\n              <label>{customerNameType === \"COMPANY\" ? \"Company Name\" : \"Client Name\"}</label>\r\n\r\n              <div className=\"inv-customer-row\">\r\n                <select\r\n                  className=\"inv-input\"\r\n                  value={customerId ?? \"\"}\r\n                  onChange={(e) => {\r\n                    setCustomerId(e.target.value ? Number(e.target.value) : null);\r\n                  }}\r\n                >\r\n                  <option value=\"\">Select‚Ä¶</option>\r\n                  {customers.map((c) => (\r\n                    <option key={c.id} value={c.id}>\r\n                      {c.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"rp-btn rp-btn--ghost inv-search-btn\"\r\n                  onClick={openCustomerSearch}\r\n                  title=\"Search customer\"\r\n                >\r\n                  üîç Search\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"inv-help\">\r\n                {customer ? (\r\n                  <>\r\n                    <span>{customer.address}</span> ¬∑ <span>{customer.phone}</span>\r\n                  </>\r\n                ) : (\r\n                  <span>Select a customer (or use Search)</span>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Invoice Date */}\r\n            <div className=\"inv-field inv-field--date\">\r\n              <label>Invoice Date</label>\r\n              <input\r\n                className=\"inv-input\"\r\n                type=\"date\"\r\n                value={invoiceDate}\r\n                onChange={(e) => setInvoiceDate(e.target.value)}\r\n              />\r\n            </div>\r\n\r\n            {/* PO */}\r\n            <div className=\"inv-field inv-field--po\">\r\n              <label>Purchase Order No (optional)</label>\r\n              <input\r\n                className=\"inv-input\"\r\n                value={purchaseOrderNo}\r\n                onChange={(e) => setPurchaseOrderNo(e.target.value)}\r\n                placeholder=\"Optional\"\r\n              />\r\n            </div>\r\n\r\n            {/* Sales Reps */}\r\n            <div className=\"inv-field inv-field--reps\">\r\n              <label>Sales Rep(s)</label>\r\n\r\n              <div className=\"inv-rep\">\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"inv-rep-btn\"\r\n                  onClick={() => setRepOpen((v) => !v)}\r\n                  aria-expanded={repOpen}\r\n                >\r\n                  <div className=\"inv-rep-chips\">\r\n                    {salesReps.length ? (\r\n                      salesReps.map((n) => (\r\n                        <span key={n} className=\"inv-chip\">\r\n                          {n} ({repPhoneByName(n)})\r\n                          <span\r\n                            className=\"inv-chip-x\"\r\n                            onClick={(e) => {\r\n                              e.stopPropagation();\r\n                              const next = salesReps.filter((x) => x !== n);\r\n                              setSalesReps(next);\r\n                              setSalesRepPhones(next.map(repPhoneByName).filter(Boolean).join(\", \"));\r\n                            }}\r\n                            title=\"Remove\"\r\n                          >\r\n                            √ó\r\n                          </span>\r\n                        </span>\r\n                      ))\r\n                    ) : (\r\n                      <span className=\"inv-rep-placeholder\">Select sales reps‚Ä¶</span>\r\n                    )}\r\n                  </div>\r\n                  <span className=\"inv-rep-caret\">‚ñæ</span>\r\n                </button>\r\n\r\n                {repOpen ? (\r\n                  <div className=\"inv-rep-pop\" onMouseDown={(e) => e.stopPropagation()}>\r\n                    {SALES_REPS.map((r) => {\r\n                      const active = salesReps.includes(r.name);\r\n                      return (\r\n                        <button\r\n                          key={r.name}\r\n                          type=\"button\"\r\n                          className={\"inv-rep-item\" + (active ? \" is-active\" : \"\")}\r\n                          onClick={() => {\r\n                            const next = active\r\n                              ? salesReps.filter((x) => x !== r.name)\r\n                              : [...salesReps, r.name];\r\n\r\n                            setSalesReps(next);\r\n                            setSalesRepPhones(next.map(repPhoneByName).filter(Boolean).join(\", \"));\r\n\r\n                            setRepOpen(false);\r\n                          }}\r\n                        >\r\n                          <span className=\"inv-rep-name\">{r.name}</span>\r\n                          <span className=\"inv-rep-phone\">{r.phone}</span>\r\n                          <span className=\"inv-rep-check\">{active ? \"‚úì\" : \"\"}</span>\r\n                        </button>\r\n                      );\r\n                    })}\r\n                    <div className=\"inv-rep-hint\">Click to select. Click again to remove.</div>\r\n                  </div>\r\n                ) : null}\r\n              </div>\r\n            </div>\r\n\r\n            {/* VAT */}\r\n            <div className=\"inv-field inv-field--vat\">\r\n              <label>VAT % (applies to all items)</label>\r\n              <select\r\n                className=\"inv-input\"\r\n                value={vatPercent}\r\n                onChange={(e) => {\r\n                  const next = n2(e.target.value) === 0 ? 0 : 15;\r\n                  setVatPercent(next);\r\n                  setLines((prev) => prev.map((r) => recalc({ ...r, vat_rate: next } as InvoiceLine)));\r\n                }}\r\n              >\r\n                <option value={15}>15%</option>\r\n                <option value={0}>0%</option>\r\n              </select>\r\n            </div>\r\n\r\n            {/* Discount */}\r\n            <div className=\"inv-field inv-field--discount\">\r\n              <label>Discount % (Party-wise)</label>\r\n              <input className=\"inv-input inv-input--right\" value={fmtNumber(discountPercent)} readOnly />\r\n              <div className=\"inv-help\">\r\n                {customer ? (\r\n                  <span>\r\n                    Auto from <b>{customer.name}</b>: {fmtNumber(n2(customer.discount_percent ?? 0))}%\r\n                  </span>\r\n                ) : (\r\n                  <span>Auto-fills when you select a customer</span>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Previous Balance */}\r\n            <div className=\"inv-field inv-field--prev\">\r\n              <label>Previous Balance</label>\r\n              <input\r\n                className=\"inv-input inv-input--right\"\r\n                inputMode=\"decimal\"\r\n                value={previousBalance}\r\n                onChange={(e) => {\r\n                  setPrevTouched(true);\r\n                  setPreviousBalance(n2(e.target.value));\r\n                }}\r\n              />\r\n            </div>\r\n\r\n            {/* Amount Paid */}\r\n            <div className=\"inv-field inv-field--paid\">\r\n              <label>Amount Paid</label>\r\n              <input\r\n                className=\"inv-input inv-input--right\"\r\n                inputMode=\"decimal\"\r\n                value={amountPaid}\r\n                onChange={(e) => {\r\n                  setPaidTouched(true);\r\n                  setAmountPaid(n2(e.target.value));\r\n                }}\r\n              />\r\n              <div className=\"inv-help\">If Amount Paid &gt; 0, WhatsApp prompt opens after Save.</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* ITEMS TABLE (SCREEN) */}\r\n          <div className=\"inv-items\">\r\n            <div className=\"inv-items-head\">\r\n              <div className=\"inv-items-title\">Items</div>\r\n              <div className=\"inv-items-sub\">Matches printed invoice columns (A4).</div>\r\n            </div>\r\n\r\n            <div className=\"inv-table-wrap\">\r\n              <table className=\"inv-table inv-table--invoiceCols\">\r\n                {/* ‚úÖ Hydration-safe colgroup (NO whitespace) */}\r\n                <colgroup>\r\n                  <col style={{ width: \"4%\" }} />\r\n                  <col style={{ width: \"30%\" }} />\r\n                  <col style={{ width: \"16%\" }} />\r\n                  <col style={{ width: \"8%\" }} />\r\n                  <col style={{ width: \"8%\" }} />\r\n                  <col style={{ width: \"10%\" }} />\r\n                  <col style={{ width: \"6%\" }} />\r\n                  <col style={{ width: \"10%\" }} />\r\n                  <col style={{ width: \"12%\" }} />\r\n                  <col style={{ width: \"4%\" }} />\r\n                </colgroup>\r\n\r\n                <thead>\r\n                  <tr>\r\n                    <th className=\"inv-th inv-th-center\">#</th>\r\n                    <th className=\"inv-th\">PRODUCT</th>\r\n                    <th className=\"inv-th inv-th-center\">BOX / PCS</th>\r\n                    <th className=\"inv-th inv-th-center\">UNIT</th>\r\n                    <th className=\"inv-th inv-th-center\">TOTAL QTY</th>\r\n                    <th className=\"inv-th inv-th-right\">UNIT&nbsp;EX</th>\r\n                    <th className=\"inv-th inv-th-right\">VAT</th>\r\n                    <th className=\"inv-th inv-th-right\">UNIT&nbsp;INC</th>\r\n                    <th className=\"inv-th inv-th-right\">TOTAL</th>\r\n                    <th className=\"inv-th inv-th-center\" />\r\n                  </tr>\r\n                </thead>\r\n\r\n                <tbody>\r\n                  {lines.map((r, idx) => {\r\n                    const isReal = !!r.product_id;\r\n\r\n                    return (\r\n                      <tr key={r.id} className={removingIds.has(r.id) ? \"inv-row--removing\" : \"\"}>\r\n                        <td className=\"inv-td inv-center\">{idx + 1}</td>\r\n\r\n                        {/* PRODUCT selector */}\r\n                        <td className=\"inv-td\">\r\n                          <div className=\"inv-itemcode-cell--prod\">\r\n                            <select\r\n                              className=\"inv-input inv-input--prod\"\r\n                              value={r.product_id ?? \"\"}\r\n                              onChange={(e) => {\r\n                                const pid = e.target.value ? Number(e.target.value) : null;\r\n                                const p = pid ? products.find((x) => x.id === pid) || null : null;\r\n                                applyProductToRow(r.id, p);\r\n                              }}\r\n                            >\r\n                              <option value=\"\">Select‚Ä¶</option>\r\n                              {products.map((p) => (\r\n                                <option key={p.id} value={p.id}>\r\n                                  {p.item_code} ‚Äî {p.name}\r\n                                </option>\r\n                              ))}\r\n                            </select>\r\n\r\n                            <button\r\n                              type=\"button\"\r\n                              className=\"inv-search-mini\"\r\n                              onClick={() => openSearchForRow(r.id)}\r\n                              title=\"Search product\"\r\n                            >\r\n                              üîç\r\n                            </button>\r\n                          </div>\r\n                        </td>\r\n\r\n                        {/* BOX / PCS + Qty */}\r\n                        <td className=\"inv-td inv-center\">\r\n                          <div className=\"inv-boxcell inv-boxcell--premium\">\r\n                            <select\r\n                              className=\"inv-input inv-input--uom\"\r\n                              value={r.uom}\r\n                              onChange={(e) => setLine(r.id, { uom: e.target.value as any })}\r\n                              disabled={!isReal}\r\n                            >\r\n                              <option value=\"BOX\">BOX</option>\r\n                              <option value=\"PCS\">PCS</option>\r\n                            </select>\r\n\r\n                            <input\r\n                              className=\"inv-input inv-input--qty inv-input--qtywide inv-center\"\r\n                              value={r.box_qty}\r\n                              onChange={(e) => setLine(r.id, { box_qty: n2(e.target.value) })}\r\n                              onKeyDown={(e) => {\r\n                                if (e.key !== \"Enter\") return;\r\n                                if (e.shiftKey) return; // Shift+Enter is Save (handled globally)\r\n                                if (!isReal) return;\r\n\r\n                                const isLast = idx === lines.length - 1;\r\n                                const q = Math.trunc(n2((e.target as HTMLInputElement).value));\r\n\r\n                                if (isLast && q >= 1) {\r\n                                  e.preventDefault();\r\n                                  addRow();\r\n                                  setTimeout(() => {\r\n                                    const qtyInputs = Array.from(\r\n                                      document.querySelectorAll<HTMLInputElement>(\".inv-input--qtywide\")\r\n                                    );\r\n                                    const last = qtyInputs[qtyInputs.length - 1];\r\n                                    last?.focus();\r\n                                    last?.select?.();\r\n                                  }, 0);\r\n                                }\r\n                              }}\r\n                              disabled={!isReal}\r\n                              inputMode=\"numeric\"\r\n                              placeholder=\"0\"\r\n                            />\r\n                          </div>\r\n                        </td>\r\n\r\n                        {/* UNIT/BOX */}\r\n                        <td className=\"inv-td inv-center\">\r\n                          <input\r\n                            className=\"inv-input inv-center\"\r\n                            value={r.uom === \"PCS\" ? \"\" : intFmt(r.units_per_box)}\r\n                            readOnly\r\n                          />\r\n                        </td>\r\n\r\n                        {/* TOTAL QTY */}\r\n                        <td className=\"inv-td inv-center\">\r\n                          <input className=\"inv-input inv-center\" value={intFmt(r.total_qty)} readOnly />\r\n                        </td>\r\n\r\n                        {/* PRICES */}\r\n                        <td className=\"inv-td inv-right\">\r\n                          <input\r\n                            className=\"inv-input inv-input--right\"\r\n                            value={money(r.unit_price_excl_vat)}\r\n                            readOnly\r\n                          />\r\n                        </td>\r\n                        <td className=\"inv-td inv-right\">\r\n                          <input className=\"inv-input inv-input--right\" value={money(r.unit_vat)} readOnly />\r\n                        </td>\r\n                        <td className=\"inv-td inv-right\">\r\n                          <input\r\n                            className=\"inv-input inv-input--right\"\r\n                            value={money(r.unit_price_incl_vat)}\r\n                            readOnly\r\n                          />\r\n                        </td>\r\n                        <td className=\"inv-td inv-right\">\r\n                          <input\r\n                            className=\"inv-input inv-input--right inv-input--total\"\r\n                            value={money(r.line_total)}\r\n                            readOnly\r\n                          />\r\n                        </td>\r\n\r\n                        <td className=\"inv-td inv-center\">\r\n                          <button\r\n                            type=\"button\"\r\n                            className=\"inv-xmini\"\r\n                            onClick={() => removeRow(r.id)}\r\n                            title=\"Remove row\"\r\n                          >\r\n                            ‚úï\r\n                          </button>\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n\r\n            {/* Totals preview */}\r\n            <div className=\"inv-totalsbar inv-totalsbar--premium\">\r\n              <div>\r\n                <b>Sub Total:</b> {money(subtotalEx)}\r\n              </div>\r\n              <div>\r\n                <b>VAT:</b> {money(vatAmount)}\r\n              </div>\r\n              <div>\r\n                <b>Discount:</b> {money(discountAmount)}\r\n              </div>\r\n              <div>\r\n                <b>Total:</b> {money(totalAmount)}\r\n              </div>\r\n              <div>\r\n                <b>Gross:</b> {money(grossTotal)}\r\n              </div>\r\n              <div>\r\n                <b>Balance:</b> {money(balanceRemaining)}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* ===========================\r\n              Product Search Modal\r\n             =========================== */}\r\n          {searchOpen ? (\r\n            <div className=\"inv-modal-backdrop\" onMouseDown={closeSearch}>\r\n              <div className=\"inv-modal\" onMouseDown={(e) => e.stopPropagation()}>\r\n                <div className=\"inv-modal-head\">\r\n                  <div className=\"inv-modal-title\">Search Product</div>\r\n                  <button type=\"button\" className=\"rp-btn rp-btn--ghost\" onClick={closeSearch}>\r\n                    Close\r\n                  </button>\r\n                </div>\r\n\r\n                <div className=\"inv-modal-body\">\r\n                  <input\r\n                    className=\"inv-input\"\r\n                    value={searchTerm}\r\n                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                    placeholder=\"Search by code, sku, name, description‚Ä¶\"\r\n                    autoFocus\r\n                  />\r\n\r\n                  <div className=\"inv-modal-list\">\r\n                    {filteredProducts.slice(0, 150).map((p) => (\r\n                      <button\r\n                        key={p.id}\r\n                        type=\"button\"\r\n                        className=\"inv-modal-item\"\r\n                        onClick={() => {\r\n                          if (searchRowId) applyProductToRow(searchRowId, p);\r\n                          closeSearch();\r\n                        }}\r\n                      >\r\n                        <div className=\"inv-modal-item-title\">\r\n                          <b>{p.item_code || p.sku}</b> ‚Äî {p.name}\r\n                        </div>\r\n                        <div className=\"inv-modal-item-sub\">\r\n                          UNIT: {intFmt(p.units_per_box ?? 1)} ¬∑ Unit Ex: {money(p.price_excl_vat ?? 0)}\r\n                        </div>\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : null}\r\n\r\n          {/* ===========================\r\n              Customer Search Modal\r\n             =========================== */}\r\n          {custSearchOpen ? (\r\n            <div className=\"inv-modal-backdrop\" onMouseDown={closeCustomerSearch}>\r\n              <div className=\"inv-modal\" onMouseDown={(e) => e.stopPropagation()}>\r\n                <div className=\"inv-modal-head\">\r\n                  <div className=\"inv-modal-title\">Search Customer</div>\r\n                  <button type=\"button\" className=\"rp-btn rp-btn--ghost\" onClick={closeCustomerSearch}>\r\n                    Close\r\n                  </button>\r\n                </div>\r\n\r\n                <div className=\"inv-modal-body\">\r\n                  <input\r\n                    className=\"inv-input\"\r\n                    value={custSearchTerm}\r\n                    onChange={(e) => setCustSearchTerm(e.target.value)}\r\n                    placeholder=\"Search by name, code, phone, address‚Ä¶\"\r\n                    autoFocus\r\n                  />\r\n\r\n                  <div className=\"inv-modal-list\">\r\n                    {filteredCustomers.slice(0, 200).map((c) => (\r\n                      <button\r\n                        key={c.id}\r\n                        type=\"button\"\r\n                        className=\"inv-modal-item\"\r\n                        onClick={() => {\r\n                          setCustomerId(c.id);\r\n                          closeCustomerSearch();\r\n                        }}\r\n                      >\r\n                        <div className=\"inv-modal-item-title\">\r\n                          <b>{c.name}</b> <span className=\"inv-muted\">({c.customer_code})</span>\r\n                        </div>\r\n                        <div className=\"inv-modal-item-sub\">\r\n                          {c.phone} ¬∑ {c.address}\r\n                        </div>\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n\r\n      {/* ==========================\r\n         PRINT ONLY (must be OUTSIDE inv-screen)\r\n         ========================== */}\r\n      <div className=\"inv-printonly\">\r\n        <RamPotteryDoc\r\n          variant=\"INVOICE\"\r\n          docNoLabel=\"INVOICE NO:\"\r\n          docNoValue={invoiceNumber}\r\n          dateLabel=\"DATE:\"\r\n          dateValue={invoiceDatePrint}\r\n          purchaseOrderLabel=\"PURCHASE ORDER NO:\"\r\n          purchaseOrderValue={purchaseOrderNo || \"\"}\r\n          salesRepName={salesRepNamePrint}\r\n          salesRepPhone={salesRepPhonePrint}\r\n          customer={{\r\n            name: customer?.name || \"\",\r\n            address: customer?.address || \"\",\r\n            phone: customer?.phone || \"\",\r\n            brn: customer?.brn || \"\",\r\n            vat_no: customer?.vat_no || \"\",\r\n            customer_code: customer?.customer_code || \"\",\r\n          }}\r\n          company={{\r\n            brn: \"C17144377\",\r\n            vat_no: \"123456789\",\r\n          }}\r\n          items={docItems}\r\n          totals={{\r\n            subtotal: subtotalEx,\r\n            vatPercentLabel: `VAT`,\r\n            vat_amount: vatAmount,\r\n            total_amount: totalAmount,\r\n            previous_balance: previousBalance,\r\n            amount_paid: amountPaid,\r\n            balance_remaining: balanceRemaining,\r\n            discount_percent: discountPercent,\r\n            discount_amount: discountAmount,\r\n          }}\r\n          preparedBy=\"Manish\"\r\n          deliveredBy=\"\"\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}