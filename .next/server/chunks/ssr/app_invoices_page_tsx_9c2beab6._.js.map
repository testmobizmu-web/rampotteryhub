{"version":3,"sources":["../../../../app/invoices/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport Image from \"next/image\";\r\nimport { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { rpFetch } from \"@/lib/rpFetch\";\r\n\r\ntype RpSession = {\r\n  id?: string;\r\n  username?: string;\r\n  name?: string;\r\n  role?: string;\r\n};\r\n\r\nfunction roleUpper(r?: string) {\r\n  return String(r || \"\").toUpperCase();\r\n}\r\nfunction isAdmin(r?: string) {\r\n  return roleUpper(r) === \"ADMIN\";\r\n}\r\nfunction isManager(r?: string) {\r\n  return roleUpper(r) === \"MANAGER\";\r\n}\r\nfunction canDuplicate(r?: string) {\r\n  return isAdmin(r) || isManager(r);\r\n}\r\n\r\nconst n = (v: any) => (Number.isFinite(Number(v)) ? Number(v) : 0);\r\nconst rs = (v: number) => `Rs ${n(v).toFixed(2)}`;\r\n\r\nfunction fmtDate(d?: string | null) {\r\n  if (!d) return \"â€”\";\r\n  const x = new Date(d);\r\n  if (Number.isNaN(x.getTime())) return d;\r\n  const pad = (k: number) => String(k).padStart(2, \"0\");\r\n  return `${pad(x.getDate())}/${pad(x.getMonth() + 1)}/${x.getFullYear()}`;\r\n}\r\n\r\nfunction fmtDateTime(d: Date) {\r\n  const pad = (x: number) => String(x).padStart(2, \"0\");\r\n  return `${pad(d.getDate())}/${pad(d.getMonth() + 1)}/${d.getFullYear()}, ${pad(d.getHours())}:${pad(\r\n    d.getMinutes()\r\n  )}:${pad(d.getSeconds())}`;\r\n}\r\n\r\nfunction normalizeStatus(s?: string | null) {\r\n  const v = String(s || \"\").toUpperCase();\r\n  if (v === \"PAID\") return \"Paid\";\r\n  if (v === \"PARTIALLY_PAID\" || v === \"PARTIAL\") return \"Partially Paid\";\r\n  if (v === \"VOID\") return \"Void\";\r\n  if (v === \"UNPAID\") return \"Issued\";\r\n  return \"Issued\";\r\n}\r\n\r\nfunction digitsOnly(v: any) {\r\n  return String(v ?? \"\").replace(/[^\\d]/g, \"\");\r\n}\r\n\r\n// Mauritius only: returns \"230XXXXXXXX\" or \"\"\r\nfunction normalizeMuPhone(raw: any) {\r\n  const d = digitsOnly(raw);\r\n  if (!d) return \"\";\r\n\r\n  if (d.length === 8) return \"230\" + d;                 // local 8 digits\r\n  if (d.startsWith(\"230\") && d.length === 11) return d; // 230 + 8 digits\r\n\r\n  return \"\"; // reject non-MU / invalid\r\n}\r\n\r\nfunction buildInvoicePaymentWhatsAppText(opts: {\r\n  customerName?: string;\r\n  invoiceNo: string;\r\n  paidNow: number;\r\n  totalPaid: number;\r\n  balance: number;\r\n  pdfUrl: string;\r\n}) {\r\n  const status = opts.balance <= 0 ? \"PAID âœ…\" : \"PARTIALLY PAID âœ…\";\r\n\r\n  const money = (v: number) =>\r\n    new Intl.NumberFormat(\"en-US\", { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(\r\n      Number.isFinite(v) ? v : 0\r\n    );\r\n\r\n  return [\r\n    `Payment received âœ…`,\r\n    opts.customerName ? `Customer: ${opts.customerName}` : null,\r\n    `Invoice: ${opts.invoiceNo}`,\r\n    `Status: ${status}`,\r\n    `Paid now: Rs ${money(opts.paidNow)}`,\r\n    `Total paid: Rs ${money(opts.totalPaid)}`,\r\n    `Balance: Rs ${money(opts.balance)}`,\r\n    `PDF: ${opts.pdfUrl}`,\r\n  ]\r\n    .filter(Boolean)\r\n    .join(\"\\n\");\r\n}\r\n\r\nfunction openWhatsApp(to230digits: string, text: string) {\r\n  const url = `https://wa.me/${to230digits}?text=${encodeURIComponent(text)}`;\r\n  window.open(url, \"_blank\", \"noopener,noreferrer\");\r\n}\r\n\r\nfunction statusBadgeClass(s?: string | null) {\r\n  const st = normalizeStatus(s);\r\n  return (\r\n    \"rp-badge \" +\r\n    (st === \"Paid\"\r\n      ? \"rp-badge--paid\"\r\n      : st === \"Partially Paid\"\r\n      ? \"rp-badge--partial\"\r\n      : st === \"Void\"\r\n      ? \"rp-badge--void\"\r\n      : \"rp-badge--issued\")\r\n  );\r\n}\r\n\r\nfunction discountText(r: any) {\r\n  const dp = n(r?.discount_percent);\r\n  const da = n(r?.discount_amount);\r\n\r\n  // show nothing if no discount snapshot on invoice\r\n  if (!(dp > 0 || da > 0)) return \"â€”\";\r\n\r\n  const parts: string[] = [];\r\n  if (da > 0) parts.push(`- ${rs(da)}`);\r\n  if (dp > 0) parts.push(`(${dp.toFixed(0)}%)`);\r\n  return parts.join(\" \");\r\n}\r\n\r\nexport default function InvoicesPage() {\r\n  const router = useRouter();\r\n\r\n  const [drawerOpen, setDrawerOpen] = useState(false);\r\n  const [theme, setTheme] = useState<\"light\" | \"dark\">(\"light\");\r\n  const [lastSync, setLastSync] = useState<string>(\"\");\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [err, setErr] = useState<string | null>(null);\r\n\r\n  const [mounted, setMounted] = useState(false);\r\n  const [session, setSession] = useState<RpSession | null>(null);\r\n\r\n  const [rows, setRows] = useState<any[]>([]);\r\n  const [searchDraft, setSearchDraft] = useState(\"\");\r\n  const [search, setSearch] = useState(\"\");\r\n  const [status, setStatus] = useState<\"All\" | \"Issued\" | \"Paid\" | \"Partially Paid\" | \"Void\">(\"All\");\r\n\r\n  const [openMenu, setOpenMenu] = useState<number | string | null>(null);\r\n\r\n  // Payment modal\r\n  const [payOpen, setPayOpen] = useState(false);\r\n  const [payInvoice, setPayInvoice] = useState<any | null>(null);\r\n  const [payAmount, setPayAmount] = useState<number>(0);\r\n  const [paySaving, setPaySaving] = useState(false);\r\n\r\n  const payInputRef = useRef<HTMLInputElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n\r\n    const saved = localStorage.getItem(\"rp_theme\");\r\n    const initial = saved === \"dark\" ? \"dark\" : \"light\";\r\n    setTheme(initial);\r\n    document.documentElement.dataset.theme = initial;\r\n\r\n    try {\r\n      const raw = localStorage.getItem(\"rp_user\");\r\n      if (raw) setSession(JSON.parse(raw));\r\n    } catch {\r\n      setSession(null);\r\n    }\r\n  }, []);\r\n\r\n  // lock scroll when drawer open\r\n  useEffect(() => {\r\n    document.body.style.overflow = drawerOpen ? \"hidden\" : \"\";\r\n    return () => {\r\n      document.body.style.overflow = \"\";\r\n    };\r\n  }, [drawerOpen]);\r\n\r\n  // close menu on outside click\r\n  useEffect(() => {\r\n    const close = () => setOpenMenu(null);\r\n    window.addEventListener(\"click\", close);\r\n    return () => window.removeEventListener(\"click\", close);\r\n  }, []);\r\n\r\n  // global ESC behavior\r\n  useEffect(() => {\r\n    const onKey = (e: KeyboardEvent) => {\r\n      if (e.key === \"Escape\") {\r\n        setOpenMenu(null);\r\n        setDrawerOpen(false);\r\n        if (payOpen && !paySaving) setPayOpen(false);\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, [payOpen, paySaving]);\r\n\r\n  const canSeeAdminNav = mounted && isAdmin(session?.role);\r\n\r\n  const navItems = useMemo(() => {\r\n    const base = [\r\n      { href: \"/\", label: \"Dashboard\" },\r\n      { href: \"/invoices\", label: \"Invoices\" },\r\n      { href: \"/credit-notes\", label: \"Credit Notes\" },\r\n      { href: \"/products\", label: \"Stock & Categories\" },\r\n      { href: \"/stock-movements\", label: \"Stock Movements\" },\r\n      { href: \"/customers\", label: \"Customers\" },\r\n      { href: \"/suppliers\", label: \"Suppliers\" },\r\n      { href: \"/reports\", label: \"Reports & Statements\" },\r\n    ];\r\n    if (canSeeAdminNav) base.push({ href: \"/admin/users\", label: \"Users & Permissions\" });\r\n    return base;\r\n  }, [canSeeAdminNav]);\r\n\r\n  const userLabel = useMemo(() => {\r\n    const name = (session?.name || session?.username || \"\").trim();\r\n    return name ? name : \"User\";\r\n  }, [session]);\r\n\r\n  const roleLabel = useMemo(() => roleUpper(session?.role) || \"STAFF\", [session]);\r\n\r\n  function toggleTheme() {\r\n    const next = theme === \"dark\" ? \"light\" : \"dark\";\r\n    setTheme(next);\r\n    document.documentElement.dataset.theme = next;\r\n    localStorage.setItem(\"rp_theme\", next);\r\n  }\r\n\r\n  async function handleLogout() {\r\n    try {\r\n      await fetch(\"/api/auth/logout\", { method: \"POST\" });\r\n    } finally {\r\n      localStorage.removeItem(\"rp_user\");\r\n      window.location.href = \"/login\";\r\n    }\r\n  }\r\n\r\n  async function load() {\r\n    try {\r\n      setLoading(true);\r\n      setErr(null);\r\n\r\n      const res = await rpFetch(\"/api/invoices\", { cache: \"no-store\" });\r\n      const json = await res.json().catch(() => ({}));\r\n      if (!res.ok || json?.ok === false) throw new Error(json?.error || \"Failed to load invoices\");\r\n\r\n      setRows(json.invoices || []);\r\n      setLastSync(fmtDateTime(new Date()));\r\n    } catch (e: any) {\r\n      setErr(e?.message || \"Failed to load invoices\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    load();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  async function markAsPaid(id: number | string) {\r\n    if (!confirm(\"Mark this invoice as PAID?\")) return;\r\n    const res = await rpFetch(`/api/invoices/${id}/mark-paid`, { method: \"PATCH\" });\r\n    const j = await res.json().catch(() => ({}));\r\n    if (!res.ok || j?.ok === false) return alert(j?.error || \"Failed to mark as paid\");\r\n    await load();\r\n  }\r\n\r\n  async function voidInvoice(id: number | string) {\r\n    if (!confirm(\"Void this invoice? This cannot be undone.\")) return;\r\n    const res = await rpFetch(`/api/invoices/${id}/void`, { method: \"POST\" });\r\n    const j = await res.json().catch(() => ({}));\r\n    if (!res.ok || j?.ok === false) return alert(j?.error || \"Failed to void invoice\");\r\n    await load();\r\n  }\r\n\r\n  function duplicateInvoicePrefill(id: number | string) {\r\n    router.push(`/invoices/new?duplicate=${encodeURIComponent(String(id))}`);\r\n  }\r\n\r\n  function openPaymentModal(inv: any) {\r\n    setPayInvoice(inv);\r\n    setPayAmount(n(inv.amount_paid));\r\n    setPayOpen(true);\r\n    setOpenMenu(null);\r\n    setTimeout(() => payInputRef.current?.focus(), 30);\r\n  }\r\n\r\n  async function savePayment() {\r\n  if (!payInvoice?.id) return;\r\n  setPaySaving(true);\r\n\r\n  try {\r\n    const prevPaid = n(payInvoice?.amount_paid);\r\n\r\n    const res = await rpFetch(`/api/invoices/${payInvoice.id}/set-payment`, {\r\n      method: \"PATCH\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ amountPaid: n(payAmount) }), // this is TOTAL paid (your current behavior)\r\n    });\r\n\r\n    const j = await res.json().catch(() => ({}));\r\n    if (!res.ok || j?.ok === false) throw new Error(j?.error || \"Failed to set payment\");\r\n\r\n    // ---------- WhatsApp (Option 1) ----------\r\n    // Get the freshest values:\r\n    // Prefer API response if it returns invoice; otherwise compute from current UI values.\r\n    const nextPaid =\r\n      Number.isFinite(Number(j?.invoice?.amount_paid)) ? n(j.invoice.amount_paid) : n(payAmount);\r\n\r\n    const gross =\r\n      Number.isFinite(Number(j?.invoice?.gross_total))\r\n        ? n(j.invoice.gross_total)\r\n        : n(payInvoice?.gross_total ?? payInvoice?.total_amount);\r\n\r\n    const nextBalance =\r\n      Number.isFinite(Number(j?.invoice?.balance_remaining))\r\n        ? n(j.invoice.balance_remaining)\r\n        : Math.max(0, gross - nextPaid);\r\n\r\n    const paidNow = Math.max(0, nextPaid - prevPaid);\r\n\r\n    const cust = j?.invoice?.customers || payInvoice?.customers || null;\r\n\r\n    const to = normalizeMuPhone(cust?.whatsapp || cust?.phone || \"\");\r\n    if (to) {\r\n      const pdfUrl = `${window.location.origin}/api/invoices/${payInvoice.id}/pdf`;\r\n      const invoiceNo = String(payInvoice?.invoice_number || payInvoice?.id);\r\n\r\n      const text = buildInvoicePaymentWhatsAppText({\r\n        customerName: cust?.name || \"\",\r\n        invoiceNo,\r\n        paidNow,\r\n        totalPaid: nextPaid,\r\n        balance: nextBalance,\r\n        pdfUrl,\r\n      });\r\n\r\n      openWhatsApp(to, text);\r\n    }\r\n    // If no number -> silently skip (no crash)\r\n\r\n    // close modal + refresh UI\r\n    setPayOpen(false);\r\n    setPayInvoice(null);\r\n    await load();\r\n  } catch (e: any) {\r\n    alert(e?.message || \"Failed to set payment\");\r\n  } finally {\r\n    setPaySaving(false);\r\n  }\r\n}\r\n\r\n\r\n  function applySearch() {\r\n    setSearch(searchDraft.trim());\r\n  }\r\n\r\n  function clearSearch() {\r\n    setSearchDraft(\"\");\r\n    setSearch(\"\");\r\n  }\r\n\r\n  const filtered = useMemo(() => {\r\n    const q = search.trim().toLowerCase();\r\n    return rows.filter((r) => {\r\n      const st = normalizeStatus(r.status);\r\n      if (status !== \"All\" && st !== status) return false;\r\n      if (!q) return true;\r\n      const invNo = String(r.invoice_number || \"\").toLowerCase();\r\n      const cust = String(r.customers?.name || \"\").toLowerCase();\r\n      const code = String(r.customers?.customer_code || \"\").toLowerCase();\r\n      return invNo.includes(q) || cust.includes(q) || code.includes(q);\r\n    });\r\n  }, [rows, search, status]);\r\n\r\n  // âœ… show Discount column only when any invoice in current view has discount snapshot\r\n  const showDiscount = useMemo(() => {\r\n    return filtered.some((r) => n(r?.discount_amount) > 0 || n(r?.discount_percent) > 0);\r\n  }, [filtered]);\r\n\r\n  const kpis = useMemo(() => {\r\n    const total = filtered.reduce((s, r) => s + n(r.total_amount), 0);\r\n    const paid = filtered.reduce((s, r) => s + n(r.amount_paid), 0);\r\n    const balance = filtered.reduce((s, r) => s + n(r.balance_remaining), 0);\r\n    return { count: filtered.length, total, paid, balance };\r\n  }, [filtered]);\r\n\r\n  const SideCard = (\r\n    <div\r\n      className=\"rp-side-card rp-card-anim\"\r\n      style={{\r\n        minHeight: \"calc(100vh - 28px)\",\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n      }}\r\n    >\r\n      <div className=\"rp-brand\">\r\n        <div className=\"rp-brand-logo\">\r\n          <Image src=\"/images/logo/logo.png\" alt=\"Ram Pottery Ltd\" width={30} height={30} priority />\r\n        </div>\r\n        <div>\r\n          <div className=\"rp-brand-title\">RampotteryHUB</div>\r\n          <div className=\"rp-brand-sub\">Accounting & Stock System</div>\r\n        </div>\r\n      </div>\r\n\r\n      <nav className=\"rp-nav\" style={{ flex: 1 }}>\r\n        {navItems.map((it) => (\r\n          <Link\r\n            key={it.href}\r\n            className={`rp-nav-btn ${it.href === \"/invoices\" ? \"rp-nav-btn--active\" : \"\"}`}\r\n            href={it.href}\r\n            onClick={() => setDrawerOpen(false)}\r\n          >\r\n            <span className=\"rp-ic3d\" aria-hidden=\"true\">\r\n              â–¶\r\n            </span>\r\n            {it.label}\r\n          </Link>\r\n        ))}\r\n      </nav>\r\n\r\n      <div className=\"rp-side-footer rp-side-footer--in\" style={{ marginTop: \"auto\" }}>\r\n        <div className=\"rp-role\">\r\n          <span>Signed in</span>\r\n          <b title={userLabel}>{mounted ? userLabel : \"â€”\"}</b>\r\n        </div>\r\n        <div className=\"rp-role\" style={{ marginTop: 10 }}>\r\n          <span>Role</span>\r\n          <b>{mounted ? roleLabel : \"â€”\"}</b>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const emptyColSpan = 8 + (showDiscount ? 1 : 0);\r\n\r\n  return (\r\n    <div className=\"rp-app\">\r\n      <div className=\"rp-bg\" aria-hidden=\"true\">\r\n        <div className=\"rp-bg-orb rp-bg-orb--1\" />\r\n        <div className=\"rp-bg-orb rp-bg-orb--2\" />\r\n        <div className=\"rp-bg-orb rp-bg-orb--3\" />\r\n        <div className=\"rp-bg-grid\" />\r\n      </div>\r\n\r\n      <div className=\"rp-shell rp-enter\">\r\n        {/* Mobile top bar */}\r\n        <div className=\"rp-mtop\">\r\n          <button\r\n            type=\"button\"\r\n            className=\"rp-icon-btn rp-burger\"\r\n            onClick={() => setDrawerOpen(true)}\r\n            aria-label=\"Open menu\"\r\n          >\r\n            <span aria-hidden=\"true\">\r\n              <i />\r\n              <i />\r\n              <i />\r\n            </span>\r\n          </button>\r\n\r\n          <div className=\"rp-mtop-brand\">\r\n            <div className=\"rp-mtop-title\">RampotteryHUB</div>\r\n            <div className=\"rp-mtop-sub\">Invoices</div>\r\n          </div>\r\n\r\n          <button type=\"button\" className=\"rp-icon-btn\" onClick={toggleTheme} aria-label=\"Toggle theme\">\r\n            {theme === \"dark\" ? \"â˜€\" : \"ðŸŒ™\"}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Overlay + Drawer */}\r\n        <button\r\n          className={`rp-overlay ${drawerOpen ? \"is-open\" : \"\"}`}\r\n          onClick={() => setDrawerOpen(false)}\r\n          aria-label=\"Close menu\"\r\n        />\r\n        <aside className={`rp-drawer ${drawerOpen ? \"is-open\" : \"\"}`}>\r\n          <div className=\"rp-drawer-head\">\r\n            <div className=\"rp-drawer-brand\">\r\n              <div className=\"rp-drawer-logo\">\r\n                <Image src=\"/images/logo/logo.png\" alt=\"Ram Pottery Ltd\" width={28} height={28} priority />\r\n              </div>\r\n              <div>\r\n                <div className=\"rp-drawer-title\">RampotteryHUB</div>\r\n                <div className=\"rp-drawer-sub\">Accounting & Stock System</div>\r\n              </div>\r\n            </div>\r\n\r\n            <button type=\"button\" className=\"rp-icon-btn\" onClick={() => setDrawerOpen(false)} aria-label=\"Close\">\r\n              âœ•\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"rp-drawer-body\">{SideCard}</div>\r\n        </aside>\r\n\r\n        {/* Desktop sidebar */}\r\n        <aside className=\"rp-side\">{SideCard}</aside>\r\n\r\n        {/* Main */}\r\n        <main className=\"rp-main\">\r\n          {/* Top bar */}\r\n          <header className=\"rp-top rp-top--saas rp-card-anim\" style={{ animationDelay: \"60ms\" }}>\r\n            <div className=\"rp-top-left--actions\">\r\n              <button type=\"button\" className=\"rp-ui-btn rp-ui-btn--brand\" onClick={toggleTheme}>\r\n                <span className=\"rp-ui-btn__dot\" aria-hidden=\"true\" />\r\n                {theme === \"dark\" ? \"â˜€ Light\" : \"ðŸŒ™ Dark\"}\r\n              </button>\r\n\r\n              <button type=\"button\" className=\"rp-ui-btn rp-ui-btn--danger\" onClick={handleLogout}>\r\n                <span className=\"rp-ui-btn__dot\" aria-hidden=\"true\" />\r\n                Log Out\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"rp-top-center--logo\">\r\n              <div className=\"rp-top-logo\">\r\n                <Image src=\"/images/logo/logo.png\" alt=\"Ram Pottery\" width={44} height={44} priority />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"rp-top-right--sync\">\r\n              <div className=\"rp-sync\">\r\n                <div className=\"rp-sync-label\">Last sync :</div>\r\n                <div className=\"rp-sync-time\">{lastSync || \"â€”\"}</div>\r\n              </div>\r\n            </div>\r\n          </header>\r\n\r\n          {/* Executive header */}\r\n          <section className=\"rp-exec rp-card-anim\">\r\n            <div className=\"rp-exec__left\">\r\n              <div className=\"rp-exec__title\">Invoices</div>\r\n              <div className=\"rp-exec__sub\">Reprint â€¢ Duplicate â€¢ Payments â€¢ Mark Paid â€¢ Void (Admin)</div>\r\n            </div>\r\n            <div className=\"rp-exec__right\">\r\n              <span className={`rp-live ${loading ? \"is-dim\" : \"\"}`}>\r\n                <span className=\"rp-live-dot\" aria-hidden=\"true\" />\r\n                {loading ? \"Syncing\" : \"Live\"}\r\n              </span>\r\n              <span className={`rp-chip rp-chip--soft ${err ? \"rp-chip--warn\" : \"\"}`}>\r\n                {err ? \"Attention needed\" : \"All systems normal\"}\r\n              </span>\r\n            </div>\r\n          </section>\r\n\r\n          {/* KPI row */}\r\n          <section className=\"rp-kpi-pro rp-card-anim\">\r\n            <div className=\"rp-kpi-pro__cell\">\r\n              <div className=\"rp-kpi-pro__title\">Invoices</div>\r\n              <div className=\"rp-kpi-pro__value\">{kpis.count}</div>\r\n              <div className=\"rp-kpi-pro__sub\">Filtered results</div>\r\n            </div>\r\n            <div className=\"rp-kpi-pro__cell\">\r\n              <div className=\"rp-kpi-pro__title\">Total</div>\r\n              <div className=\"rp-kpi-pro__value\">{rs(kpis.total)}</div>\r\n              <div className=\"rp-kpi-pro__sub\">Total invoice value</div>\r\n            </div>\r\n            <div className=\"rp-kpi-pro__cell\">\r\n              <div className=\"rp-kpi-pro__title\">Paid</div>\r\n              <div className=\"rp-kpi-pro__value\">{rs(kpis.paid)}</div>\r\n              <div className=\"rp-kpi-pro__sub\">Collected</div>\r\n            </div>\r\n            <div className=\"rp-kpi-pro__cell\">\r\n              <div className=\"rp-kpi-pro__title\">Outstanding</div>\r\n              <div className=\"rp-kpi-pro__value\">{rs(kpis.balance)}</div>\r\n              <div className=\"rp-kpi-pro__sub\">Balance due</div>\r\n            </div>\r\n          </section>\r\n\r\n          {/* Quick actions */}\r\n          <section className=\"rp-actions rp-card-anim\">\r\n            <div className=\"rp-seg rp-seg--pro\">\r\n              <Link className=\"rp-seg-item rp-seg-item--brand\" href=\"/invoices/new\">\r\n                <span className=\"rp-icbtn\" aria-hidden=\"true\">\r\n                  ðŸ§¾\r\n                </span>\r\n                New Invoice\r\n              </Link>\r\n\r\n              <button type=\"button\" className=\"rp-seg-item rp-seg-item--brand\" onClick={load} disabled={loading}>\r\n                <span className=\"rp-icbtn\" aria-hidden=\"true\">\r\n                  âŸ³\r\n                </span>\r\n                {loading ? \"Loadingâ€¦\" : \"Refresh\"}\r\n              </button>\r\n            </div>\r\n          </section>\r\n\r\n          {/* Search + filters */}\r\n          <section className=\"rp-card rp-card-anim\">\r\n            <div className=\"rp-card-head rp-card-head--tight\">\r\n              <div>\r\n                <div className=\"rp-card-title\">Search & Filters</div>\r\n                <div className=\"rp-card-sub\">Invoice no â€¢ customer â€¢ code â€¢ status</div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"rp-card-body\">\r\n              <div className=\"rp-filters-row\">\r\n                <input\r\n                  className=\"rp-input rp-input--full\"\r\n                  placeholder=\"Search invoice or customerâ€¦\"\r\n                  value={searchDraft}\r\n                  onChange={(e) => setSearchDraft(e.target.value)}\r\n                  onKeyDown={(e) => {\r\n                    if (e.key === \"Enter\") applySearch();\r\n                    if (e.key === \"Escape\") clearSearch();\r\n                  }}\r\n                />\r\n\r\n                <button type=\"button\" className=\"rp-ui-btn rp-ui-btn--brand\" onClick={applySearch}>\r\n                  <span className=\"rp-ui-btn__dot\" aria-hidden=\"true\" />\r\n                  Search\r\n                </button>\r\n\r\n                <button type=\"button\" className=\"rp-ui-btn\" onClick={clearSearch}>\r\n                  <span className=\"rp-ui-btn__dot\" aria-hidden=\"true\" />\r\n                  Clear\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"rp-chip-row\">\r\n                {([\"All\", \"Issued\", \"Paid\", \"Partially Paid\", \"Void\"] as const).map((s) => (\r\n                  <button\r\n                    key={s}\r\n                    className={`rp-filter-pill ${status === s ? \"rp-filter-pill--active\" : \"\"}`}\r\n                    onClick={() => setStatus(s)}\r\n                  >\r\n                    {s}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n\r\n              {err ? <div className=\"rp-note rp-note--warn\">{err}</div> : null}\r\n            </div>\r\n          </section>\r\n\r\n          {/* ===== SINGLE TABLE (desktop + mobile) ===== */}\r\n          <section className=\"rp-card rp-card-anim\">\r\n            <div className=\"rp-card-head rp-card-head--tight\">\r\n              <div>\r\n                <div className=\"rp-card-title\">Invoice Register</div>\r\n                <div className=\"rp-card-sub\">\r\n                  Clean view â€¢ scroll on mobile â€¢ pinned first column\r\n                  {showDiscount ? \" â€¢ discount snapshot (audit-proof)\" : \"\"}\r\n                </div>\r\n              </div>\r\n              <span className={`rp-chip ${loading ? \"is-dim\" : \"\"}`}>{loading ? \"Loadingâ€¦\" : \"Ready\"}</span>\r\n            </div>\r\n\r\n            <div className=\"rp-card-body\">\r\n              {/* âœ… Premium wrapper + mobile scroll */}\r\n              <div className=\"rp-table-wrap\">\r\n                <div className=\"rp-table-scroll\">\r\n                  <div className=\"rp-table-scroll__inner\">\r\n                    <table className=\"rp-table rp-table--premium\">\r\n                      <thead>\r\n                        <tr>\r\n                          {/* âœ… pinned first column */}\r\n                          <th className=\"rp-pin\" style={{ width: 140 }}>\r\n                            Invoice\r\n                          </th>\r\n                          <th style={{ width: 120 }}>Date</th>\r\n                          <th style={{ minWidth: 220 }}>Customer</th>\r\n\r\n                          <th className=\"rp-right rp-col-hide-sm\" style={{ width: 140 }}>\r\n                            Total\r\n                          </th>\r\n\r\n                          {/* âœ… Discount column appears ONLY if any invoice has discount */}\r\n                          {showDiscount ? (\r\n                            <th className=\"rp-right rp-col-hide-sm\" style={{ width: 160 }}>\r\n                              Discount\r\n                            </th>\r\n                          ) : null}\r\n\r\n                          <th className=\"rp-right rp-col-hide-sm\" style={{ width: 140 }}>\r\n                            Paid\r\n                          </th>\r\n                          <th className=\"rp-right rp-col-hide-sm\" style={{ width: 150 }}>\r\n                            Balance\r\n                          </th>\r\n                          <th style={{ width: 120 }}>Status</th>\r\n\r\n                          {/* âœ… optional pinned right actions */}\r\n                          <th className=\"rp-pin-right\" style={{ width: 64 }} />\r\n                        </tr>\r\n                      </thead>\r\n\r\n                      <tbody>\r\n                        {filtered.length === 0 ? (\r\n                          <tr>\r\n                            <td colSpan={emptyColSpan} className=\"rp-td-empty\">\r\n                              {loading ? \"Loading invoicesâ€¦\" : \"No invoices found.\"}\r\n                            </td>\r\n                          </tr>\r\n                        ) : (\r\n                          filtered.map((r) => {\r\n                            const st = normalizeStatus(r.status);\r\n                            const allowDuplicate = canDuplicate(session?.role);\r\n                            const allowVoid = isAdmin(session?.role) && st !== \"Void\";\r\n\r\n                            const hasDisc = n(r?.discount_percent) > 0 || n(r?.discount_amount) > 0;\r\n                            const wa = normalizeMuPhone(r.customers?.whatsapp || r.customers?.phone || \"\");\r\n\r\n\r\n                            return (\r\n                              <tr key={String(r.id)} className=\"rp-row-hover\">\r\n                                {/* âœ… pinned first column cell */}\r\n                                <td className=\"rp-pin rp-strong\">\r\n                                  <button\r\n                                    type=\"button\"\r\n                                    className=\"rp-row-link\"\r\n                                    onClick={() => router.push(`/invoices/${r.id}`)}\r\n                                  >\r\n                                    {r.invoice_number || `#${r.id}`}\r\n                                  </button>\r\n                                </td>\r\n\r\n                                <td>{fmtDate(r.invoice_date)}</td>\r\n\r\n                                <td>\r\n                                  <div className=\"rp-strong\" style={{ display: \"flex\", alignItems: \"center\", gap: 8 }}>\r\n                                                                                    <span>{r.customers?.name || \"â€”\"}</span>\r\n                                                                                     {wa ? <span title={`WhatsApp: ${wa}`}>ðŸŸ¢</span> : null}\r\n                                                                                  </div>\r\n\r\n                                  <div className=\"rp-muted\">{r.customers?.customer_code || \"\"}</div>\r\n\r\n                                  {/* Mobile compact amounts (shown only on small screens) */}\r\n                                  <div className=\"rp-only-sm\">\r\n                                    <div className=\"rp-mini-row\">\r\n                                      <span>Total</span>\r\n                                      <b>{rs(n(r.total_amount))}</b>\r\n                                    </div>\r\n\r\n                                    {showDiscount ? (\r\n                                      <div className=\"rp-mini-row\">\r\n                                        <span>Discount</span>\r\n                                        <b style={{ color: hasDisc ? \"#b91c1c\" : \"inherit\" }}>{discountText(r)}</b>\r\n                                      </div>\r\n                                    ) : null}\r\n\r\n                                    <div className=\"rp-mini-row\">\r\n                                      <span>Paid</span>\r\n                                      <b>{rs(n(r.amount_paid))}</b>\r\n                                    </div>\r\n                                    <div className=\"rp-mini-row\">\r\n                                      <span>Balance</span>\r\n                                      <b>{rs(n(r.balance_remaining))}</b>\r\n                                    </div>\r\n                                  </div>\r\n                                </td>\r\n\r\n                                <td className=\"rp-right rp-col-hide-sm\">{rs(n(r.total_amount))}</td>\r\n\r\n                                {showDiscount ? (\r\n                                  <td\r\n                                    className=\"rp-right rp-col-hide-sm\"\r\n                                    style={{ color: hasDisc ? \"#b91c1c\" : \"inherit\", fontWeight: hasDisc ? 900 : 700 }}\r\n                                    title={hasDisc ? \"Discount snapshot stored on invoice\" : \"\"}\r\n                                  >\r\n                                    {discountText(r)}\r\n                                  </td>\r\n                                ) : null}\r\n\r\n                                <td className=\"rp-right rp-col-hide-sm\">{rs(n(r.amount_paid))}</td>\r\n                                <td className=\"rp-right rp-col-hide-sm\">{rs(n(r.balance_remaining))}</td>\r\n\r\n                                <td>\r\n                                  <span className={statusBadgeClass(r.status)}>{st}</span>\r\n                                </td>\r\n\r\n                                {/* â‹® menu (same as current invoices) â€” pinned right */}\r\n                                <td className=\"rp-actions-cell rp-pin-right\">\r\n                                  <button\r\n                                    type=\"button\"\r\n                                    className=\"rp-row-actions-btn\"\r\n                                    aria-label=\"Invoice actions\"\r\n                                    onClick={(e) => {\r\n                                      e.stopPropagation();\r\n                                      setOpenMenu(openMenu === r.id ? null : r.id);\r\n                                    }}\r\n                                  >\r\n                                    â‹®\r\n                                  </button>\r\n\r\n                                  {openMenu === r.id && (\r\n                                    <div className=\"rp-row-actions-menu\" onClick={(e) => e.stopPropagation()}>\r\n                                      <button\r\n                                        onClick={() => {\r\n                                          setOpenMenu(null);\r\n                                          router.push(`/invoices/${r.id}`);\r\n                                        }}\r\n                                      >\r\n                                        Reprint\r\n                                      </button>\r\n\r\n                                      {allowDuplicate && (\r\n                                        <button onClick={() => duplicateInvoicePrefill(r.id)}>Duplicate</button>\r\n                                      )}\r\n\r\n                                     {st !== \"Void\" && (\r\n  <>\r\n    <div className=\"rp-row-actions-sep\" />\r\n\r\n    {/* âœ… Option 1 (No Meta): staff clicks Send in WhatsApp */}\r\n    <button onClick={() => openPaymentModal(r)}>Set Paymentâ€¦</button>\r\n\r\n    {st !== \"Paid\" && <button onClick={() => markAsPaid(r.id)}>Mark as Paid</button>}\r\n\r\n    {allowVoid && (\r\n      <button className=\"danger\" onClick={() => voidInvoice(r.id)}>\r\n        Void Invoice\r\n      </button>\r\n    )}\r\n  </>\r\n)}\r\n\r\n\r\n                                    </div>\r\n                                  )}\r\n                                </td>\r\n                              </tr>\r\n                            );\r\n                          })\r\n                        )}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              {/* /table-wrap */}\r\n            </div>\r\n          </section>\r\n\r\n          <footer className=\"rp-footer\">Â© {new Date().getFullYear()} Ram Pottery Ltd â€¢ Built by Mobiz.mu</footer>\r\n        </main>\r\n      </div>\r\n\r\n      {/* ===== Payment Modal ===== */}\r\n      {payOpen && (\r\n        <>\r\n          <button className=\"rp-modal-overlay\" onClick={() => (!paySaving ? setPayOpen(false) : null)} />\r\n          <div\r\n            className=\"rp-modal\"\r\n            onKeyDown={(e) => {\r\n              if (e.key === \"Escape\" && !paySaving) setPayOpen(false);\r\n              if (e.key === \"Enter\" && !paySaving) savePayment();\r\n            }}\r\n          >\r\n            <div className=\"rp-modal-head\">\r\n              <div>\r\n                <div className=\"rp-modal-title\">Set Payment</div>\r\n                <div className=\"rp-modal-sub\">\r\n                  {payInvoice?.invoice_number || \"\"} â€¢ {payInvoice?.customers?.name || \"\"}\r\n                </div>\r\n              </div>\r\n              <button className=\"rp-icon-btn\" onClick={() => (!paySaving ? setPayOpen(false) : null)}>\r\n                âœ•\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"rp-modal-body\">\r\n              <div className=\"rp-field\">\r\n                <label className=\"rp-label\">Amount Paid</label>\r\n                <input\r\n                  ref={payInputRef}\r\n                  className=\"rp-input rp-input--full rp-input--right\"\r\n                  value={payAmount}\r\n                  onChange={(e) => setPayAmount(n(e.target.value))}\r\n                />\r\n                <div className=\"rp-help\">\r\n                  Total: <b>{rs(n(payInvoice?.gross_total ?? payInvoice?.total_amount))}</b> â€¢ Current paid:{\" \"}\r\n                  <b>{rs(n(payInvoice?.amount_paid))}</b>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"rp-modal-actions\">\r\n                <button className=\"rp-ui-btn\" onClick={() => setPayOpen(false)} disabled={paySaving}>\r\n                  Cancel\r\n                </button>\r\n                <button className=\"rp-ui-btn rp-ui-btn--brand\" onClick={savePayment} disabled={paySaving}>\r\n                  {paySaving ? \"Savingâ€¦\" : \"Save Payment\"}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}