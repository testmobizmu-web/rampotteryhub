{"version":3,"sources":["../../../../app/credit-notes/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport Image from \"next/image\";\r\nimport { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { rpFetch } from \"@/lib/rpFetch\";\r\n\r\ntype RpSession = {\r\n  id?: string;\r\n  username?: string;\r\n  name?: string;\r\n  role?: string;\r\n};\r\n\r\ntype CustomerLite = {\r\n  name?: string | null;\r\n  customer_code?: string | null;\r\n};\r\n\r\ntype CreditNoteRow = {\r\n  id: number;\r\n  credit_note_number: string | null;\r\n  credit_note_date: string | null;\r\n  total_amount: number | string | null;\r\n  status: string | null;\r\n  customers?: CustomerLite | CustomerLite[] | null;\r\n};\r\n\r\ntype FilterKey = \"ALL\" | \"ISSUED\" | \"PENDING\" | \"REFUNDED\" | \"VOID\";\r\n\r\nfunction roleUpper(r?: string) {\r\n  return String(r || \"\").toUpperCase();\r\n}\r\nfunction isAdmin(r?: string) {\r\n  return roleUpper(r) === \"ADMIN\";\r\n}\r\n\r\nfunction n2(v: any) {\r\n  const x = Number(v ?? 0);\r\n  return Number.isFinite(x) ? x : 0;\r\n}\r\nfunction money(v: any) {\r\n  return n2(v).toFixed(2);\r\n}\r\n\r\nfunction fmtDate(d: any) {\r\n  if (!d) return \"â€”\";\r\n  try {\r\n    const x = new Date(d);\r\n    if (Number.isNaN(x.getTime())) return String(d);\r\n    return x.toLocaleDateString(\"en-GB\");\r\n  } catch {\r\n    return String(d);\r\n  }\r\n}\r\nfunction fmtDateTime(d: Date) {\r\n  return d.toLocaleString(\"en-GB\", {\r\n    day: \"2-digit\",\r\n    month: \"2-digit\",\r\n    year: \"numeric\",\r\n    hour: \"2-digit\",\r\n    minute: \"2-digit\",\r\n    second: \"2-digit\",\r\n  });\r\n}\r\n\r\nfunction normalizeCustomer(c: CreditNoteRow[\"customers\"]): CustomerLite | null {\r\n  if (!c) return null;\r\n  if (Array.isArray(c)) return (c[0] as any) || null;\r\n  return c as any;\r\n}\r\n\r\nfunction badgeForCredit(status: any): { key: FilterKey; label: string; cls: string } {\r\n  const s = String(status || \"\").toUpperCase();\r\n\r\n  if (s === \"VOID\") return { key: \"VOID\", label: \"VOID\", cls: \"rp-badge rp-badge--void\" };\r\n  if (s === \"REFUNDED\") return { key: \"REFUNDED\", label: \"REFUNDED\", cls: \"rp-badge rp-badge--refunded\" };\r\n  if (s === \"PENDING\") return { key: \"PENDING\", label: \"PENDING\", cls: \"rp-badge rp-badge--pending\" };\r\n\r\n  return { key: \"ISSUED\", label: \"ISSUED\", cls: \"rp-badge rp-badge--issued\" };\r\n}\r\n\r\nfunction downloadCsv(filename: string, headers: string[], rows: (string | number)[][]) {\r\n  const esc = (s: any) => {\r\n    const str = String(s ?? \"\");\r\n    if (str.includes(\",\") || str.includes('\"') || str.includes(\"\\n\")) return `\"${str.replace(/\"/g, '\"\"')}\"`;\r\n    return str;\r\n  };\r\n\r\n  const csv = [headers.map(esc).join(\",\"), ...rows.map((r) => r.map(esc).join(\",\"))].join(\"\\n\");\r\n  const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" });\r\n  const url = URL.createObjectURL(blob);\r\n\r\n  const a = document.createElement(\"a\");\r\n  a.href = url;\r\n  a.download = filename;\r\n  a.click();\r\n\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\nfunction mapRow(r: any): CreditNoteRow {\r\n  return {\r\n    id: Number(r?.id || 0),\r\n    credit_note_number: r?.credit_note_number ?? null,\r\n    credit_note_date: r?.credit_note_date ?? null,\r\n    total_amount: r?.total_amount ?? 0,\r\n    status: r?.status ?? \"ISSUED\",\r\n    customers: r?.customers ?? null,\r\n  };\r\n}\r\n\r\nexport default function CreditNotesPage() {\r\n  const printRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  // UI shell\r\n  const [drawerOpen, setDrawerOpen] = useState(false);\r\n  const [theme, setTheme] = useState<\"light\" | \"dark\">(\"light\");\r\n  const [mounted, setMounted] = useState(false);\r\n  const [session, setSession] = useState<RpSession | null>(null);\r\n  const [lastSync, setLastSync] = useState<string>(\"â€”\");\r\n\r\n  // Data\r\n  const [rows, setRows] = useState<CreditNoteRow[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [err, setErr] = useState<string | null>(null);\r\n\r\n  // Filters\r\n  const [qDraft, setQDraft] = useState(\"\");\r\n  const [qApplied, setQApplied] = useState(\"\");\r\n  const [filter, setFilter] = useState<FilterKey>(\"ALL\");\r\n  const [pulse, setPulse] = useState(false);\r\n\r\n  // â‹® actions\r\n  const [openMenu, setOpenMenu] = useState<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n\r\n    const saved = localStorage.getItem(\"rp_theme\");\r\n    const initial = saved === \"dark\" ? \"dark\" : \"light\";\r\n    setTheme(initial);\r\n    document.documentElement.dataset.theme = initial;\r\n\r\n    try {\r\n      const raw = localStorage.getItem(\"rp_user\");\r\n      if (raw) setSession(JSON.parse(raw));\r\n    } catch {\r\n      setSession(null);\r\n    }\r\n  }, []);\r\n\r\n  // lock scroll when drawer open\r\n  useEffect(() => {\r\n    document.body.style.overflow = drawerOpen ? \"hidden\" : \"\";\r\n    return () => {\r\n      document.body.style.overflow = \"\";\r\n    };\r\n  }, [drawerOpen]);\r\n\r\n  // close â‹® on outside click\r\n  useEffect(() => {\r\n    const close = () => setOpenMenu(null);\r\n    window.addEventListener(\"click\", close);\r\n    return () => window.removeEventListener(\"click\", close);\r\n  }, []);\r\n\r\n  // ESC closes drawer + â‹®\r\n  useEffect(() => {\r\n    const onKey = (e: KeyboardEvent) => {\r\n      if (e.key === \"Escape\") {\r\n        setDrawerOpen(false);\r\n        setOpenMenu(null);\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, []);\r\n\r\n  function toggleTheme() {\r\n    const next = theme === \"dark\" ? \"light\" : \"dark\";\r\n    setTheme(next);\r\n    document.documentElement.dataset.theme = next;\r\n    localStorage.setItem(\"rp_theme\", next);\r\n  }\r\n\r\n  async function handleLogout() {\r\n    try {\r\n      await fetch(\"/api/auth/logout\", { method: \"POST\" });\r\n    } finally {\r\n      localStorage.removeItem(\"rp_user\");\r\n      window.location.href = \"/login\";\r\n    }\r\n  }\r\n\r\n  const canSeeAdminNav = mounted && isAdmin(session?.role);\r\n\r\n  const navItems = useMemo(() => {\r\n    const base = [\r\n      { href: \"/\", label: \"Dashboard\" },\r\n      { href: \"/invoices\", label: \"Invoices\" },\r\n      { href: \"/credit-notes\", label: \"Credit Notes\" },\r\n      { href: \"/products\", label: \"Stock & Categories\" },\r\n      { href: \"/stock-movements\", label: \"Stock Movements\" },\r\n      { href: \"/customers\", label: \"Customers\" },\r\n      { href: \"/suppliers\", label: \"Suppliers\" },\r\n      { href: \"/reports\", label: \"Reports & Statements\" },\r\n    ];\r\n    if (canSeeAdminNav) base.push({ href: \"/admin/users\", label: \"Users & Permissions\" });\r\n    return base;\r\n  }, [canSeeAdminNav]);\r\n\r\n  const userLabel = useMemo(() => {\r\n    const name = (session?.name || session?.username || \"\").trim();\r\n    return name ? name : \"User\";\r\n  }, [session]);\r\n\r\n  const roleLabel = useMemo(() => roleUpper(session?.role) || \"STAFF\", [session]);\r\n\r\n  async function load() {\r\n    setLoading(true);\r\n    setErr(null);\r\n\r\n    try {\r\n      const res = await rpFetch(\"/api/credit-notes\", { cache: \"no-store\" });\r\n      const json = await res.json().catch(() => ({}));\r\n\r\n      if (!res.ok || json?.ok === false) {\r\n        throw new Error(json?.error || \"Failed to load credit notes\");\r\n      }\r\n\r\n      const listRaw = json?.creditNotes ?? [];\r\n      const mapped = Array.isArray(listRaw) ? listRaw.map(mapRow) : [];\r\n      mapped.sort((a, b) => (b.id || 0) - (a.id || 0));\r\n      setRows(mapped);\r\n\r\n      setLastSync(fmtDateTime(new Date()));\r\n    } catch (e: any) {\r\n      setErr(e?.message || \"Failed to load credit notes\");\r\n      setRows([]);\r\n      setLastSync(fmtDateTime(new Date()));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    void load();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setPulse(qDraft.trim() !== qApplied.trim());\r\n  }, [qDraft, qApplied]);\r\n\r\n  function applySearch() {\r\n    setQApplied(qDraft.trim());\r\n  }\r\n\r\n  function clearAll() {\r\n    setQDraft(\"\");\r\n    setQApplied(\"\");\r\n    setFilter(\"ALL\");\r\n  }\r\n\r\n  const filtered = useMemo(() => {\r\n    const needle = qApplied.trim().toLowerCase();\r\n\r\n    return rows\r\n      .filter((r) => {\r\n        if (filter === \"ALL\") return true;\r\n        const b = badgeForCredit(r.status);\r\n        return b.key === filter;\r\n      })\r\n      .filter((r) => {\r\n        if (!needle) return true;\r\n        const c = normalizeCustomer(r.customers);\r\n        const hay = [\r\n          r.credit_note_number || \"\",\r\n          r.credit_note_date || \"\",\r\n          r.status || \"\",\r\n          c?.name || \"\",\r\n          c?.customer_code || \"\",\r\n        ]\r\n          .join(\" \")\r\n          .toLowerCase();\r\n        return hay.includes(needle);\r\n      });\r\n  }, [rows, qApplied, filter]);\r\n\r\n  const totals = useMemo(() => {\r\n    const sumTotal = filtered.reduce((a, r) => a + n2(r.total_amount), 0);\r\n    const pending = filtered.filter((r) => badgeForCredit(r.status).key === \"PENDING\").length;\r\n    const issued = filtered.filter((r) => badgeForCredit(r.status).key === \"ISSUED\").length;\r\n    const voided = filtered.filter((r) => badgeForCredit(r.status).key === \"VOID\").length;\r\n    return { count: filtered.length, sumTotal, pending, issued, voided };\r\n  }, [filtered]);\r\n\r\n  function exportCsv() {\r\n    const headers = [\"Credit Note No\", \"Date\", \"Customer\", \"Customer Code\", \"Total (Rs)\", \"Status\"];\r\n    const dataRows = filtered.map((r) => {\r\n      const c = normalizeCustomer(r.customers);\r\n      const badge = badgeForCredit(r.status);\r\n      return [\r\n        r.credit_note_number || `#${r.id}`,\r\n        fmtDate(r.credit_note_date),\r\n        c?.name || \"\",\r\n        c?.customer_code || \"\",\r\n        money(r.total_amount),\r\n        badge.label,\r\n      ];\r\n    });\r\n\r\n    downloadCsv(`credit_notes_${new Date().toISOString().slice(0, 10)}.csv`, headers, dataRows);\r\n  }\r\n\r\n  function printListOnly() {\r\n    const el = printRef.current;\r\n    if (!el) return window.print();\r\n\r\n    const html = `<!doctype html>\r\n<html>\r\n<head>\r\n  <meta charset=\"utf-8\" />\r\n  <title>Credit Notes</title>\r\n  <style>\r\n    body{font-family: Arial, sans-serif; padding: 22px;}\r\n    h1{font-size: 18px; margin: 0 0 10px;}\r\n    .meta{color:#555;font-size:12px;margin:0 0 16px;}\r\n    table{width:100%; border-collapse:collapse; font-size:12px;}\r\n    th,td{border:1px solid #ddd; padding:8px; text-align:left;}\r\n    th{background:#f4f4f4;}\r\n    .right{text-align:right;}\r\n  </style>\r\n</head>\r\n<body>\r\n  <h1>Credit Notes</h1>\r\n  <div class=\"meta\">Generated: ${fmtDateTime(new Date())}</div>\r\n  ${el.innerHTML}\r\n  <script>window.onload=()=>window.print();</script>\r\n</body>\r\n</html>`;\r\n\r\n    const w = window.open(\"\", \"_blank\", \"width=1000,height=700\");\r\n    if (!w) return;\r\n    w.document.open();\r\n    w.document.write(html);\r\n    w.document.close();\r\n  }\r\n\r\n  const filterPills: Array<{ key: FilterKey; label: string }> = [\r\n    { key: \"ALL\", label: \"All\" },\r\n    { key: \"ISSUED\", label: \"Issued\" },\r\n    { key: \"PENDING\", label: \"Pending\" },\r\n    { key: \"REFUNDED\", label: \"Refunded\" },\r\n    { key: \"VOID\", label: \"Void\" },\r\n  ];\r\n\r\n  const SideCard = (\r\n    <div\r\n      className=\"rp-side-card rp-card-anim\"\r\n      style={{\r\n        minHeight: \"calc(100vh - 28px)\",\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n      }}\r\n    >\r\n      <div className=\"rp-brand\">\r\n        <div className=\"rp-brand-logo\">\r\n          <Image src=\"/images/logo/logo.png\" alt=\"Ram Pottery Ltd\" width={30} height={30} priority />\r\n        </div>\r\n        <div>\r\n          <div className=\"rp-brand-title\">RampotteryHUB</div>\r\n          <div className=\"rp-brand-sub\">Accounting & Stock System</div>\r\n        </div>\r\n      </div>\r\n\r\n      <nav className=\"rp-nav\" style={{ flex: 1 }}>\r\n        {navItems.map((it) => (\r\n          <Link\r\n            key={it.href}\r\n            className={`rp-nav-btn ${it.href === \"/credit-notes\" ? \"rp-nav-btn--active\" : \"\"}`}\r\n            href={it.href}\r\n            onClick={() => setDrawerOpen(false)}\r\n          >\r\n            <span className=\"rp-ic3d\" aria-hidden=\"true\">\r\n              â–¶\r\n            </span>\r\n            {it.label}\r\n          </Link>\r\n        ))}\r\n      </nav>\r\n\r\n      <div className=\"rp-side-footer rp-side-footer--in\" style={{ marginTop: \"auto\" }}>\r\n        <div className=\"rp-role\">\r\n          <span>Signed in</span>\r\n          <b title={userLabel}>{mounted ? userLabel : \"â€”\"}</b>\r\n        </div>\r\n        <div className=\"rp-role\" style={{ marginTop: 10 }}>\r\n          <span>Role</span>\r\n          <b>{mounted ? roleLabel : \"â€”\"}</b>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"rp-app\">\r\n      <div className=\"rp-bg\" aria-hidden=\"true\">\r\n        <div className=\"rp-bg-orb rp-bg-orb--1\" />\r\n        <div className=\"rp-bg-orb rp-bg-orb--2\" />\r\n        <div className=\"rp-bg-orb rp-bg-orb--3\" />\r\n        <div className=\"rp-bg-grid\" />\r\n      </div>\r\n\r\n      <div className=\"rp-shell rp-enter\">\r\n        {/* Mobile top bar */}\r\n        <div className=\"rp-mtop\">\r\n          <button type=\"button\" className=\"rp-icon-btn rp-burger\" onClick={() => setDrawerOpen(true)} aria-label=\"Open menu\">\r\n            <span aria-hidden=\"true\">\r\n              <i />\r\n              <i />\r\n              <i />\r\n            </span>\r\n          </button>\r\n\r\n          <div className=\"rp-mtop-brand\">\r\n            <div className=\"rp-mtop-title\">RampotteryHUB</div>\r\n            <div className=\"rp-mtop-sub\">Credit Notes</div>\r\n          </div>\r\n\r\n          <button type=\"button\" className=\"rp-icon-btn\" onClick={toggleTheme} aria-label=\"Toggle theme\">\r\n            {theme === \"dark\" ? \"â˜€\" : \"ðŸŒ™\"}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Overlay + Drawer */}\r\n        <button className={`rp-overlay ${drawerOpen ? \"is-open\" : \"\"}`} onClick={() => setDrawerOpen(false)} aria-label=\"Close menu\" />\r\n        <aside className={`rp-drawer ${drawerOpen ? \"is-open\" : \"\"}`}>\r\n          <div className=\"rp-drawer-head\">\r\n            <div className=\"rp-drawer-brand\">\r\n              <div className=\"rp-drawer-logo\">\r\n                <Image src=\"/images/logo/logo.png\" alt=\"Ram Pottery Ltd\" width={28} height={28} priority />\r\n              </div>\r\n              <div>\r\n                <div className=\"rp-drawer-title\">RampotteryHUB</div>\r\n                <div className=\"rp-drawer-sub\">Accounting & Stock System</div>\r\n              </div>\r\n            </div>\r\n\r\n            <button type=\"button\" className=\"rp-icon-btn\" onClick={() => setDrawerOpen(false)} aria-label=\"Close\">\r\n              âœ•\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"rp-drawer-body\">{SideCard}</div>\r\n        </aside>\r\n\r\n        {/* Desktop sidebar */}\r\n        <aside className=\"rp-side\">{SideCard}</aside>\r\n\r\n        {/* Main */}\r\n        <main className=\"rp-main\">\r\n          {/* Top header */}\r\n          <header className=\"rp-top rp-top--saas rp-card-anim\" style={{ animationDelay: \"60ms\" }}>\r\n            <div className=\"rp-top-left--actions\">\r\n              <button type=\"button\" className=\"rp-ui-btn rp-ui-btn--brand\" onClick={toggleTheme}>\r\n                <span className=\"rp-ui-btn__dot\" aria-hidden=\"true\" />\r\n                {theme === \"dark\" ? \"â˜€ Light\" : \"ðŸŒ™ Dark\"}\r\n              </button>\r\n\r\n              <button type=\"button\" className=\"rp-ui-btn rp-ui-btn--danger\" onClick={handleLogout}>\r\n                <span className=\"rp-ui-btn__dot\" aria-hidden=\"true\" />\r\n                Log Out\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"rp-top-center--logo\">\r\n              <div className=\"rp-top-logo\">\r\n                <Image src=\"/images/logo/logo.png\" alt=\"Ram Pottery\" width={44} height={44} priority />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"rp-top-right--sync\">\r\n              <div className=\"rp-sync\">\r\n                <div className=\"rp-sync-label\">Last sync :</div>\r\n                <div className=\"rp-sync-time\">{lastSync || \"â€”\"}</div>\r\n              </div>\r\n            </div>\r\n          </header>\r\n\r\n          {/* Executive header */}\r\n          <section className=\"rp-exec rp-card-anim\">\r\n            <div className=\"rp-exec__left\">\r\n              <div className=\"rp-exec__title\">Credit Notes</div>\r\n              <div className=\"rp-exec__sub\">Search â€¢ Export â€¢ Print â€¢ Reprint (3â€“6 months later)</div>\r\n            </div>\r\n            <div className=\"rp-exec__right\">\r\n              <span className={`rp-live ${loading ? \"is-dim\" : \"\"}`}>\r\n                <span className=\"rp-live-dot\" aria-hidden=\"true\" />\r\n                {loading ? \"Syncing\" : \"Live\"}\r\n              </span>\r\n              <span className={`rp-chip rp-chip--soft ${err ? \"rp-chip--warn\" : \"\"}`}>\r\n                {err ? \"Attention needed\" : \"All systems normal\"}\r\n              </span>\r\n            </div>\r\n          </section>\r\n\r\n          {/* KPI row */}\r\n          <section className=\"rp-kpi-pro rp-card-anim\">\r\n            <div className=\"rp-kpi-pro__cell\">\r\n              <div className=\"rp-kpi-pro__title\">Credit Notes</div>\r\n              <div className=\"rp-kpi-pro__value\">{totals.count}</div>\r\n              <div className=\"rp-kpi-pro__sub\">Filtered results</div>\r\n            </div>\r\n            <div className=\"rp-kpi-pro__cell\">\r\n              <div className=\"rp-kpi-pro__title\">Total Value</div>\r\n              <div className=\"rp-kpi-pro__value\">Rs {money(totals.sumTotal)}</div>\r\n              <div className=\"rp-kpi-pro__sub\">Sum of totals</div>\r\n            </div>\r\n            <div className=\"rp-kpi-pro__cell\">\r\n              <div className=\"rp-kpi-pro__title\">Pending</div>\r\n              <div className=\"rp-kpi-pro__value\">{totals.pending}</div>\r\n              <div className=\"rp-kpi-pro__sub\">Awaiting action</div>\r\n            </div>\r\n            <div className=\"rp-kpi-pro__cell\">\r\n              <div className=\"rp-kpi-pro__title\">Voided</div>\r\n              <div className=\"rp-kpi-pro__value\">{totals.voided}</div>\r\n              <div className=\"rp-kpi-pro__sub\">Locked records</div>\r\n            </div>\r\n          </section>\r\n\r\n          {/* Quick actions */}\r\n          <section className=\"rp-actions rp-card-anim\">\r\n            <div className=\"rp-seg rp-seg--pro\">\r\n              <Link className=\"rp-seg-item rp-seg-item--brand\" href=\"/credit-notes/new\">\r\n                <span className=\"rp-icbtn\" aria-hidden=\"true\">\r\n                  ðŸ§¾\r\n                </span>\r\n                New Credit Note\r\n              </Link>\r\n\r\n              <button className=\"rp-seg-item rp-seg-item--brand\" type=\"button\" onClick={exportCsv} disabled={loading}>\r\n                <span className=\"rp-icbtn\" aria-hidden=\"true\">\r\n                  â¬‡\r\n                </span>\r\n                Export CSV\r\n              </button>\r\n\r\n              <button className=\"rp-seg-item rp-seg-item--brand\" type=\"button\" onClick={printListOnly}>\r\n                <span className=\"rp-icbtn\" aria-hidden=\"true\">\r\n                  ðŸ–¨\r\n                </span>\r\n                Print\r\n              </button>\r\n\r\n              <button className=\"rp-seg-item rp-seg-item--brand\" type=\"button\" onClick={load} disabled={loading}>\r\n                <span className=\"rp-icbtn\" aria-hidden=\"true\">\r\n                  âŸ³\r\n                </span>\r\n                {loading ? \"Loadingâ€¦\" : \"Refresh\"}\r\n              </button>\r\n            </div>\r\n          </section>\r\n\r\n          {/* Search & Filters */}\r\n          <section className=\"rp-card rp-card-anim\">\r\n            <div className=\"rp-card-head rp-card-head--tight\">\r\n              <div>\r\n                <div className=\"rp-card-title\">Search & Filters</div>\r\n                <div className=\"rp-card-sub\">Credit note â€¢ customer â€¢ status â€¢ code</div>\r\n              </div>\r\n              <span className={`rp-chip ${loading ? \"is-dim\" : \"\"}`}>{loading ? \"Syncingâ€¦\" : \"Ready\"}</span>\r\n            </div>\r\n\r\n            <div className=\"rp-card-body\">\r\n              <div className=\"rp-filters-row\">\r\n                <input\r\n                  className=\"rp-input rp-input--full\"\r\n                  value={qDraft}\r\n                  onChange={(e) => setQDraft(e.target.value)}\r\n                  placeholder=\"Search credit note no, customer, statusâ€¦\"\r\n                  onKeyDown={(e) => {\r\n                    if (e.key === \"Enter\") applySearch();\r\n                    if (e.key === \"Escape\") clearAll();\r\n                  }}\r\n                />\r\n\r\n                <button\r\n                  type=\"button\"\r\n                  className={`rp-ui-btn rp-ui-btn--brand ${pulse ? \"rp-ui-btn--pulse\" : \"\"}`}\r\n                  onClick={applySearch}\r\n                  title=\"Search\"\r\n                >\r\n                  <span className=\"rp-ui-btn__dot\" aria-hidden=\"true\" />\r\n                  Search\r\n                </button>\r\n\r\n                <button type=\"button\" className=\"rp-ui-btn\" onClick={clearAll} title=\"Clear\">\r\n                  <span className=\"rp-ui-btn__dot\" aria-hidden=\"true\" />\r\n                  Clear\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"rp-chip-row\">\r\n                {filterPills.map((p) => (\r\n                  <button\r\n                    key={p.key}\r\n                    type=\"button\"\r\n                    className={`rp-filter-pill ${filter === p.key ? \"rp-filter-pill--active\" : \"\"}`}\r\n                    onClick={() => setFilter(p.key)}\r\n                  >\r\n                    {p.label}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n\r\n              {err ? <div className=\"rp-note rp-note--warn\">{err}</div> : null}\r\n            </div>\r\n          </section>\r\n\r\n          {/* ===== Pinned-table Register ===== */}\r\n          <section className=\"rp-card rp-card-anim\">\r\n            <div className=\"rp-card-head rp-card-head--tight\">\r\n              <div>\r\n                <div className=\"rp-card-title\">Credit Note Register</div>\r\n                <div className=\"rp-card-sub\">Mobile scroll â€¢ pinned first column â€¢ clean actions</div>\r\n              </div>\r\n              <span className=\"rp-soft-pill\">\r\n                Showing <b>{filtered.length}</b>\r\n              </span>\r\n            </div>\r\n\r\n            <div className=\"rp-card-body\">\r\n              <div className=\"rp-table-wrap\">\r\n                <div className=\"rp-table-scroll\">\r\n                  <div className=\"rp-table-scroll__inner\">\r\n                    {/* Keep printRef on the plain table container */}\r\n                    <div ref={printRef}>\r\n                      <table className=\"rp-table rp-table--premium\">\r\n                        <thead>\r\n                          <tr>\r\n                            <th className=\"rp-pin\" style={{ width: 230 }}>\r\n                              Credit Note No\r\n                            </th>\r\n                            <th style={{ width: 140 }}>Date</th>\r\n                            <th style={{ minWidth: 240 }}>Customer</th>\r\n                            <th style={{ width: 160 }}>Code</th>\r\n                            <th className=\"rp-right\" style={{ width: 170 }}>\r\n                              Total (Rs)\r\n                            </th>\r\n                            <th style={{ width: 180 }}>Status</th>\r\n                            <th className=\"rp-pin-right\" style={{ width: 64 }} />\r\n                          </tr>\r\n                        </thead>\r\n\r\n                        <tbody>\r\n                          {filtered.length === 0 ? (\r\n                            <tr>\r\n                              <td colSpan={7} className=\"rp-td-empty\">\r\n                                {loading ? \"Loading credit notesâ€¦\" : \"No credit notes found.\"}\r\n                              </td>\r\n                            </tr>\r\n                          ) : (\r\n                            filtered.map((r) => {\r\n                              const c = normalizeCustomer(r.customers);\r\n                              const badge = badgeForCredit(r.status);\r\n                              const isVoid = badge.key === \"VOID\";\r\n                              const docNo = r.credit_note_number || `#${r.id}`;\r\n\r\n                              return (\r\n                                <tr key={r.id} className={`rp-row-hover ${isVoid ? \"rp-row-locked\" : \"\"}`}>\r\n                                  {/* âœ… pinned first column cell */}\r\n                                  <td className=\"rp-pin rp-strong\">\r\n                                    {isVoid ? (\r\n                                      <span\r\n                                        className=\"rp-row-link\"\r\n                                        title=\"VOID credit notes are locked\"\r\n                                        aria-disabled=\"true\"\r\n                                        style={{ cursor: \"not-allowed\", opacity: 0.75 }}\r\n                                      >\r\n                                        {docNo}\r\n                                      </span>\r\n                                    ) : (\r\n                                      <Link className=\"rp-row-link\" href={`/credit-notes/${r.id}`}>\r\n                                        {docNo}\r\n                                      </Link>\r\n                                    )}\r\n                                  </td>\r\n\r\n                                  <td>{fmtDate(r.credit_note_date)}</td>\r\n\r\n                                  <td>\r\n                                    <div className=\"rp-strong\">{c?.name || \"â€”\"}</div>\r\n                                  </td>\r\n\r\n                                  <td>{c?.customer_code || \"â€”\"}</td>\r\n\r\n                                  <td className=\"rp-right rp-strong\" style={{ fontVariantNumeric: \"tabular-nums\" }}>\r\n                                    {money(r.total_amount)}\r\n                                  </td>\r\n\r\n                                  <td>\r\n                                    <span className={badge.cls}>{badge.label}</span>\r\n                                    {isVoid ? <span style={{ marginLeft: 8, opacity: 0.75, fontWeight: 900 }}>ðŸ”’</span> : null}\r\n                                  </td>\r\n\r\n                                  {/* âœ… pinned right â‹® menu */}\r\n                                  <td className=\"rp-pin-right\" style={{ textAlign: \"right\" }}>\r\n                                    <button\r\n                                      type=\"button\"\r\n                                      className=\"rp-row-actions-btn\"\r\n                                      aria-label=\"Credit note actions\"\r\n                                      disabled={isVoid}\r\n                                      onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        if (isVoid) return;\r\n                                        setOpenMenu(openMenu === r.id ? null : r.id);\r\n                                      }}\r\n                                      style={isVoid ? { opacity: 0.45, cursor: \"not-allowed\" } : undefined}\r\n                                    >\r\n                                      â‹®\r\n                                    </button>\r\n\r\n                                    {openMenu === r.id && !isVoid && (\r\n                                      <div className=\"rp-row-actions-menu\" onClick={(e) => e.stopPropagation()}>\r\n                                        <Link\r\n                                          href={`/credit-notes/${r.id}`}\r\n                                          onClick={() => setOpenMenu(null)}\r\n                                          className=\"rp-row-actions-link\"\r\n                                        >\r\n                                          View / Print\r\n                                        </Link>\r\n\r\n                                        <div className=\"rp-row-actions-sep\" />\r\n\r\n                                        <button\r\n                                          onClick={() => {\r\n                                            navigator.clipboard?.writeText(docNo).catch(() => {});\r\n                                            setOpenMenu(null);\r\n                                          }}\r\n                                        >\r\n                                          Copy Number\r\n                                        </button>\r\n                                      </div>\r\n                                    )}\r\n                                  </td>\r\n                                </tr>\r\n                              );\r\n                            })\r\n                          )}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                    {/* /printRef */}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </section>\r\n\r\n          <footer className=\"rp-footer\">Â© {new Date().getFullYear()} Ram Pottery Ltd â€¢ Built by Mobiz.mu</footer>\r\n        </main>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}