{"version":3,"sources":["../../../../src/components/print/RamPotteryDoc.tsx/__nextjs-internal-proxy.mjs","../../../../app/invoices/%5Bid%5D/print/page.tsx","../../../../src/lib/rpFetch.ts"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/print/RamPotteryDoc.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/print/RamPotteryDoc.tsx\",\n    \"default\",\n);\n","import RamPotteryDoc from \"@/components/print/RamPotteryDoc\";\nimport { rpFetch } from \"@/lib/rpFetch\";\n\nexport default async function PrintInvoicePage({ params }: { params: { id: string } }) {\n  const res = await rpFetch(`/api/invoices/${params.id}`, { cache: \"no-store\" });\n  const json = await res.json();\n\n  if (!json?.ok) {\n    return <div style={{ padding: 24 }}>Invoice not found.</div>;\n  }\n\n  const inv = json.invoice;\n  const items = json.items || [];\n\n  const docItems = items.map((it: any, i: number) => ({\n    sn: i + 1,\n    item_code: it.products?.item_code || \"\",\n    uom: it.uom || \"BOX\",\n    box_qty: it.box_qty ?? it.pcs_qty ?? 0,\n    units_per_box: it.units_per_box ?? 1,\n    total_qty: it.total_qty ?? 0,\n    description: it.description || it.products?.name || \"\",\n    unit_price_excl_vat: it.unit_price_excl_vat ?? 0,\n    unit_vat: it.unit_vat ?? 0,\n    unit_price_incl_vat: it.unit_price_incl_vat ?? 0,\n    line_total: it.line_total ?? 0,\n  }));\n\n  return (\n    <div className=\"rp-print-page\">\n      <RamPotteryDoc\n        variant=\"INVOICE\"\n        docNoLabel=\"INVOICE NO:\"\n        docNoValue={String(inv.invoice_number || \"(Auto when saved)\")}\n        dateLabel=\"DATE:\"\n        dateValue={String(inv.invoice_date || \"\")}\n        purchaseOrderLabel=\"PURCHASE ORDER NO:\"\n        purchaseOrderValue={inv.purchase_order_no || \"\"}\n\n        salesRepName={inv.sales_rep || \"\"}\n        salesRepPhone={inv.sales_rep_phone || \"\"}\n\n        customer={{\n          name: inv.customer_name || \"\",\n          address: inv.customer_address || \"\",\n          phone: inv.customer_phone || \"\",\n          brn: inv.customer_brn || \"\",\n          vat_no: inv.customer_vat_no || \"\",\n          customer_code: inv.customer_code || \"\",\n        }}\n        company={{ brn: \"C17144377\", vat_no: \"123456789\" }}\n        items={docItems}\n        totals={{\n          subtotal: inv.subtotal_ex ?? 0,\n          vatPercentLabel: \"VAT\",\n          vat_amount: inv.vat_amount ?? 0,\n          total_amount: inv.total_amount ?? 0,\n          previous_balance: inv.previous_balance ?? 0,\n          amount_paid: inv.amount_paid ?? 0,\n          balance_remaining: inv.balance_remaining ?? 0,\n          discount_percent: inv.discount_percent ?? 0,\n          discount_amount: inv.discount_amount ?? 0,\n        }}\n        preparedBy={inv.prepared_by || \"Manish\"}\n        deliveredBy={inv.delivered_by || \"\"}\n      />\n    </div>\n  );\n}\n","// lib/rpFetch.ts\r\n\r\nexport type RpFetchOptions = RequestInit & {\r\n  auth?: boolean; // default true: attach x-rp-user\r\n};\r\n\r\nfunction attachAuthHeader(headers: Headers, options: RpFetchOptions) {\r\n  if (options.auth === false) return;\r\n\r\n  if (typeof window !== \"undefined\") {\r\n    const session = window.localStorage.getItem(\"rp_user\");\r\n    if (session) headers.set(\"x-rp-user\", session);\r\n  }\r\n}\r\n\r\nfunction handleAuthRedirect(res: Response) {\r\n  if (typeof window === \"undefined\") return;\r\n\r\n  if (res.status === 401 || res.status === 403) {\r\n    const next = window.location.pathname + window.location.search;\r\n    window.location.href = `/login?next=${encodeURIComponent(next)}`;\r\n  }\r\n}\r\n\r\n/**\r\n * rpFetch = fetch wrapper that injects x-rp-user and handles 401/403 redirect.\r\n * Returns the native Response (so you can do res.json(), res.text(), etc.)\r\n */\r\nexport async function rpFetch(url: string, options: RpFetchOptions = {}): Promise<Response> {\r\n  const headers = new Headers(options.headers || {});\r\n\r\n  // Default JSON header if body exists (and not FormData)\r\n  const bodyIsFormData =\r\n    typeof FormData !== \"undefined\" && options.body instanceof FormData;\r\n\r\n  if (options.body && !bodyIsFormData && !headers.has(\"Content-Type\")) {\r\n    headers.set(\"Content-Type\", \"application/json\");\r\n  }\r\n\r\n  attachAuthHeader(headers, options);\r\n\r\n  const res = await fetch(url, { ...options, headers });\r\n\r\n  // Redirect on auth issues (client-side)\r\n  handleAuthRedirect(res);\r\n\r\n  return res;\r\n}\r\n\r\n/**\r\n * Convenience helper: returns parsed JSON and throws on non-OK responses.\r\n * Useful for API routes returning { ok, ... } JSON.\r\n */\r\nexport async function rpFetchJson<T = any>(url: string, options: RpFetchOptions = {}): Promise<T> {\r\n  const res = await rpFetch(url, options);\r\n\r\n  let json: any = null;\r\n  try {\r\n    json = await res.json();\r\n  } catch {\r\n    json = null;\r\n  }\r\n\r\n  if (!res.ok) {\r\n    const msg = json?.error || `Request failed (${res.status})`;\r\n    throw new Error(msg);\r\n  }\r\n\r\n  if (json?.ok === false) {\r\n    throw new Error(json?.error || \"Request failed\");\r\n  }\r\n\r\n  return (json ?? {}) as T;\r\n}\r\n\r\n"],"names":[],"mappings":"kWAEe,CAAA,EAAA,AADf,EAAA,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,wSAA0S,EACvU,uEACA,gEAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,oRAAsR,EACnT,mDACA,8GCLJ,EAAA,EAAA,CAAA,CAAA,OC4BO,eAAe,EAAQ,CAAW,CAAE,EAA0B,CAAC,CAAC,EACrE,IAAM,EAAU,IAAI,QAAQ,EAAQ,OAAO,EAAI,CAAC,GAG1C,EACgB,IAApB,OAAO,UAA4B,EAAQ,IAAI,YAAY,SAa7D,OAXI,AAWG,EAXK,IAAI,EAAK,EAAD,CAAoB,EAAQ,GAAG,CAAC,SAAb,QAA8B,AACnE,EAAQ,GAAG,CAAC,eAAgB,oBAGJ,AAhCtB,EAAQ,IAAI,CAkCJ,IAlCS,EAkCH,KAlCU,CAkCJ,EAAK,CAAE,GAAG,CAAO,SAAE,CAAQ,EAMrD,CD5Ce,eAAe,EAAiB,QAAE,CAAM,CAA8B,EACnF,IAAM,EAAM,MAAM,EAAQ,CAAC,cAAc,EAAE,EAAO,EAAE,CAAA,CAAE,CAAE,CAAE,MAAO,UAAW,GACtE,EAAO,MAAM,EAAI,IAAI,GAE3B,GAAI,CAAC,GAAM,GACT,CADa,KACN,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,MAAO,CAAE,QAAS,EAAG,WAAG,uBAGtC,IAAM,EAAM,EAAK,OAAO,CAGlB,EAAW,CAFH,EAAK,KAAK,EAAI,EAAA,AAAE,EAEP,GAAG,CAAC,CAAC,EAAS,IAAc,CAAC,CAClD,GAAI,EAAI,EACR,UAAW,EAAG,QAAQ,EAAE,WAAa,GACrC,IAAK,EAAG,GAAG,EAAI,MACf,QAAS,EAAG,OAAO,EAAI,EAAG,OAAO,EAAI,EACrC,cAAe,EAAG,aAAa,EAAI,EACnC,UAAW,EAAG,SAAS,EAAI,EAC3B,YAAa,EAAG,WAAW,EAAI,EAAG,QAAQ,EAAE,MAAQ,GACpD,oBAAqB,EAAG,mBAAmB,EAAI,EAC/C,SAAU,EAAG,QAAQ,EAAI,EACzB,oBAAqB,EAAG,mBAAmB,EAAI,EAC/C,WAAY,EAAG,UAAU,EAAI,EAC/B,CAAC,EAED,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAa,CAAA,CACZ,QAAQ,UACR,WAAW,cACX,WAAY,OAAO,EAAI,cAAc,EAAI,qBACzC,UAAU,QACV,UAAW,OAAO,EAAI,YAAY,EAAI,IACtC,mBAAmB,qBACnB,mBAAoB,EAAI,iBAAiB,EAAI,GAE7C,aAAc,EAAI,SAAS,EAAI,GAC/B,cAAe,EAAI,eAAe,EAAI,GAEtC,SAAU,CACR,KAAM,EAAI,aAAa,EAAI,GAC3B,QAAS,EAAI,gBAAgB,EAAI,GACjC,MAAO,EAAI,cAAc,EAAI,GAC7B,IAAK,EAAI,YAAY,EAAI,GACzB,OAAQ,EAAI,eAAe,EAAI,GAC/B,cAAe,EAAI,aAAa,EAAI,EACtC,EACA,QAAS,CAAE,IAAK,YAAa,OAAQ,WAAY,EACjD,MAAO,EACP,OAAQ,CACN,SAAU,EAAI,WAAW,EAAI,EAC7B,gBAAiB,MACjB,WAAY,EAAI,UAAU,EAAI,EAC9B,aAAc,EAAI,YAAY,EAAI,EAClC,iBAAkB,EAAI,gBAAgB,EAAI,EAC1C,YAAa,EAAI,WAAW,EAAI,EAChC,kBAAmB,EAAI,iBAAiB,EAAI,EAC5C,iBAAkB,EAAI,gBAAgB,EAAI,EAC1C,gBAAiB,EAAI,eAAe,EAAI,CAC1C,EACA,WAAY,EAAI,WAAW,EAAI,SAC/B,YAAa,EAAI,YAAY,EAAI,MAIzC","ignoreList":[0]}