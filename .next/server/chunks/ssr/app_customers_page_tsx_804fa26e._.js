module.exports=[62785,a=>{"use strict";var b=a.i(87924),c=a.i(38246),d=a.i(71987),e=a.i(72131),f=a.i(50944),g=a.i(24767);function h(a){return String(a??"").trim()}function i(a){let b=Number(a);return Number.isFinite(b)?b:0}function j(a){return String(a||"").toUpperCase()}function k(a){return"ADMIN"===j(a)}function l(){var a;let l=(0,f.useRouter)(),[m,n]=(0,e.useState)(!1),[o,p]=(0,e.useState)("light"),[q,r]=(0,e.useState)(""),[s,t]=(0,e.useState)(!0),[u,v]=(0,e.useState)(null),[w,x]=(0,e.useState)([]),[y,z]=(0,e.useState)(!1),[A,B]=(0,e.useState)(null),[C,D]=(0,e.useState)(""),[E,F]=(0,e.useState)(""),G=(0,e.useRef)(null),[H,I]=(0,e.useState)("ALL"),[J,K]=(0,e.useState)("ACTIVE"),[L,M]=(0,e.useState)(null),N=(0,e.useRef)(null);(0,e.useEffect)(()=>{z(!0);let a="dark"===localStorage.getItem("rp_theme")?"dark":"light";p(a),document.documentElement.dataset.theme=a;try{let a=localStorage.getItem("rp_user");if(!a)return void l.replace("/login");let b=JSON.parse(a);B(b)}catch{l.replace("/login");return}},[]),(0,e.useEffect)(()=>{function a(a){if(!L)return;let b=a.target;N.current&&b&&N.current.contains(b)||M(null)}function b(a){L&&"Escape"===a.key&&M(null)}return document.addEventListener("mousedown",a),document.addEventListener("keydown",b),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("keydown",b)}},[L]);let O=(0,e.useMemo)(()=>(A?.name||A?.username||"").trim()||"User",[A]),P=(0,e.useMemo)(()=>j(A?.role)||"STAFF",[A]),Q=y&&k(A?.role),R=y&&(k(a=A?.role)||"MANAGER"===j(a)),S=(0,e.useMemo)(()=>{let a=[{href:"/",label:"Dashboard"},{href:"/invoices",label:"Invoices"},{href:"/credit-notes",label:"Credit Notes"},{href:"/stock",label:"Stock & Categories"},{href:"/stock-movements",label:"Stock Movements"},{href:"/customers",label:"Customers"},{href:"/reports",label:"Reports & Statements"}];return Q&&a.push({href:"/admin/users",label:"Users & Permissions"}),a},[Q]);function T(){let a="dark"===o?"light":"dark";p(a),document.documentElement.dataset.theme=a,localStorage.setItem("rp_theme",a)}async function U(){try{await fetch("/api/auth/logout",{method:"POST"})}finally{localStorage.removeItem("rp_user"),window.location.href="/login"}}async function V(a){try{var b;let c;v(null),t(!0);let d=a||J,e=await (0,g.rpFetch)(`/api/customers/list?showArchived=${"ARCHIVED"===d||"ALL"===d?"1":"0"}`,{method:"GET",cache:"no-store"}),f=await e.json().catch(()=>({}));if(!e.ok||!f?.ok)throw Error(f?.error||"Failed to load customers");let h=Array.isArray(f.customers)?f.customers:[];x(h),r((b=new Date,c=a=>String(a).padStart(2,"0"),`${c(b.getDate())}/${c(b.getMonth()+1)}/${b.getFullYear()}, ${c(b.getHours())}:${c(b.getMinutes())}:${c(b.getSeconds())}`))}catch(a){v(a?.message||"Failed to load customers"),x([])}finally{t(!1)}}(0,e.useEffect)(()=>(G.current&&window.clearTimeout(G.current),G.current=window.setTimeout(()=>F(C.trim()),220),()=>{G.current&&window.clearTimeout(G.current)}),[C]),(0,e.useEffect)(()=>{V()},[]);let W=(0,e.useMemo)(()=>{let a=E.toLowerCase(),b=w;return("ACTIVE"===J&&(b=b.filter(a=>!1!==a.is_active)),"ARCHIVED"===J&&(b=b.filter(a=>!1===a.is_active)),"WITH_VAT"===H&&(b=b.filter(a=>h(a.vat_no))),"WITH_BRN"===H&&(b=b.filter(a=>h(a.brn))),a)?b.filter(b=>[b.customer_code,b.name,b.client,b.address,b.phone,b.whatsapp,b.brn,b.vat_no,String(b.discount_percent??"")].map(h).join(" ").toLowerCase().includes(a)):b},[w,E,H,J]),X=(0,e.useMemo)(()=>{let a=W.length,b=W.filter(a=>h(a.vat_no)).length,c=W.filter(a=>h(a.brn)).length,d=W.filter(a=>!h(a.customer_code)).length,e=0===a?0:Math.round(W.reduce((a,b)=>a+i(b.discount_percent),0)/a*10)/10;return{total:a,withVat:b,withBrn:c,missingCode:d,avgDisc:e}},[W]);function Y(a){M(null),l.push(a)}return(0,b.jsxs)("div",{className:"rp-app",children:[(0,b.jsxs)("div",{className:"rp-bg","aria-hidden":"true",children:[(0,b.jsx)("div",{className:"rp-bg-orb rp-bg-orb--1"}),(0,b.jsx)("div",{className:"rp-bg-orb rp-bg-orb--2"}),(0,b.jsx)("div",{className:"rp-bg-orb rp-bg-orb--3"}),(0,b.jsx)("div",{className:"rp-bg-grid"})]}),(0,b.jsxs)("div",{className:"rp-shell rp-enter",children:[(0,b.jsxs)("div",{className:"rp-mtop",children:[(0,b.jsx)("button",{type:"button",className:"rp-icon-btn rp-burger",onClick:()=>n(!0),"aria-label":"Open menu",children:(0,b.jsxs)("span",{"aria-hidden":"true",children:[(0,b.jsx)("i",{}),(0,b.jsx)("i",{}),(0,b.jsx)("i",{})]})}),(0,b.jsxs)("div",{className:"rp-mtop-brand",children:[(0,b.jsx)("div",{className:"rp-mtop-title",children:"RampotteryHUB"}),(0,b.jsx)("div",{className:"rp-mtop-sub",children:"Customers"})]}),(0,b.jsx)("button",{type:"button",className:"rp-icon-btn",onClick:T,"aria-label":"Toggle theme",children:"dark"===o?"â˜€":"ðŸŒ™"})]}),(0,b.jsx)("button",{className:`rp-overlay ${m?"is-open":""}`,onClick:()=>n(!1),"aria-label":"Close menu"}),(0,b.jsxs)("aside",{className:`rp-drawer ${m?"is-open":""}`,children:[(0,b.jsxs)("div",{className:"rp-drawer-head",children:[(0,b.jsxs)("div",{className:"rp-drawer-brand",children:[(0,b.jsx)("div",{className:"rp-drawer-logo",children:(0,b.jsx)(d.default,{src:"/images/logo/logo.png",alt:"Ram Pottery Ltd",width:28,height:28,priority:!0})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-drawer-title",children:"RampotteryHUB"}),(0,b.jsx)("div",{className:"rp-drawer-sub",children:"Accounting & Stock System"})]})]}),(0,b.jsx)("button",{type:"button",className:"rp-icon-btn",onClick:()=>n(!1),"aria-label":"Close",children:"âœ•"})]}),(0,b.jsxs)("div",{className:"rp-drawer-body",children:[(0,b.jsx)("nav",{className:"rp-nav",children:S.map(a=>(0,b.jsxs)(c.default,{className:`rp-nav-btn ${"/customers"===a.href?"rp-nav-btn--active":""}`,href:a.href,onClick:()=>n(!1),children:[(0,b.jsx)("span",{className:"rp-ic3d","aria-hidden":"true",children:"â–¶"}),a.label]},a.href))}),(0,b.jsxs)("div",{className:"rp-side-footer rp-side-footer--in",children:[(0,b.jsxs)("div",{className:"rp-role",children:[(0,b.jsx)("span",{children:"Signed in"}),(0,b.jsx)("b",{title:O,children:y?O:"â€”"})]}),(0,b.jsxs)("div",{className:"rp-role",style:{marginTop:10},children:[(0,b.jsx)("span",{children:"Role"}),(0,b.jsx)("b",{children:y?P:"â€”"})]})]})]})]}),(0,b.jsx)("aside",{className:"rp-side",children:(0,b.jsxs)("div",{className:"rp-side-card rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-brand",children:[(0,b.jsx)("div",{className:"rp-brand-logo",children:(0,b.jsx)(d.default,{src:"/images/logo/logo.png",alt:"Ram Pottery Ltd",width:30,height:30,priority:!0})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-brand-title",children:"RampotteryHUB"}),(0,b.jsx)("div",{className:"rp-brand-sub",children:"Accounting & Stock System"})]})]}),(0,b.jsx)("nav",{className:"rp-nav",children:S.map(a=>(0,b.jsxs)(c.default,{className:`rp-nav-btn ${"/customers"===a.href?"rp-nav-btn--active":""}`,href:a.href,children:[(0,b.jsx)("span",{className:"rp-ic3d","aria-hidden":"true",children:"â–¶"}),a.label]},a.href))}),(0,b.jsxs)("div",{className:"rp-side-footer rp-side-footer--in",children:[(0,b.jsxs)("div",{className:"rp-role",children:[(0,b.jsx)("span",{children:"Signed in"}),(0,b.jsx)("b",{title:O,children:y?O:"â€”"})]}),(0,b.jsxs)("div",{className:"rp-role",style:{marginTop:10},children:[(0,b.jsx)("span",{children:"Role"}),(0,b.jsx)("b",{children:y?P:"â€”"})]})]})]})}),(0,b.jsxs)("main",{className:"rp-main",children:[(0,b.jsxs)("header",{className:"rp-top rp-top--saas rp-card-anim",style:{animationDelay:"60ms"},children:[(0,b.jsxs)("div",{className:"rp-top-left--actions",children:[(0,b.jsxs)("button",{type:"button",className:"rp-ui-btn rp-ui-btn--brand",onClick:T,children:[(0,b.jsx)("span",{className:"rp-ui-btn__dot","aria-hidden":"true"}),"dark"===o?"â˜€ Light":"ðŸŒ™ Dark"]}),(0,b.jsxs)("button",{type:"button",className:"rp-ui-btn rp-ui-btn--danger",onClick:U,children:[(0,b.jsx)("span",{className:"rp-ui-btn__dot","aria-hidden":"true"}),"Log Out"]})]}),(0,b.jsx)("div",{className:"rp-top-center--logo",children:(0,b.jsx)("div",{className:"rp-top-logo",children:(0,b.jsx)(d.default,{src:"/images/logo/logo.png",alt:"Ram Pottery",width:44,height:44,priority:!0})})}),(0,b.jsx)("div",{className:"rp-top-right--sync",children:(0,b.jsxs)("div",{className:"rp-sync",children:[(0,b.jsx)("div",{className:"rp-sync-label",children:"Last sync :"}),(0,b.jsx)("div",{className:"rp-sync-time",children:q||"â€”"})]})})]}),(0,b.jsxs)("section",{className:"rp-exec rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-exec__left",children:[(0,b.jsx)("div",{className:"rp-exec__title",children:"Customers"}),(0,b.jsxs)("div",{className:"rp-exec__sub",children:["Format: ",(0,b.jsx)("b",{children:"Code â€¢ Customer â€¢ Client â€¢ Address â€¢ Phone â€¢ WhatsApp â€¢ BRN â€¢ VAT â€¢ Discount"})]})]}),(0,b.jsxs)("div",{className:"rp-exec__right",children:[(0,b.jsxs)("span",{className:`rp-live ${s?"is-dim":""}`,children:[(0,b.jsx)("span",{className:"rp-live-dot","aria-hidden":"true"}),s?"Syncing":"Live"]}),(0,b.jsx)("span",{className:`rp-chip rp-chip--soft ${u?"rp-chip--warn":""}`,children:u?"Attention needed":"All systems normal"})]})]}),(0,b.jsxs)("section",{className:"rp-kpi-pro rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"Customers"}),(0,b.jsx)("div",{className:"rp-kpi-pro__value",children:X.total}),(0,b.jsx)("div",{className:"rp-kpi-pro__sub",children:"Filtered"})]}),(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"With VAT"}),(0,b.jsx)("div",{className:"rp-kpi-pro__value",children:X.withVat}),(0,b.jsx)("div",{className:"rp-kpi-pro__sub",children:"VAT No present"})]}),(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"With BRN"}),(0,b.jsx)("div",{className:"rp-kpi-pro__value",children:X.withBrn}),(0,b.jsx)("div",{className:"rp-kpi-pro__sub",children:"BRN present"})]}),(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"Avg Discount"}),(0,b.jsxs)("div",{className:"rp-kpi-pro__value",children:[X.avgDisc,"%"]}),(0,b.jsx)("div",{className:"rp-kpi-pro__sub",children:"Across results"})]})]}),(0,b.jsx)("section",{className:"rp-actions rp-card-anim",children:(0,b.jsxs)("div",{className:"rp-seg rp-seg--pro",children:[(0,b.jsxs)("button",{type:"button",className:"rp-seg-item rp-seg-item--brand",onClick:()=>V(),disabled:s,children:[(0,b.jsx)("span",{className:"rp-icbtn","aria-hidden":"true",children:"âŸ³"}),"Refresh"]}),(0,b.jsxs)(c.default,{className:"rp-seg-item rp-seg-item--brand",href:"/customers/new",children:[(0,b.jsx)("span",{className:"rp-icbtn","aria-hidden":"true",children:"ðŸ‘¤"}),"New Customer"]}),R?(0,b.jsxs)(c.default,{className:"rp-seg-item rp-seg-item--brand",href:"/customers/pricing-import",children:[(0,b.jsx)("span",{className:"rp-icbtn","aria-hidden":"true",children:"â¬†"}),"Bulk Import"]}):(0,b.jsxs)("button",{type:"button",className:"rp-seg-item",disabled:!0,title:"Admin/Manager only",children:[(0,b.jsx)("span",{className:"rp-icbtn","aria-hidden":"true",children:"ðŸ”’"}),"Bulk Import"]})]})}),(0,b.jsxs)("section",{className:"rp-card rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-card-head rp-card-head--tight",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-card-title",children:"Search & Filters"}),(0,b.jsx)("div",{className:"rp-card-sub",children:"Code â€¢ customer â€¢ client â€¢ phone â€¢ whatsapp â€¢ BRN â€¢ VAT â€¢ discount"})]}),(0,b.jsx)("span",{className:`rp-chip ${s?"is-dim":""}`,children:s?"Loadingâ€¦":"Ready"})]}),(0,b.jsxs)("div",{className:"rp-card-body",children:[(0,b.jsx)("input",{className:"rp-input rp-input--full",placeholder:"Search customersâ€¦",value:C,onChange:a=>D(a.target.value)}),(0,b.jsx)("div",{className:"rp-chip-row",style:{display:"flex",gap:10,flexWrap:"wrap",marginTop:10},children:[{key:"ACTIVE",label:"Active"},{key:"ARCHIVED",label:"Archived"},{key:"ALL",label:"All"}].map(a=>(0,b.jsx)("button",{className:`rp-filter-pill ${J===a.key?"rp-filter-pill--active":""}`,type:"button",onClick:()=>{let b=a.key;K(b),("ARCHIVED"===b||"ALL"===b)&&V(b)},children:a.label},a.key))}),(0,b.jsx)("div",{className:"rp-chip-row",children:[{key:"ALL",label:"All"},{key:"WITH_VAT",label:"With VAT"},{key:"WITH_BRN",label:"With BRN"}].map(a=>(0,b.jsx)("button",{className:`rp-filter-pill ${H===a.key?"rp-filter-pill--active":""}`,onClick:()=>I(a.key),type:"button",children:a.label},a.key))}),u?(0,b.jsx)("div",{className:"rp-note rp-note--warn",children:u}):null]})]}),(0,b.jsxs)("section",{className:"rp-card rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-card-head rp-card-head--tight",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-card-title",children:"Customer Register"}),(0,b.jsx)("div",{className:"rp-card-sub",children:"Matches your import file format"})]}),(0,b.jsxs)("span",{className:"rp-chip rp-chip--soft",children:[W.length," result(s)"]})]}),(0,b.jsxs)("div",{className:"rp-card-body rp-table-wrap",children:[(0,b.jsxs)("table",{className:"rp-table rp-table--premium",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{style:{width:120},children:"Code"}),(0,b.jsx)("th",{style:{width:220},children:"Customer"}),(0,b.jsx)("th",{style:{width:180},children:"Client"}),(0,b.jsx)("th",{children:"Address"}),(0,b.jsx)("th",{style:{width:130},children:"Phone"}),(0,b.jsx)("th",{style:{width:140},children:"WhatsApp"}),(0,b.jsx)("th",{style:{width:150},children:"BRN"}),(0,b.jsx)("th",{style:{width:150},children:"VAT"}),(0,b.jsx)("th",{style:{width:110,textAlign:"right"},children:"Discount"}),(0,b.jsx)("th",{style:{width:80,textAlign:"right"},children:"â‹®"})]})}),(0,b.jsx)("tbody",{children:s?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:10,className:"rp-td-empty",children:"Loading customersâ€¦"})}):0===W.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:10,className:"rp-td-empty",children:"No customers found."})}):W.map(a=>{let c,d=String(a.id),e=h(a.customer_code)||"â€”",f=h(a.name)||"â€”",g=h(a.client)||"â€”",j=h(a.address)||"â€”",k=L===d,l=!1===a.is_active;return(0,b.jsxs)("tr",{style:l?{opacity:.72}:void 0,children:[(0,b.jsx)("td",{className:"rp-strong",children:e}),(0,b.jsx)("td",{className:"rp-strong",children:f}),(0,b.jsx)("td",{children:g}),(0,b.jsx)("td",{children:j}),(0,b.jsx)("td",{children:h(a.phone)||"â€”"}),(0,b.jsx)("td",{children:h(a.whatsapp)||"â€”"}),(0,b.jsx)("td",{children:h(a.brn)||"â€”"}),(0,b.jsx)("td",{children:h(a.vat_no)||"â€”"}),(0,b.jsx)("td",{style:{textAlign:"right",fontWeight:950},children:(c=Math.min(Math.max(i(a.discount_percent),0),100),`${c}%`)}),(0,b.jsx)("td",{style:{textAlign:"right"},children:(0,b.jsxs)("div",{className:"rp-row-actions",ref:k?N:void 0,style:{position:"relative",display:"inline-block"},children:[(0,b.jsx)("button",{type:"button",className:"rp-icon-btn rp-icon-btn--kebab","aria-haspopup":"menu","aria-expanded":k?"true":"false",onClick:()=>M(a=>a===d?null:d),title:"Actions",children:"â‹®"}),k?(0,b.jsxs)("div",{className:"rp-menu rp-menu--right",role:"menu","aria-label":"Customer actions",style:{position:"absolute",right:0,top:"calc(100% + 8px)",minWidth:180,zIndex:50},children:[(0,b.jsx)("button",{type:"button",role:"menuitem",className:"rp-menu-item",onClick:()=>Y(`/customers/${d}/edit`),children:"âœï¸ Edit"}),(0,b.jsx)("button",{type:"button",role:"menuitem",className:"rp-menu-item",onClick:()=>Y(`/customers/${d}/pricing`),children:"ðŸ’° Pricing"}),(0,b.jsx)("button",{type:"button",role:"menuitem",className:"rp-menu-item",onClick:()=>Y(`/customers/${d}/activity`),children:"ðŸ“Œ Activity"})]}):null]})})]},d)})})]}),(0,b.jsxs)("div",{style:{marginTop:10},className:"rp-muted",children:["Tip: import file headers must be exactly:"," ",(0,b.jsx)("b",{children:"customer_code, customer_name, client_name, address, phone_no, whatsapp_no, brn, vat_no, discount"})]})]})]}),(0,b.jsxs)("footer",{className:"rp-footer",children:["Â© ",new Date().getFullYear()," Ram Pottery Ltd â€¢ Built by Mobiz.mu"]})]})]})]})}a.s(["default",()=>l])}];

//# sourceMappingURL=app_customers_page_tsx_804fa26e._.js.map