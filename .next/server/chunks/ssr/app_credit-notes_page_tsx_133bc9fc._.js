module.exports=[21932,a=>{"use strict";var b=a.i(87924),c=a.i(38246),d=a.i(71987),e=a.i(72131),f=a.i(24767);function g(a){return String(a||"").toUpperCase()}function h(a){let b=Number(a??0);return Number.isFinite(b)?b:0}function i(a){return h(a).toFixed(2)}function j(a){if(!a)return"â€”";try{let b=new Date(a);if(Number.isNaN(b.getTime()))return String(a);return b.toLocaleDateString("en-GB")}catch{return String(a)}}function k(a){return a.toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function l(a){return a?Array.isArray(a)?a[0]||null:a:null}function m(a){let b=String(a||"").toUpperCase();return"VOID"===b?{key:"VOID",label:"VOID",cls:"rp-badge rp-badge--void"}:"REFUNDED"===b?{key:"REFUNDED",label:"REFUNDED",cls:"rp-badge rp-badge--refunded"}:"PENDING"===b?{key:"PENDING",label:"PENDING",cls:"rp-badge rp-badge--pending"}:{key:"ISSUED",label:"ISSUED",cls:"rp-badge rp-badge--issued"}}function n(a){return{id:Number(a?.id||0),credit_note_number:a?.credit_note_number??null,credit_note_date:a?.credit_note_date??null,total_amount:a?.total_amount??0,status:a?.status??"ISSUED",customers:a?.customers??null}}function o(){let a=(0,e.useRef)(null),[o,p]=(0,e.useState)(!1),[q,r]=(0,e.useState)("light"),[s,t]=(0,e.useState)(!1),[u,v]=(0,e.useState)(null),[w,x]=(0,e.useState)("â€”"),[y,z]=(0,e.useState)([]),[A,B]=(0,e.useState)(!1),[C,D]=(0,e.useState)(null),[E,F]=(0,e.useState)(""),[G,H]=(0,e.useState)(""),[I,J]=(0,e.useState)("ALL"),[K,L]=(0,e.useState)(!1),[M,N]=(0,e.useState)(null);function O(){let a="dark"===q?"light":"dark";r(a),document.documentElement.dataset.theme=a,localStorage.setItem("rp_theme",a)}async function P(){try{await fetch("/api/auth/logout",{method:"POST"})}finally{localStorage.removeItem("rp_user"),window.location.href="/login"}}(0,e.useEffect)(()=>{t(!0);let a="dark"===localStorage.getItem("rp_theme")?"dark":"light";r(a),document.documentElement.dataset.theme=a;try{let a=localStorage.getItem("rp_user");a&&v(JSON.parse(a))}catch{v(null)}},[]),(0,e.useEffect)(()=>(document.body.style.overflow=o?"hidden":"",()=>{document.body.style.overflow=""}),[o]),(0,e.useEffect)(()=>{let a=()=>N(null);return window.addEventListener("click",a),()=>window.removeEventListener("click",a)},[]),(0,e.useEffect)(()=>{let a=a=>{"Escape"===a.key&&(p(!1),N(null))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]);let Q=s&&"ADMIN"===g(u?.role),R=(0,e.useMemo)(()=>{let a=[{href:"/",label:"Dashboard"},{href:"/invoices",label:"Invoices"},{href:"/credit-notes",label:"Credit Notes"},{href:"/products",label:"Stock & Categories"},{href:"/stock-movements",label:"Stock Movements"},{href:"/customers",label:"Customers"},{href:"/suppliers",label:"Suppliers"},{href:"/reports",label:"Reports & Statements"}];return Q&&a.push({href:"/admin/users",label:"Users & Permissions"}),a},[Q]),S=(0,e.useMemo)(()=>(u?.name||u?.username||"").trim()||"User",[u]),T=(0,e.useMemo)(()=>g(u?.role)||"STAFF",[u]);async function U(){B(!0),D(null);try{let a=await (0,f.rpFetch)("/api/credit-notes",{cache:"no-store"}),b=await a.json().catch(()=>({}));if(!a.ok||b?.ok===!1)throw Error(b?.error||"Failed to load credit notes");let c=b?.creditNotes??[],d=Array.isArray(c)?c.map(n):[];d.sort((a,b)=>(b.id||0)-(a.id||0)),z(d),x(k(new Date))}catch(a){D(a?.message||"Failed to load credit notes"),z([]),x(k(new Date))}finally{B(!1)}}function V(){H(E.trim())}function W(){F(""),H(""),J("ALL")}(0,e.useEffect)(()=>{U()},[]),(0,e.useEffect)(()=>{L(E.trim()!==G.trim())},[E,G]);let X=(0,e.useMemo)(()=>{let a=G.trim().toLowerCase();return y.filter(a=>"ALL"===I||m(a.status).key===I).filter(b=>{if(!a)return!0;let c=l(b.customers);return[b.credit_note_number||"",b.credit_note_date||"",b.status||"",c?.name||"",c?.customer_code||""].join(" ").toLowerCase().includes(a)})},[y,G,I]),Y=(0,e.useMemo)(()=>{let a=X.reduce((a,b)=>a+h(b.total_amount),0),b=X.filter(a=>"PENDING"===m(a.status).key).length,c=X.filter(a=>"ISSUED"===m(a.status).key).length,d=X.filter(a=>"VOID"===m(a.status).key).length;return{count:X.length,sumTotal:a,pending:b,issued:c,voided:d}},[X]),Z=(0,b.jsxs)("div",{className:"rp-side-card rp-card-anim",style:{minHeight:"calc(100vh - 28px)",display:"flex",flexDirection:"column"},children:[(0,b.jsxs)("div",{className:"rp-brand",children:[(0,b.jsx)("div",{className:"rp-brand-logo",children:(0,b.jsx)(d.default,{src:"/images/logo/logo.png",alt:"Ram Pottery Ltd",width:30,height:30,priority:!0})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-brand-title",children:"RampotteryHUB"}),(0,b.jsx)("div",{className:"rp-brand-sub",children:"Accounting & Stock System"})]})]}),(0,b.jsx)("nav",{className:"rp-nav",style:{flex:1},children:R.map(a=>(0,b.jsxs)(c.default,{className:`rp-nav-btn ${"/credit-notes"===a.href?"rp-nav-btn--active":""}`,href:a.href,onClick:()=>p(!1),children:[(0,b.jsx)("span",{className:"rp-ic3d","aria-hidden":"true",children:"â–¶"}),a.label]},a.href))}),(0,b.jsxs)("div",{className:"rp-side-footer rp-side-footer--in",style:{marginTop:"auto"},children:[(0,b.jsxs)("div",{className:"rp-role",children:[(0,b.jsx)("span",{children:"Signed in"}),(0,b.jsx)("b",{title:S,children:s?S:"â€”"})]}),(0,b.jsxs)("div",{className:"rp-role",style:{marginTop:10},children:[(0,b.jsx)("span",{children:"Role"}),(0,b.jsx)("b",{children:s?T:"â€”"})]})]})]});return(0,b.jsxs)("div",{className:"rp-app",children:[(0,b.jsxs)("div",{className:"rp-bg","aria-hidden":"true",children:[(0,b.jsx)("div",{className:"rp-bg-orb rp-bg-orb--1"}),(0,b.jsx)("div",{className:"rp-bg-orb rp-bg-orb--2"}),(0,b.jsx)("div",{className:"rp-bg-orb rp-bg-orb--3"}),(0,b.jsx)("div",{className:"rp-bg-grid"})]}),(0,b.jsxs)("div",{className:"rp-shell rp-enter",children:[(0,b.jsxs)("div",{className:"rp-mtop",children:[(0,b.jsx)("button",{type:"button",className:"rp-icon-btn rp-burger",onClick:()=>p(!0),"aria-label":"Open menu",children:(0,b.jsxs)("span",{"aria-hidden":"true",children:[(0,b.jsx)("i",{}),(0,b.jsx)("i",{}),(0,b.jsx)("i",{})]})}),(0,b.jsxs)("div",{className:"rp-mtop-brand",children:[(0,b.jsx)("div",{className:"rp-mtop-title",children:"RampotteryHUB"}),(0,b.jsx)("div",{className:"rp-mtop-sub",children:"Credit Notes"})]}),(0,b.jsx)("button",{type:"button",className:"rp-icon-btn",onClick:O,"aria-label":"Toggle theme",children:"dark"===q?"â˜€":"ðŸŒ™"})]}),(0,b.jsx)("button",{className:`rp-overlay ${o?"is-open":""}`,onClick:()=>p(!1),"aria-label":"Close menu"}),(0,b.jsxs)("aside",{className:`rp-drawer ${o?"is-open":""}`,children:[(0,b.jsxs)("div",{className:"rp-drawer-head",children:[(0,b.jsxs)("div",{className:"rp-drawer-brand",children:[(0,b.jsx)("div",{className:"rp-drawer-logo",children:(0,b.jsx)(d.default,{src:"/images/logo/logo.png",alt:"Ram Pottery Ltd",width:28,height:28,priority:!0})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-drawer-title",children:"RampotteryHUB"}),(0,b.jsx)("div",{className:"rp-drawer-sub",children:"Accounting & Stock System"})]})]}),(0,b.jsx)("button",{type:"button",className:"rp-icon-btn",onClick:()=>p(!1),"aria-label":"Close",children:"âœ•"})]}),(0,b.jsx)("div",{className:"rp-drawer-body",children:Z})]}),(0,b.jsx)("aside",{className:"rp-side",children:Z}),(0,b.jsxs)("main",{className:"rp-main",children:[(0,b.jsxs)("header",{className:"rp-top rp-top--saas rp-card-anim",style:{animationDelay:"60ms"},children:[(0,b.jsxs)("div",{className:"rp-top-left--actions",children:[(0,b.jsxs)("button",{type:"button",className:"rp-ui-btn rp-ui-btn--brand",onClick:O,children:[(0,b.jsx)("span",{className:"rp-ui-btn__dot","aria-hidden":"true"}),"dark"===q?"â˜€ Light":"ðŸŒ™ Dark"]}),(0,b.jsxs)("button",{type:"button",className:"rp-ui-btn rp-ui-btn--danger",onClick:P,children:[(0,b.jsx)("span",{className:"rp-ui-btn__dot","aria-hidden":"true"}),"Log Out"]})]}),(0,b.jsx)("div",{className:"rp-top-center--logo",children:(0,b.jsx)("div",{className:"rp-top-logo",children:(0,b.jsx)(d.default,{src:"/images/logo/logo.png",alt:"Ram Pottery",width:44,height:44,priority:!0})})}),(0,b.jsx)("div",{className:"rp-top-right--sync",children:(0,b.jsxs)("div",{className:"rp-sync",children:[(0,b.jsx)("div",{className:"rp-sync-label",children:"Last sync :"}),(0,b.jsx)("div",{className:"rp-sync-time",children:w||"â€”"})]})})]}),(0,b.jsxs)("section",{className:"rp-exec rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-exec__left",children:[(0,b.jsx)("div",{className:"rp-exec__title",children:"Credit Notes"}),(0,b.jsx)("div",{className:"rp-exec__sub",children:"Search â€¢ Export â€¢ Print â€¢ Reprint (3â€“6 months later)"})]}),(0,b.jsxs)("div",{className:"rp-exec__right",children:[(0,b.jsxs)("span",{className:`rp-live ${A?"is-dim":""}`,children:[(0,b.jsx)("span",{className:"rp-live-dot","aria-hidden":"true"}),A?"Syncing":"Live"]}),(0,b.jsx)("span",{className:`rp-chip rp-chip--soft ${C?"rp-chip--warn":""}`,children:C?"Attention needed":"All systems normal"})]})]}),(0,b.jsxs)("section",{className:"rp-kpi-pro rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"Credit Notes"}),(0,b.jsx)("div",{className:"rp-kpi-pro__value",children:Y.count}),(0,b.jsx)("div",{className:"rp-kpi-pro__sub",children:"Filtered results"})]}),(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"Total Value"}),(0,b.jsxs)("div",{className:"rp-kpi-pro__value",children:["Rs ",i(Y.sumTotal)]}),(0,b.jsx)("div",{className:"rp-kpi-pro__sub",children:"Sum of totals"})]}),(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"Pending"}),(0,b.jsx)("div",{className:"rp-kpi-pro__value",children:Y.pending}),(0,b.jsx)("div",{className:"rp-kpi-pro__sub",children:"Awaiting action"})]}),(0,b.jsxs)("div",{className:"rp-kpi-pro__cell",children:[(0,b.jsx)("div",{className:"rp-kpi-pro__title",children:"Voided"}),(0,b.jsx)("div",{className:"rp-kpi-pro__value",children:Y.voided}),(0,b.jsx)("div",{className:"rp-kpi-pro__sub",children:"Locked records"})]})]}),(0,b.jsx)("section",{className:"rp-actions rp-card-anim",children:(0,b.jsxs)("div",{className:"rp-seg rp-seg--pro",children:[(0,b.jsxs)(c.default,{className:"rp-seg-item rp-seg-item--brand",href:"/credit-notes/new",children:[(0,b.jsx)("span",{className:"rp-icbtn","aria-hidden":"true",children:"ðŸ§¾"}),"New Credit Note"]}),(0,b.jsxs)("button",{className:"rp-seg-item rp-seg-item--brand",type:"button",onClick:function(){var a;let b,c,d,e,f=X.map(a=>{let b=l(a.customers),c=m(a.status);return[a.credit_note_number||`#${a.id}`,j(a.credit_note_date),b?.name||"",b?.customer_code||"",i(a.total_amount),c.label]});a=`credit_notes_${new Date().toISOString().slice(0,10)}.csv`,b=a=>{let b=String(a??"");return b.includes(",")||b.includes('"')||b.includes("\n")?`"${b.replace(/"/g,'""')}"`:b},c=new Blob([[["Credit Note No","Date","Customer","Customer Code","Total (Rs)","Status"].map(b).join(","),...f.map(a=>a.map(b).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(c),(e=document.createElement("a")).href=d,e.download=a,e.click(),URL.revokeObjectURL(d)},disabled:A,children:[(0,b.jsx)("span",{className:"rp-icbtn","aria-hidden":"true",children:"â¬‡"}),"Export CSV"]}),(0,b.jsxs)("button",{className:"rp-seg-item rp-seg-item--brand",type:"button",onClick:function(){let b=a.current;if(!b)return window.print();let c=`<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Credit Notes</title>
  <style>
    body{font-family: Arial, sans-serif; padding: 22px;}
    h1{font-size: 18px; margin: 0 0 10px;}
    .meta{color:#555;font-size:12px;margin:0 0 16px;}
    table{width:100%; border-collapse:collapse; font-size:12px;}
    th,td{border:1px solid #ddd; padding:8px; text-align:left;}
    th{background:#f4f4f4;}
    .right{text-align:right;}
  </style>
</head>
<body>
  <h1>Credit Notes</h1>
  <div class="meta">Generated: ${k(new Date)}</div>
  ${b.innerHTML}
  <script>window.onload=()=>window.print();</script>
</body>
</html>`,d=window.open("","_blank","width=1000,height=700");d&&(d.document.open(),d.document.write(c),d.document.close())},children:[(0,b.jsx)("span",{className:"rp-icbtn","aria-hidden":"true",children:"ðŸ–¨"}),"Print"]}),(0,b.jsxs)("button",{className:"rp-seg-item rp-seg-item--brand",type:"button",onClick:U,disabled:A,children:[(0,b.jsx)("span",{className:"rp-icbtn","aria-hidden":"true",children:"âŸ³"}),A?"Loadingâ€¦":"Refresh"]})]})}),(0,b.jsxs)("section",{className:"rp-card rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-card-head rp-card-head--tight",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-card-title",children:"Search & Filters"}),(0,b.jsx)("div",{className:"rp-card-sub",children:"Credit note â€¢ customer â€¢ status â€¢ code"})]}),(0,b.jsx)("span",{className:`rp-chip ${A?"is-dim":""}`,children:A?"Syncingâ€¦":"Ready"})]}),(0,b.jsxs)("div",{className:"rp-card-body",children:[(0,b.jsxs)("div",{className:"rp-filters-row",children:[(0,b.jsx)("input",{className:"rp-input rp-input--full",value:E,onChange:a=>F(a.target.value),placeholder:"Search credit note no, customer, statusâ€¦",onKeyDown:a=>{"Enter"===a.key&&V(),"Escape"===a.key&&W()}}),(0,b.jsxs)("button",{type:"button",className:`rp-ui-btn rp-ui-btn--brand ${K?"rp-ui-btn--pulse":""}`,onClick:V,title:"Search",children:[(0,b.jsx)("span",{className:"rp-ui-btn__dot","aria-hidden":"true"}),"Search"]}),(0,b.jsxs)("button",{type:"button",className:"rp-ui-btn",onClick:W,title:"Clear",children:[(0,b.jsx)("span",{className:"rp-ui-btn__dot","aria-hidden":"true"}),"Clear"]})]}),(0,b.jsx)("div",{className:"rp-chip-row",children:[{key:"ALL",label:"All"},{key:"ISSUED",label:"Issued"},{key:"PENDING",label:"Pending"},{key:"REFUNDED",label:"Refunded"},{key:"VOID",label:"Void"}].map(a=>(0,b.jsx)("button",{type:"button",className:`rp-filter-pill ${I===a.key?"rp-filter-pill--active":""}`,onClick:()=>J(a.key),children:a.label},a.key))}),C?(0,b.jsx)("div",{className:"rp-note rp-note--warn",children:C}):null]})]}),(0,b.jsxs)("section",{className:"rp-card rp-card-anim",children:[(0,b.jsxs)("div",{className:"rp-card-head rp-card-head--tight",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"rp-card-title",children:"Credit Note Register"}),(0,b.jsx)("div",{className:"rp-card-sub",children:"Mobile scroll â€¢ pinned first column â€¢ clean actions"})]}),(0,b.jsxs)("span",{className:"rp-soft-pill",children:["Showing ",(0,b.jsx)("b",{children:X.length})]})]}),(0,b.jsx)("div",{className:"rp-card-body",children:(0,b.jsx)("div",{className:"rp-table-wrap",children:(0,b.jsx)("div",{className:"rp-table-scroll",children:(0,b.jsx)("div",{className:"rp-table-scroll__inner",children:(0,b.jsx)("div",{ref:a,children:(0,b.jsxs)("table",{className:"rp-table rp-table--premium",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"rp-pin",style:{width:230},children:"Credit Note No"}),(0,b.jsx)("th",{style:{width:140},children:"Date"}),(0,b.jsx)("th",{style:{minWidth:240},children:"Customer"}),(0,b.jsx)("th",{style:{width:160},children:"Code"}),(0,b.jsx)("th",{className:"rp-right",style:{width:170},children:"Total (Rs)"}),(0,b.jsx)("th",{style:{width:180},children:"Status"}),(0,b.jsx)("th",{className:"rp-pin-right",style:{width:64}})]})}),(0,b.jsx)("tbody",{children:0===X.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:7,className:"rp-td-empty",children:A?"Loading credit notesâ€¦":"No credit notes found."})}):X.map(a=>{let d=l(a.customers),e=m(a.status),f="VOID"===e.key,g=a.credit_note_number||`#${a.id}`;return(0,b.jsxs)("tr",{className:`rp-row-hover ${f?"rp-row-locked":""}`,children:[(0,b.jsx)("td",{className:"rp-pin rp-strong",children:f?(0,b.jsx)("span",{className:"rp-row-link",title:"VOID credit notes are locked","aria-disabled":"true",style:{cursor:"not-allowed",opacity:.75},children:g}):(0,b.jsx)(c.default,{className:"rp-row-link",href:`/credit-notes/${a.id}`,children:g})}),(0,b.jsx)("td",{children:j(a.credit_note_date)}),(0,b.jsx)("td",{children:(0,b.jsx)("div",{className:"rp-strong",children:d?.name||"â€”"})}),(0,b.jsx)("td",{children:d?.customer_code||"â€”"}),(0,b.jsx)("td",{className:"rp-right rp-strong",style:{fontVariantNumeric:"tabular-nums"},children:i(a.total_amount)}),(0,b.jsxs)("td",{children:[(0,b.jsx)("span",{className:e.cls,children:e.label}),f?(0,b.jsx)("span",{style:{marginLeft:8,opacity:.75,fontWeight:900},children:"ðŸ”’"}):null]}),(0,b.jsxs)("td",{className:"rp-pin-right",style:{textAlign:"right"},children:[(0,b.jsx)("button",{type:"button",className:"rp-row-actions-btn","aria-label":"Credit note actions",disabled:f,onClick:b=>{b.stopPropagation(),f||N(M===a.id?null:a.id)},style:f?{opacity:.45,cursor:"not-allowed"}:void 0,children:"â‹®"}),M===a.id&&!f&&(0,b.jsxs)("div",{className:"rp-row-actions-menu",onClick:a=>a.stopPropagation(),children:[(0,b.jsx)(c.default,{href:`/credit-notes/${a.id}`,onClick:()=>N(null),className:"rp-row-actions-link",children:"View / Print"}),(0,b.jsx)("div",{className:"rp-row-actions-sep"}),(0,b.jsx)("button",{onClick:()=>{navigator.clipboard?.writeText(g).catch(()=>{}),N(null)},children:"Copy Number"})]})]})]},a.id)})})]})})})})})})]}),(0,b.jsxs)("footer",{className:"rp-footer",children:["Â© ",new Date().getFullYear()," Ram Pottery Ltd â€¢ Built by Mobiz.mu"]})]})]})]})}a.s(["default",()=>o])}];

//# sourceMappingURL=app_credit-notes_page_tsx_133bc9fc._.js.map