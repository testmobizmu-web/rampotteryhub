{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\n\r\n/* ---------------- PUBLIC PATHS ---------------- */\r\n\r\nfunction isPublicPath(pathname: string) {\r\n  // Login page\r\n  if (pathname === \"/login\") return true;\r\n\r\n  // Auth / session APIs\r\n  if (pathname === \"/api/auth/login\") return true;\r\n  if (pathname === \"/api/login\") return true;\r\n  if (pathname === \"/api/session\") return true;\r\n\r\n  // Next internals & static\r\n  if (pathname.startsWith(\"/_next/\")) return true;\r\n  if (pathname === \"/favicon.ico\") return true;\r\n  if (pathname === \"/robots.txt\") return true;\r\n  if (pathname.startsWith(\"/sitemap\")) return true;\r\n\r\n  // Public assets\r\n  if (pathname.startsWith(\"/images/\")) return true;\r\n\r\n  return false;\r\n}\r\n\r\n/* ---------------- SESSION CHECK ---------------- */\r\n\r\nfunction hasValidSession(req: NextRequest) {\r\n  const raw = req.cookies.get(\"rp_session\")?.value;\r\n  if (!raw) return false;\r\n\r\n  try {\r\n    const parsed = JSON.parse(raw);\r\n    return Boolean(parsed?.id && parsed?.username);\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/* ---------------- MIDDLEWARE ---------------- */\r\n\r\nexport function middleware(req: NextRequest) {\r\n  const { pathname } = req.nextUrl;\r\n\r\n  // Allow public routes\r\n  if (isPublicPath(pathname)) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Allow if logged in\r\n  if (hasValidSession(req)) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // API calls → 401 JSON\r\n  if (pathname.startsWith(\"/api/\")) {\r\n    return NextResponse.json(\r\n      { ok: false, error: \"Unauthorized\" },\r\n      { status: 401 }\r\n    );\r\n  }\r\n\r\n  // Page request → redirect to login\r\n  const loginUrl = req.nextUrl.clone();\r\n  loginUrl.pathname = \"/login\";\r\n  loginUrl.searchParams.set(\"returnTo\", pathname);\r\n\r\n  return NextResponse.redirect(loginUrl);\r\n}\r\n\r\n/* ---------------- CONFIG ---------------- */\r\n\r\nexport const config = {\r\n  matcher: [\r\n    \"/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:png|jpg|jpeg|gif|svg|webp|ico)$).*)\",\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,kDAAkD,GAElD,SAAS,aAAa,QAAgB;IACpC,aAAa;IACb,IAAI,aAAa,UAAU,OAAO;IAElC,sBAAsB;IACtB,IAAI,aAAa,mBAAmB,OAAO;IAC3C,IAAI,aAAa,cAAc,OAAO;IACtC,IAAI,aAAa,gBAAgB,OAAO;IAExC,0BAA0B;IAC1B,IAAI,SAAS,UAAU,CAAC,YAAY,OAAO;IAC3C,IAAI,aAAa,gBAAgB,OAAO;IACxC,IAAI,aAAa,eAAe,OAAO;IACvC,IAAI,SAAS,UAAU,CAAC,aAAa,OAAO;IAE5C,gBAAgB;IAChB,IAAI,SAAS,UAAU,CAAC,aAAa,OAAO;IAE5C,OAAO;AACT;AAEA,mDAAmD,GAEnD,SAAS,gBAAgB,GAAgB;IACvC,MAAM,MAAM,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe;IAC3C,IAAI,CAAC,KAAK,OAAO;IAEjB,IAAI;QACF,MAAM,SAAS,KAAK,KAAK,CAAC;QAC1B,OAAO,QAAQ,QAAQ,MAAM,QAAQ;IACvC,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAIO,SAAS,WAAW,GAAgB;IACzC,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,sBAAsB;IACtB,IAAI,aAAa,WAAW;QAC1B,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,qBAAqB;IACrB,IAAI,gBAAgB,MAAM;QACxB,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,uBAAuB;IACvB,IAAI,SAAS,UAAU,CAAC,UAAU;QAChC,OAAO,gMAAY,CAAC,IAAI,CACtB;YAAE,IAAI;YAAO,OAAO;QAAe,GACnC;YAAE,QAAQ;QAAI;IAElB;IAEA,mCAAmC;IACnC,MAAM,WAAW,IAAI,OAAO,CAAC,KAAK;IAClC,SAAS,QAAQ,GAAG;IACpB,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY;IAEtC,OAAO,gMAAY,CAAC,QAAQ,CAAC;AAC/B;AAIO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}